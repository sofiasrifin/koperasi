new function(){function a(a){function e(a){switch(a){case "onkeydown":case "onkeyup":case "onkeypress":return true}return false}function d(b){if(b===a)return true;switch(b.tagName){case "INPUT":case "A":case "BUTTON":case "SELECT":case "TEXTAREA":case "HTML":return true}return false}var f=a.attachEvent,g=a.detachEvent;function b(c,b){if(e(c)&&!d(this)){var g=b;b=function(c){var d=a.event;a.event=c;if(!b._elt.contains||b._elt.contains(c.srcElement))g(c);a.event=d};b._elt=this;b._isKeyboardHandlerAttached=false;b._onKeyboardFocusIn=function(){if(!b._isKeyboardHandlerAttached){b._isKeyboardHandlerAttached=true;a.attachEvent(c,b)}};this.attachEvent("onfocusin",b._onKeyboardFocusIn);b._onKeyboardFocusOut=function(){if(!b._elt.contains(event.toElement)){b._isKeyboardHandlerAttached=false;a.detachEvent(c,b)}};this.attachEvent("onfocusout",b._onKeyboardFocusOut);return}f.call(this,c,b)}function c(b,a){if(e(b)&&!d(this)){var f=a._onKeyboardFocusIn;delete a._onKeyboardFocusIn;this.detachEvent("onfocusin",f);var c=a._onKeyboardFocusOut;delete a._onKeyboardFocusOut;this.detachEvent("onfocusout",c);delete a._elt;delete a._isKeyboardHandlerAttached;return}g.call(this,b,a)}a.attachEvent=b;a.detachEvent=c;a.HTMLDocument.prototype.attachEvent=b;a.HTMLDocument.prototype.detachEvent=c;a.HTMLElement.prototype.attachEvent=b;a.HTMLElement.prototype.detachEvent=c}$Browser.addExtension(a)};(function(){var g=window,d=g.jQuery;if(!(g["ActionQueueTypes"]===undefined))return;var e=g["ActionQueueTypes"]={},k=g["ActionQueueUtils"]={},a=e.ActionType=new $Enum("prefetch","async","prefetchView","view","blocking","blockingView");a.isOfType=function E(b){return typeof a[b]==="string"};a.isView=function F(b){return b===a.view||b===a.prefetchView||b===a.blockingView};a.isBlocking=function A(b){return b===a.blocking||b===a.blockingView};a.isPrefetch=function B(b){return b===a.prefetch||b===a.prefetchView};var b=e.QueueItemState=new $Enum("waiting","executing","done","abandoned");b.isOfType=function y(a){return typeof b[a]==="string"};b.isWaiting=function u(a){return a===b.waiting};b.isCancellable=function q(a){return a!==b.done};b.isExecuting=function s(a){return a===b.executing};var c=e.QueueItem=function D(f,g,a,h,e){if(c.NextId===undefined)c.NextId=0;else c.NextId++;this.id=c.NextId;this.friendlyName=f;this.action=null;this.clientCallback=h;this.clientErrorCallback=e;this.actionType=g;this.keys=!a?[]:d.grep(a,function i(a){return !!a});this.beginTime=new Date;this.state=b.waiting;this.timeoutId=null;this.isCancelled=this.success=false;this.dependentView=null;this.dependentOn=[]};c.isDependentOn=function x(c,f){var b=false;if(a.isBlocking(c.actionType))b=true;else for(var e=c.keys.length-1;e>=0;e--)if(d.inArray(c.keys[e],f.keys)!=-1){b=true;break}return b};c.compare=function G(b,d){var h=b.actionType,f=d.actionType,g=null;if(b.beginTime<=d.beginTime){g=b;b=d;d=g}var e=false;if(a.isView(h)&&f!=a.blocking)if(a.isView(f)){if(!a.isPrefetch(h)||a.isPrefetch(f))e=true}else if(a.isPrefetch(f))e=true;else if(c.isDependentOn(b,d)){d.dependentView=b;b.dependentOn.push(d)}else e=true;return g?!e:e};c.areDependentsDone=function r(c){var a=true;d.each(c.dependentOn,function e(e,c){if(!c.isCancelled){var d=c.state;if(b.isExecuting(d)||b.isWaiting(d)){a=false;return false}}});return a};var j=e.ActionQueueToken=function o(a,c,b){this.item=a;this.friendlyName=a.friendlyName;this._doneCallback=c;this._cancelCallback=b};j.prototype={_getCallback:function n(d,c,b){function a(){b(d,c,arguments)}return a},getSuccessCallback:function m(){var a=this._getCallback(this.item,true,this._doneCallback);return a},getFailureCallback:function l(){var a=this._getCallback(this.item,false,this._doneCallback);return a},cancel:function v(){return this._cancelCallback(this)},isCancelled:function p(){return this.item.isCancelled}};var f=k.NetChecker=function z(){this._image=new Image;this._image.onload=$CD(this,this._onImageLoad);this._image.onerror=$CD(this,this._onImageError);this._trialCount=0;this._fakeErrors=0;this._isConnectivityLost=false;this._baseImageSrc=App.config.imgSvrUrl+"net_up.gif?r="+Math.random()+"&d="+(new Date).getTime()+"&t="},h=5,i=5e3;f.Events=new $Enum("onConnectivityLost","onConnectivityFound");f.prototype={_onImageLoad:function w(){if(this._fakeErrors>0){this._fakeErrors--;this._onImageError()}else{this._isConnectivityLost=false;d(this).trigger(f.Events.onConnectivityFound)}},_load:function H(){this._image.src=this._baseImageSrc+this._trialCount.toString()},_onImageError:function t(){if(this._trialCount==h){this._isConnectivityLost=true;d(this).trigger(f.Events.onConnectivityLost)}this._trialCount++;var a=this._isConnectivityLost?i:Math.pow(2,this._trialCount)*1e3;setTimeout($CD(this,this._load),a)},startCheck:function C(a){this._fakeErrors=a;this._load()}}})();(function(){var k=window,f=k.jQuery;if(!(k["ActionQueue"]===undefined))return;var m=k.ActionQueueTypes,F=k.ActionQueueUtils,o=m.ActionType,d=m.QueueItemState,r=m.QueueItem,E=m.ActionQueueToken,A=F.NetChecker,b=k["ActionQueue"]={Events:new $Enum("onactionbeginexecution","onactionendexecution","onactionqueued","onactioncancelled","onactionabandoned","onqueueempty","onqueuepaused","onqueueresumed","onqueueconnectivitylost","onqueueconnectivityrecovered","onqueueuseractivitywhileconnectivitylost")},e=b.Events;b.$=f(b);var u=1,H=u+1,G=1e4,a=[],n=0,i=false,l=false,p=0,g={lifetime:{maxLength:0,totalItems:0,totalTime:0,percentEmpty:100,maxWait:0,avgWait:0,errors:0,abandoned:0},current:{queueLength:0,categories:{byType:{},byState:{}}}},c={beginTime:new Date,lastEmptyBeginTime:new Date,timeEmpty:0,totalExecuted:0,totalWaitTime:0};function w(a,c){for(var b in a)if(typeof a[b]==="string")c[b]=0}function j(c,a){f(b).trigger(a,{eventName:a,item:c})}function h(a){f(b).trigger(a,{eventName:a})}function J(b,d){if(!b||!d)return;b.action=d;var e=-1,f=a.length;for(var c=0;c<f;c++)if(!r.compare(b,a[c])){a.splice(c,0,b);e=c;break}if(e==-1)a.push(b)}function I(){var b=g.lifetime;if(a.length>b.maxLength)b.maxLength=a.length;b.totalItems++;if(a.length==1){c.timeEmpty+=new Date-c.lastEmptyBeginTime;c.lastEmptyBeginTime="invalid"}if(l)h(e.onqueueuseractivitywhileconnectivitylost)}function q(a){var b=false;if(!i&&d.isWaiting(a.state)&&!a.isCancelled&&r.areDependentsDone(a))if(n<u)b=true;else if(n<H)b=o.isView(a.actionType)||a.dependentView&&!a.dependentView.isCancelled&&d.isWaiting(a.dependentView.state);return b}function B(a){if(q(a)){n++;a.state=d.executing;c.totalExecuted++;var f=new Date-a.beginTime;c.totalWaitTime+=f;var b=g.lifetime;if(f>b.maxWait)b.maxWait=f;b.avgWait=c.totalWaitTime/c.totalExecuted;j(a,e.onactionbeginexecution);setTimeout(function h(){try{a.timeoutId=setTimeout(function e(){if(d.isExecuting(a.state)){s(a,false,true);t()}},G);a.action()}catch(b){(function c(){z(a,false,arguments)})();throw b;}},0)}}function x(){if(a.length==0){c.lastEmptyBeginTime=new Date;h(e.onqueueempty)}}function v(){for(var c=a.length-1;c>=0;c--){var b=a[c];if(!d.isWaiting(b.state))continue;if(!q(b))break;B(b)}}function K(g){var c=false,b=g?g.item:null;if(b&&d.isCancellable(b.state)&&!b.isCancelled){var h=f.inArray(b,a);if(h!=-1){if(d.isWaiting(b.state))a.splice(h,1);b.isCancelled=true;j(b,e.onactioncancelled);x();c=true}}return c}function t(){b.pause();var a=new A,c=A.Events;f(a).bind(c.onConnectivityLost,function g(){l=true;h(e.onqueueconnectivitylost)});f(a).bind(c.onConnectivityFound,function d(){if(l){l=false;h(e.onqueueconnectivityrecovered)}b.resume()});a.startCheck(p)}function s(b,h,c){var i=f.inArray(b,a);if(i!=-1){a.splice(i,1);x()}if(d.isExecuting(b.state)){n--;if(c){b.state=d.abandoned;g.lifetime.abandoned++;j(b,e.onactionabandoned)}}if(!c){if(b.timeoutId)clearTimeout(b.timeoutId);b.state=d.done;b.success=h;g.lifetime.errors+=h?0:1;j(b,e.onactionendexecution)}b.timeoutId=null}function y(d,b,a,c){if(a)setTimeout(function e(){try{a.apply(null,c)}catch(e){var f=String.format('ActionQueue: faulty {0} for action "{1}" threw an exception:\n\n{2}',b,d.friendlyName,e&&e.message?e.message:e);throw e;}},0)}function D(c,a,b){if(a)y(c,"callback",a,b);v()}function C(c,a,b){if(a)y(c,"error callback",a,b);t()}function z(a,b,c){b=b&&!p;s(a,b,false);if(b)D(a,a.clientCallback,c);else C(a,a.clientErrorCallback,c)}b.getToken=function P(d,a,f,e,c){var b=null;if(o.isOfType(a))b=new r(d,a,f,e,c);return new E(b,z,K)};b.addToken=function O(c,d){var b=c?c.item:null;if(!b||b.action||f.inArray(b,a)!=-1)return;J(b,d);I();if(q(b))B(b);else j(b,e.onactionqueued)};b.pause=function T(){if(!i){i=true;h(e.onqueuepaused)}};b.isPaused=function Q(){return i};b.resume=function S(){if(i){i=false;h(e.onqueueresumed);v()}};b.each=function U(c,d){if(c)for(var b=a.length-1;b>=0;b--)c(d,b,a[b])};b.injectErrors=function L(a){p=a};b.hasPending=function M(){var b;for(var c=a.length-1;c>=0;c--){b=a[c];if(!o.isPrefetch(b.actionType)&&d.isWaiting(b.state))return true}return false};b.statistics=function N(){var l=new Date,b=g.lifetime,m=c.timeEmpty+(c.lastEmptyBeginTime==="invalid"?0:l-c.lastEmptyBeginTime);b.totalTime=l-c.beginTime;b.percentEmpty=m/b.totalTime*100;var j=g.current;j.queueLength=a.length;var h=j.categories,k=h.byType={},i=h.byState={};w(o,k);w(d,i);var e;for(var f=a.length-1;f>=0;f--){e=a[f];k[e.actionType]++;i[e.state]++}return g};b.dispose=function R(){}})();(function(){var c=window,r=c.jQuery,h=c.$WebWatson;if(!(c["InflightRequestMgr"]===undefined))return;var b=c["InflightRequestMgr"]={},a={};function d(f,j,g){var i={data:j,metaData:g},b=a[f];if(b){for(var c=b.length-1;c>=0;c--){var d=b[c];b.splice(c,1);if(d)try{d(i)}catch(k){if(h)h.submitFromException(e)}}delete a[f]}}function g(b){return !!a[b]}function f(d,c){var b=a[d];if(b)b.push(c);return !!b}b.declareMessageAsInflight=function j(b){if(!a[b])a[b]=[];return b};b.declareConversationAsInflight=function i(d,c){var b=d+"."+c;if(!a[b])a[b]=[];return b};b.undeclareRequest=function q(b){if(a[b])delete a[b]};b.isMessageInflight=function p(a){return g(a)};b.isConversationInflight=function m(b,a){return g(b+"."+a)};b.registerForMessage=function o(b,a){var c=f(b,a);return c};b.registerForConversation=function l(b,a,c){var d=f(b+"."+a,c);return d};b.onMessageAvailable=function n(c,b,a){d(a,c,b)};b.onConversationAvailable=function k(c,e,b,a){var f=b+"."+a;d(f,c,e)}})();(function(){var c=window,b=c.wLive,a=c.jQuery;b.Hotmail=b.Hotmail||{};b.Hotmail.AggregatedEventHandler=d;function d(j,r,o,n,m){var s=this,e=j,c=n||null,g=m||null,i=r,d={staticData:o||null},b={};a.each(j,q);s.dispose=function t(){h();c=null;i=null;d=null};function h(){if(e)a.each(e,p);e=null}function q(e,c){if(c.src&&c.type){var d=c.type;a(c.src).bind(d,f);if(d!=g)b[d]=true}}function p(c,b){if(b.src&&b.type)a(b.src).unbind(b.type,f)}function k(){for(var a in b)if(b[a])return false;return true}function f(i,e){if(!c||c(i,e)){var h={},f=i.type;h[f]=e;a.extend(d,h);delete b[f];var j=f==g;if(j||k())l(j&&!!e.isInterrupted)}}function l(b){try{if(!b)h();i(d)}catch(a){var c=a.message||""}}}})();(function(){var r=window,p=r.jQuery;if(!(r["Cache"]===undefined))return;var a=r["Cache"]={Events:new $Enum("iteminvalidated","itempruned","itemadded","itemread")},g=a.Events,m=a.$=p(a);_MAXITEMS=100;var c={},e=null,k=null,b={total:0,max:0,numInvalidates:0,numPrunes:0,numAdds:0,numReads:0,numNotFounds:0};CacheValue=function U(f,c,e,d,a,b){this.type=f;this.primaryKey=c;this.data=e;this.metaData=d;this.alternateKeys=a;this.notesToSelf=b;this.creationTime=this.accessTime=new Date;this.older=null;this.newer=null};function t(a){if(e===a)e=a.older;if(k===a)k=a.newer;if(a.newer)a.newer.older=a.older;if(a.older)a.older.newer=a.newer;a.older=a.newer=null}function x(b){if(b)for(var d=b.alternateKeys.length-1;d>=0;d--){var e=b.alternateKeys[d],a=c[e];if(a){var f=p.inArray(b,a);if(f!=-1)a.splice(f,1);if(a.length==0)delete c[e]}}}function u(a){return a?{data:a.data,metaData:a.metaData}:a}function o(b,c){var a=null;if(b){a=u(b);a["rawCacheValue"]=b;a["eventName"]=c}return a}function h(e,h){var a=c[e];if(a){t(a);delete c[e];x(a);b.total--;var f=b[a.type];if(f>0)b[a.type]=f-1;var d;if(h){b.numPrunes++;d=g.itempruned}else{b.numInvalidates++;d=g.iteminvalidated}m.trigger(d,o(a,d))}}function l(f,e,g){var a=c[f];if(a){var b;for(var d=a.length-1;d>=0;d--){b=a[d];if(!e||b.type==e)h(b.primaryKey,g)}}}function w(a){if(!k)k=a;if(!e)e=a;else{a.older=e;e.newer=a;e=a}}function v(a){if(a){a.accessTime=new Date;if(!(e===a)){t(a);w(a)}b.numReads++;var c=g.itemread;m.trigger(c,o(a,c))}return a}function j(a,c,d){if(a){if(d)v(a);return c?u(a):a.data}else{b.numNotFounds++;return null}}function n(h,f,g,i){var a=[],b=c[h];if(b)for(var e=b.length-1;e>=0;e--){var d=b[e];if(!f||d.type==f)if(g)a.push(j(d,i,true));else a.push(v(d))}return a}function y(a){if(a)for(var b=a.alternateKeys.length-1;b>=0;b--){var d=a.alternateKeys[b],e=c[d];if(e)e.push(a);else c[d]=[a]}}function q(e,d,n,l,f,i){var a=new CacheValue(e,d,n,l,f,i);if(b.total>=_MAXITEMS)h(k.primaryKey,true);if(c[d])h(d,false);w(a);c[d]=a;y(a);b.total++;if(b.max<b.total)b.max=b.total;b.numAdds++;var j=b[e]||0;b[e]=j+1;m.trigger(g.itemadded,o(a,g.itemadded));return a}function i(a){return a.join(".")}var d=a.Types={Conversation:"Conversation",Message:"Message",MessageListPage:"MessageListPage"};(function Q(){for(type in d)b[type]=0})();var f=null;function s(c,b){var a=p.inArray(b.rawCacheValue,f);if(a!=-1)f.splice(a,1)}a.setConversation=function N(c,e,a,b,f){q(d.Conversation,i([a,b]),c,e,[a].concat(f),{conversationId:a})};a.setMessage=function R(c,b,a,e){q(d.Message,a,c,b,[e],null)};a.setMessageListPage=function L(a,e,c,b){var h=q(d.MessageListPage,i([c,b]),a,e,[],null);if(f==null){f=[];m.bind(g.itempruned,s).bind(g.iteminvalidated,s)}f.push(h)};a.invalidateConversationById=function D(a){l(a,d.Conversation,false)};a.invalidateConversationsBySender=function A(e){var b=n(e,d.Conversation,false,false);if(b){var a;for(var c=b.length-1;c>=0;c--){a=b[c];if(a.notesToSelf&&a.notesToSelf.conversationId)l(a.notesToSelf.conversationId,d.Conversation,false)}}};a.invalidateMessageById=function H(a){h(a,false)};a.invalidateMessagesBySender=function E(a){l(a,d.Message,false)};a.invalidateMessageListPage=function F(b,a){h(i([b,a]),false)};a.invalidateRawObjectByPrimaryKey=function B(a){h(a,false)};a.invalidateRawObjectsByAlternateKey=function z(a){l(a,null,false)};a.getConversationByIdAndView=function C(b,a,d,e){var f=c[i([b,a])];return j(f,d,e)};a.getConversationsBySender=function G(b,a){var c=n(b,d.Conversation,true,a);return c};a.getMessageById=function O(d,a,b){var e=c[d];return j(e,a,b)};a.getMessagesBySender=function J(b,a){var c=n(b,d.Message,true,a);return c};a.getMessageListPage=function K(d,b,a){var e=c[i([d,b])];return j(e,a,true)};a.getMessageListPages=function I(d){var b=[],c;if(f)for(var a=f.length-1;a>=0;a--){c=f[a];b.push(j(c,d,false))}return b};a.statistics=function S(){return b};a.getRawObject=function P(a){return c[a]};a.each=function V(d,g,h){var f=0,c=true;for(var a=e;a&&c!==false;a=a.older){f++;if(f>b.total)break;else if(h)c=d(g,a);else c=d(g,a.data,a.metaData)}};a.getNeverReadList=function M(c,g){var d=[],f=0;for(var a=e;a;a=a.older){f++;if(f>b.total)break;else if(a.accessTime==a.creationTime&&(!c||c(g,a.data,a.metaData)))d.push(a)}return d};a.dispose=function T(){}})();(function(){window.PostProcData=a;function a(d,c,b){var a=this;a.ads=d;a.history=c;a.skipCsi=false;a.hideInfoPane=true;a.showLoading=typeof b=="undefined"?true:b;a.uiUpdate=false,a.inbox={delayBsiForReadMessage:false,updateSortUi:false,showAdvancedSearch:false,hideAdvancedSearch:false,advancedSearch:null};a.composeFrame={hide:false,load:false};a.reportCSIPerf=null}})();var _de=Page.isChromeEnabled?window:window.parent;FolderQuickViewListHelper={qvidPrefix:"qv-"};FolderQuickViewListHelper.getSelectedFolder=function FolderQuickViewListHelper$getSelectedFolder(){var a=jQuery("#folderList");return jQuery(".t_sel",a).parent("li")};FolderQuickViewListHelper.resolveToFolderElt=function FolderQuickViewListHelper$resolveToFolderElt(e){var c=null,b=null,a=Control.getAncestorByAttr(e,"f");if(a)if(a.getAttribute("fidref")){b=a;c=_ge(b.getAttribute("idref"))}else if(a.getAttribute("fid"))c=a;var d={};d.folderElt=c;d.targetElt=b?b:c;return d};FolderQuickViewListHelper.getFolderEltAndRefElts=function FolderQuickViewListHelper$getFolderEltAndRefElts(a){if(!_de._ge(a))return null;var d=$getDescendantsByAttr(_ge("folderListContainer"),"LI","f","f"),c=[];d.forEach(function(b){if(b.getAttribute("fidref")&&a==b.getAttribute("idref")||b.getAttribute("fid")&&a==b.getAttribute("id"))c.push(b)});var b={};b.folderElt=_de._ge(a);b.refElts=c;return b};FolderQuickViewListHelper.getCount=function FolderQuickViewListHelper$getCount(b){var a=_de._ge(b);return parseInt(a.getAttribute("count"))};FolderQuickViewListHelper._setCountForElt=function FolderQuickViewListHelper$_setCountForElt(a,b){var c=$tag(a,"span"),f=b.id,d=b.getAttribute("count"),e=!this._isTotalCountFolder(f)&&!this._isTotalCountQuickView(f);if(d>0){c[1].style.display="inline";if(e)$css.add(a,"BoldText")}else{$setDisplay(c[1],false);if(e)$css.remove(a,"BoldText")}c[2].innerText=d+"";$getDescendantByAttr(a,"A","lni","lni").title=FolderQuickViewListHelper._createTitle(b.getAttribute("nm"),d)};FolderQuickViewListHelper.setCount=function FolderQuickViewListHelper$setCount(a,c){if(typeof InboxPage!=="undefined"&&InboxPage)if(a==InboxPage.Config.sysFldrs.searchFid||a==InboxPage.Config.sysFldrs.noneFid)return;if(FolderQuickViewListHelper.getCount(a)==c)return;var b=_de._ge(a);b.setAttribute("count",c);if(b.getAttribute("qvid")||typeof ComposePage!=="undefined")FolderQuickViewListHelper._setCountForElt(b,b);else if(typeof InboxPage!=="undefined"&&a!=InboxPage.Config.sysFldrs.sentFid&&b.getAttribute("fid")){var d=FolderQuickViewListHelper.getFolderEltAndRefElts(a);if(d)d.refElts.forEach(function(a){FolderQuickViewListHelper._setCountForElt(a,d.folderElt)})}if(typeof InboxPage!=="undefined"&&a==InboxPage.Config.sysFldrs.inboxFid)$HeaderCookie.updateUnreadCount(c)};FolderQuickViewListHelper.initLeftNavTitles=function InboxPage$initLeftNavTitles(a){var b=$getDescendantsByAttr(a,"LI","f");b.forEach(function(a){if(a.getAttribute("fidref"))FolderQuickViewListHelper._initLeftNavTitlesForElt(a,_de._ge(a.getAttribute("idref")));else if(a.getAttribute("fid")||a.getAttribute("qvid"))FolderQuickViewListHelper._initLeftNavTitlesForElt(a,a)})};FolderQuickViewListHelper._initLeftNavTitlesForElt=function FolderQuickViewListHelper$_initLeftNavTitlesForElt(e,a){var c=a.getAttribute("nm"),d=a.getAttribute("count"),b=$getDescendantByAttr(e,"A","lni","lni");if(a.id==InboxPage.Config.sysFldrs.sentFid)b.title=c;else b.title=FolderQuickViewListHelper._createTitle(c,d)};FolderQuickViewListHelper._createTitle=function FolderQuickViewListHelper$_createTitle(d,b){var a=d;if(b>0&&!($B.Safari&&$B.rtl)){var c=" "+($B.rtl?"\u200f":"");a=a+c+"("+b+")"}return a};FolderQuickViewListHelper._isTotalCountFolder=function FolderQuickViewListHelper$_isTotalCountFolder(b){var a=null;if(typeof InboxPage!="undefined")a=InboxPage.Config.sysFldrs.draftsFid;else if(typeof ComposePage!="undefined")a=ComposePage.sysFldrs.draftsFid;return b==a};FolderQuickViewListHelper._isTotalCountQuickView=function FolderQuickViewListHelper$_isTotalCountQuickView(b){var a=null;if(typeof InboxPage!="undefined")a=InboxPage.Config.quickViews.flaggedQvid;else if(typeof ComposePage!="undefined")a=ComposePage.quickViews.flaggedQvid;return b==FolderQuickViewListHelper.qvidPrefix+a};FolderQuickViewListHelper.updateCounts=function FolderQuickViewListHelper$updateCounts(b){if(!b)return;for(var a in b){if(FunctionHelper.isSpecialMember(b,a)||!_de._ge(a))continue;var e=this.getCount(a),d=b[a];if(0==d)continue;var c=e+d;if(c>=0)this.setCount(a,c)}};FolderQuickViewListHelper._getFolderIdFromAuxData=function FolderQuickViewListHelper$_getFolderIdFromAuxData(a,e){var c=a.getById(e),d=c.mad(),b=d.split("|")[3];return b};FolderQuickViewListHelper.canUpdateFolderQuickViewCounts=function FolderQuickViewListHelper$canUpdateFolderQuickViewCounts(a,c,b){return !(c||a&&b.hasConversation(a))};FolderQuickViewListHelper.getCountOffsetsForFlagMessages=function FolderQuickViewListHelper$getCountOffsetsForFlagMessages(b,j,c,e,g){if(!this.canUpdateFolderQuickViewCounts(b,j,g))return null;var h={},f=e?b.length:1;for(var d=b.length-1;d>=0;d--){var a=this._getMessageInfo(g,b[d]);if(!e);if(!a)continue;if(a.isFlagged&&c||!a.isFlagged&&!c)continue;if(this._quickViewsNeedUpdatingOnMark(a.fid)){var i=!c?-f:f;this._addOffset(h,FolderQuickViewListHelper.qvidPrefix+InboxPage.Config.quickViews.flaggedQvid,i)}}return h};FolderQuickViewListHelper.getCountOffsetsForMark=function FolderQuickViewListHelper$getCountOffsetsForMark(d,l,c,k,m,h){if(!this.canUpdateFolderQuickViewCounts(d,l,h))return null;var b={},g=1;for(var e=d.length-1;e>=0;e--){var a=this._getMessageInfo(h,d[e],k);if(!a)continue;if(a.isRead&&c||!a.isRead&&!c)continue;var i=c?-g:g;if(!this._isTotalCountFolder(a.fid))this._addOffset(b,a.fid,i);if(this._quickViewsNeedUpdatingOnMark(a.fid))for(var f=a.categories.length-1;f>=0;f--){var j=FolderQuickViewListHelper.qvidPrefix+a.categories[f];if(!this._isTotalCountQuickView(j))this._addOffset(b,j,i)}}return b};FolderQuickViewListHelper.getCountOffsetsForMove=function FolderQuickViewListHelper$getCountOffsetsForMove(b,d,e,c,a){if(!this.canUpdateFolderQuickViewCounts(b,d,a))return null;return this._getCountOffsetsForMove(b,e,c,a)};FolderQuickViewListHelper.getCountOffsetsForJmr=function FolderQuickViewListHelper$getCountOffsetsForJmr(g,i,c,e){if(!this.canUpdateFolderQuickViewCounts(g,i,e))return null;var d=InboxPage.Config.sysFldrs,h=d.trashFid,f=d.junkFid,a,b=HM.JmrType;if(b.NotJunk==c)if(InboxPage.folderList.fid==f)a=d.inboxFid;else a=null;else if(b.Junk==c||b.Compromised==c)a=f;else if(b.Unsubscribe==c)a=null;else if(b.Phish==c)a=h;if(a)return this._getCountOffsetsForMove(g,a,false,e);else return {}};FolderQuickViewListHelper._getCountOffsetsForMove=function FolderQuickViewListHelper$getCountOffsetsForMove(h,c,j,l){var d={};for(var e=h.length-1;e>=0;e--){var a=this._getMessageInfo(l,h[e]);if(!j);if(!a)continue;var b=a.fid,g=InboxPage.Config.sysFldrs.trashFid,m=InboxPage.Config.sysFldrs.junkFid;if(c==g&&(b==g||b==m)){if(!a.isRead)this._addOffset(d,b,-1)}else if(b!=c){if(!a.isRead||this._isTotalCountFolder(b))this._addOffset(d,b,-1);if(!a.isRead||this._isTotalCountFolder(c))this._addOffset(d,c,1)}if(this._quickViewsNeedUpdatingOnMove(b,c)){var k=this.isJunkOrDeletedFolder(c)?-1:1;for(var f=a.categories.length-1;f>=0;f--){var i=FolderQuickViewListHelper.qvidPrefix+a.categories[f];if(!a.isRead||this._isTotalCountQuickView(i))this._addOffset(d,i,k)}}}return d};FolderQuickViewListHelper.isJunkOrDeletedFolder=function FolderQuickViewListHelper$isJunkOrDeletedFolder(b){var a=InboxPage.Config.sysFldrs;return b==a.junkFid||b==a.trashFid};FolderQuickViewListHelper.isDeletedFolder=function FolderQuickViewListHelper$isDeletedFolder(b){var a=InboxPage.Config.sysFldrs;return b==a.trashFid};FolderQuickViewListHelper._quickViewsNeedUpdatingOnMark=function FolderQuickViewListHelper$_quickViewsNeedUpdatingOnMark(a){return !FolderQuickViewListHelper.isJunkOrDeletedFolder(a)};FolderQuickViewListHelper._quickViewsNeedUpdatingOnMove=function FolderQuickViewListHelper$_quickViewsNeedUpdatingOnMove(a,b){return this.isJunkOrDeletedFolder(b)!=this.isJunkOrDeletedFolder(a)};FolderQuickViewListHelper._addOffset=function FolderQuickViewListHelper$_addOffset(a,b,c){a[b]=a[b]?a[b]+c:c};FolderQuickViewListHelper._getFolderForMessage=function FolderQuickViewListHelper$_getFolderForMessage(a,b){if(InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.noneFid&&InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.searchFid)return InboxPage.folderList.fid;else return this._getFolderIdFromAuxData(a,b)};FolderQuickViewListHelper._getMessageInfo=function FolderQuickViewListHelper$_getMessageInfo(b,c,f){var a=null;if(b.containsId(c)&&!f){var e=b.getById(c);a={};a.fid=this._getFolderForMessage(b,c);a.isRead=e.read();a.isFlagged=e.flag();a.categories=e.getCategories()}else{var g=InboxPage.readingPane.getMessagePart(c);if(g){var d=g.msg;a={};a.isRead=!d.isUnreadOnClient();a.isFlagged=d.isFlagged();a.categories=d.categories();a.duplicateMsgIds=d.duplicateMsgIds();if(a.duplicateMsgIds&&!f&&b)a.fid=this._getFolderForMessage(b,c);else a.fid=d.fid()}}return a};FolderQuickViewListHelper.getFolderNameByFid=function FolderQuickViewListHelper$getFolderNameByFid(c){var b="",a=_de._ge(c);if(a)b=a.getAttribute("nm");return b};FolderQuickViewListHelper._getCurrentFolderOrQuickViewEltId=function FolderQuickViewListHelper$_getCurrentFolderOrQuickViewEltId(){var b="",a=InboxPage.folderList.fid,c=InboxPage.quickViewList.qvid;if(c&&""!=c)b=FolderQuickViewListHelper.qvidPrefix+c;else if(a&&""!=a&&a!=InboxPage.Config.sysFldrs.noneFid)b=a;return b};FolderQuickViewListHelper.scrollIntoView=function FolderQuickViewListHelper$scrollIntoView(){var a=FolderQuickViewListHelper._getCurrentFolderOrQuickViewEltId();if(null!=a&&""!=a)$scrollIntoView(_de._ge(a),_ge("contentFolderQuickViewList"),2)};Type.createStaticClass(FolderQuickViewListHelper,"FolderQuickViewListHelper");$Network.registerFpp("HM",function(){var h=$Network.FppProxy,a=h.__string,c=h.__primitive,e=h.__array,d=h.__custom,f=h.__enum,i=h.__date,g=h.__object,j=h.__oArray,b=new $Network.FppProxy("HM");b.FppStatus=new $Flags("SUCCESS",0,"ERR_HTTP_MISCONFIGURATION",-7,"ERR_HTTP_PARSE_FAILURE",-6,"ERR_HTTP_CONNECT_FAILURE",-5,"ERR_HTTP_TIMEOUT",-4,"ERR_SERVER_UNCAUGHT",-3,"ERR_APP_SPECIFIC",-2,"ERR_FPP_PROTOCOL",-1);b.rfc("FppError",[a("ErrorCode"),a("Message"),g("ErrorObj"),a("StackTrace")]);b.rfc("FppReturnPackage",[f("Status"),g("Value"),j("OutRefParams"),d(b.FppError,"Error"),g("ProfilingInfo")]);b.rfm("ReportError",[a("errorString")],"ReportError",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("HmSimpleMsg",[c("IsBlocking"),c("YesCode"),c("NoCode"),a("Message")]);b.SortBy=new $Flags("Sender",0,"Subject",1,"Size",2,"Type",3,"Date",4);b.ContentId=new $Enum("CommonSenderAction","CommonDeleteAndBlockAllFromSender","DeleteAllFromSender","BlockAllFromSender","MoveAllFromSender","MoveMessage","ReadMessageAddContact","MessageListContextMenu","MoveToFolderListSelect","AdvancedSearch","SlideshowSilverlightUpsell","VideoPlaybackSilverlightUpsell","JunkContactOrSafeSender","CompromisedAlert","GotoDatePicker","GotoAlphaPicker");b.MessageBodyType=new $Flags("Part",0,"Full",1);b.ItemView=new $Flags("Normal",0,"Deleted",1,"Junk",2,"Delayed",3);b.PsaType=new $Flags("None",0,"Upsell",1,"Fre",2,"Auth",3);b.RemoveSenderFromListOption=new $Flags("None",0,"KeepContact",1,"RemoveContact",2,"KeepSafeSender",3,"RemoveSafeSender",4);b.rfc("BatchInfo",[a("AnchorDate"),a("AnchorId"),c("ProcessedCount"),c("IsLastBatch"),a("Timestamp"),a("SenderSearch")]);b.rfc("InboxUiData",[a("FolderListHtml"),a("QuickViewListHtml"),a("MessageListHtml"),a("MessageHtml"),d(b.ItemResponseInfo,"ItemInfo"),a("SuggestionHtml"),d(b.BatchInfo,"BatchInfo"),a("MltRootHtml"),a("MltSubHtml"),a("InfoPaneHtml"),a("RedirectUrl"),g("Content"),a("BiciJsonConfig")]);b.rfc("ItemResponseInfo",[c("IsConversation"),f("View"),a("ConversationId"),a("MessageId"),e("MessageIds"),e("SenderEmails"),c("IsDedup"),a("IdentityContext"),f("PsaType"),a("PsaUrl"),g("ReadInstrumentation"),a("Html")]);b.rfc("HmAuxData",[a("Value")]);b.rfc("AdvancedSearch",[a("Keywords"),a("From"),a("To"),a("Subject"),a("Folder"),a("DateBegin"),a("DateEnd"),c("HasAttachment")]);b.rfc("MessageRenderingInfo",[a("MessageId"),c("AllowUnsafeContent"),c("OverrideCodepage"),a("MtLang"),d(b.HAD,"AuxData"),c("ConversationUpsell"),a("FolderId"),c("MarkAsRead"),a("SenderEmail")]);b.rfc("MessageListRenderingInfo",[a("FolderId"),c("QuickViewId"),c("FilterId"),f("PageDirection"),c("ExtraFetchCount"),c("PageNumCurrent"),a("AnchorId"),a("AnchorDate"),a("JumpToAnchor"),f("SortKey"),c("SortAsc"),c("IsSearchResults"),a("SearchKeyword"),d(b.AdvancedSearch,"AdvancedSearch"),c("AutoSelectMessageIndex"),f("ReadingPaneLocationMember"),c("NumberOfMessages"),a("BulkSelectAllTimestamp"),a("LastUpdateTimestamp"),c("IsFavoriteSelected")]);b.rfc("ConversationRenderingInfo",[a("ConversationId"),a("MessageId"),a("FolderId"),c("MarkAsRead"),a("SenderEmail")]);b.ListNavigateDirection=new $Flags("FirstPage",0,"LastPage",1,"NextPage",2,"PreviousPage",3,"CurrentPage",4);b.ReadingPaneLocation=new $Flags("None",0,"Off",1,"Right",2,"Bottom",3);b.rfm("ViewAllFromSender",[d("messageListRenderingInfo"),a("senderEmail")],"ViewAllFromSender",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("RestoreHiddenTrash",[d("messageListRenderingInfo")],"RestoreHiddenTrash",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("GetInboxData",[c("fetchFolderList"),c("renderUrlsInFolderList"),c("fetchMessageList"),d("messageListRenderingInfo"),c("fetchMessage"),d("messageRenderingInfo")],"GetInboxData",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("ClearFolder",[a("clearFolderId"),d("messageListRenderingInfo")],"ClearFolder",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.JmrType=new $Flags("Junk",0,"NotJunk",1,"AV",2,"SVMOptInOptOut",3,"SVMClassification",4,"Phish",5,"Unsubscribe",6,"Compromised",7,"Unknown",-1);b.rfm("MoveMessagesToFolder",[a("fromFolderId"),a("toFolderId"),e("messageList"),e("messageAuxData"),d("batchInfo"),d("messageListRenderingInfo"),c("fetchMessageList"),c("refreshFolderAndQuickViewLists"),a("folderNameForRuleSuggestion"),d("messageRenderingInfo"),d("conversationRenderingInfo"),c("fetchItem"),c("blockIfDelete")],"MoveMessagesToFolder",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("MarkMessagesForJmr",[a("folderId"),e("messagesParam"),e("auxData"),d("batchInfo"),f("jmrType"),c("setReportToJunkOK"),d("messageListRenderingInfo"),d("messageRenderingInfo"),c("refreshMessageList"),c("refreshFolderAndQuickViewLists"),f("removeFromList"),c("suppressListTransition"),c("markSenderAsSafe")],"MarkMessagesForJmr",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("__2",[c("IsBlocking"),c("YesCode"),c("NoCode"),a("Message")]);b.rfm("AddContactFromMessage",[d("messageRenderingInfo"),d("messageListRenderingInfo"),a("contactName"),a("contactEmail"),e("demandLoadContentValues")],"AddContactFromMessage",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("AddContactFromMessagePart",[a("conversationId"),a("folderId"),a("startingMid"),c("numParts"),g("mpIndexMap"),d("messageRenderingInfo"),a("contactName"),a("contactEmail"),e("demandLoadContentValues")],"AddContactFromMessagePart",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("SvmFeedback",[a("svmUrl"),d("messageRenderingInfo"),d("messageListRenderingInfo")],"SvmFeedback",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.FilterType=new $Flags("None",0,"Unread",1,"Contacts",2,"Flagged",3,"Photos",4,"Social",5,"Video",6,"File",7,"MailingList",8,"Shipping",9,"Other",10,"ResponsesToMe",11,"DocumentPlus",12);b.rfm("MarkMessagesReadState",[c("readState"),e("messages"),e("auxData"),d("batchInfo"),d("messageListRenderingInfo"),c("refreshFolderAndQuickViewLists")],"MarkMessagesReadState",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("MarkMessagesFlagState",[c("flagState"),e("messages"),e("auxData"),d("batchInfo"),d("messageListRenderingInfo"),c("refreshFolderAndQuickViewLists")],"MarkMessagesFlagState",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("SaveVoicemailOnPhone",[e("messageIdList")],"SaveVoicemailOnPhone",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("DeleteVoicemailOnPhone",[e("messageIdList")],"DeleteVoicemailOnPhone",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("GetConversationInboxData",[c("fetchFolderList"),c("renderUrlsInFolderList"),c("fetchConversationList"),d("conversationListRenderingInfo"),c("fetchConversation"),d("conversationRenderingInfo")],"GetConversationInboxData",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("MessagePartsUiData",[g("MessagePartData"),a("IdentityContext"),a("InfoPaneHtml"),a("RedirectUrl"),g("Content"),a("BiciJsonConfig")]);b.rfm("GetSingleMessagePart",[a("conversationId"),a("folderId"),d("messageRenderingInfo"),c("messagePartIndex"),c("showUnsubscribeLink")],"GetSingleMessagePart",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("GetManyMessageParts",[a("conversationId"),a("folderId"),a("startingMessageId"),c("numParts"),g("messageIdToIndexMap"),c("showUnsubscribeLink")],"GetManyMessageParts",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("GetFullMessagePart",[d("messageRenderingInfo"),c("messagePartIndex"),c("showUnsubscribeLink")],"GetFullMessagePart",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("MarkMessagePartForJmr",[c("fetchConversation"),a("cid"),a("fid"),a("startingMid"),c("numParts"),g("mpIndexMap"),d("messageListRenderingInfo"),e("mpMids"),e("mpAuxDatas"),a("mpFid"),f("jmrType"),c("setReportToJunkOK"),f("removeFromList"),c("markSenderAsSafe")],"MarkMessagePartForJmr",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("CreateMoveRule",[f("ruleNoun"),a("matchingString"),a("fid")],"CreateMoveRule",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("CreateSendersMoveRules",[e("emails"),a("fid")],"CreateSendersMoveRules",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("CreateRecipientMoveRule",[a("recipientEmail"),a("folderId"),a("folderName")],"CreateRecipientMoveRule",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("BlockSenders",[e("emails")],"BlockSenders",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("DemandLoad",[e("demandLoadContentValues")],"DemandLoad",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("UndoSenderMoveToBlockList",[a("senderAddress")],"UndoSenderMoveToBlockList",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.NounEnum=new $Flags("SendersEmailAddress",97,"SendersName",110,"Subject",115,"ToOrCCHeader",116,"HasAttachments",104);b.MessagePartDataType=new $Flags("Body",0,"ToList",1,"Message",2);b.HMLiveViewResultCode=new $Flags("Success",0,"Failure",1);b.rfc("HMLiveViewRequestObject",[a("Id"),a("Sender"),a("Type"),a("SubType"),a("Data"),a("ExtraData")]);b.rfc("HMLiveViewResponseObject",[a("Id"),f("StatusCode"),a("Html")]);b.rfm("GetHMLiveViews",[e("requests")],"GetHMLiveViews",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.MiniCalendarUiType=new $Flags("Month",0,"Day",1);b.rfc("MiniCalendarUiObject",[a("HTML"),a("DateString"),i("TargetDate"),c("IsVisible"),a("PrevMonthString"),a("NextMonthString"),a("TodayString"),f("Type")]);b.rfm("GetMiniCalendarUiObjects",[f("type"),i("targetDate"),d(b.MiniCalendarOptions,"MiniCalendarOptions"),a("uniqueIdentifier")],"GetMiniCalendarUiObjects",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("MiniCalendarOptions",[c("NumberOfPastObjects"),c("NumberOfFutureObjects"),c("NeedAdditionalDateStrings"),a("DateStart"),a("DateEnd")]);b.rfm("SaveEventMiniCalendar",[a("summary"),a("location"),i("startDate"),i("endDate"),c("isAllDay")],"SaveEventMiniCalendar",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.SandboxAuthenticationOption=new $Flags("None",0,"Oauth",1);b.rfc("SandboxRequest",[a("ID"),a("Uri"),a("Provider"),a("PostBody"),f("AuthOption"),a("AuthParam")]);b.rfc("SandboxResponse",[a("ID"),c("Status"),c("HttpStatusCode"),a("Body"),f("AuthOption"),a("AuthParam")]);b.rfm("DispatchSandboxRequests",[e("requests")],"DispatchSandboxRequests",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.ImportanceType=new $Enum("NORMAL","LOW","HIGH");b.MessageSentStateType=new $Enum("NOACTION","REPLIED","FORWARDED");b.MessageActionType=new $Flags("ViewMessage",0,"Reply",1,"ReplyAll",2,"Forward",3,"ResumeDraft",4,"GetAttachment",5,"MarkAsJunkOrNotJunk",6,"Accept",7,"Decline",8,"Tentative",9,"AcceptExchangeSharing",10,"DeclineExchangeSharing",11,"Prefetch",12,"None",13);b.rfm("SendMessage_ec",[a("to"),a("from"),a("cc"),a("bcc"),f("ImportanceType"),a("subject"),a("message"),a("messageForPlainTextConversion"),e("attachments"),a("draftId"),a("draftFolderId"),a("originalMessageId"),a("rfc822MessageId"),a("rfc822References"),a("rfc822InReplyTo"),f("MessageSentStateType"),c("sendByPlainTextFormat"),e("ignoredWordsFromSpellCheck"),a("hipAnswer"),a("hipMode"),a("meetingIcalId")],"SendMessage_ec",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("ComposeData",[e("AttachmentIdHeaders"),e("InlineIdHeaders"),a("MessageBody"),a("Subject"),a("To"),a("CC"),a("BCC"),a("From"),a("DraftId"),a("MeetingIcalId"),a("MessageId"),a("OriginalMessageId"),c("Priority"),f("SentState"),a("Rfc822InReplyTo"),a("Rfc822MessageId"),a("Rfc822References")]);b.rfm("GetComposeData",[d("renderingInfo"),f("actionType")],"GetComposeData",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("MessagePrefetchData",[e("Data")]);b.rfm("PrefetchMessages",[e("messageRenderingInfos"),e("conversationRenderingInfos")],"PrefetchMessages",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.seal();return b});window.InboxServices={Events:{endgetmessagelistpage:new $Event,preendupdateui:new $Event,endupdateui:new $Event,showbulkactionprogressui:new $Event,updatebulkactionprogressui:new $Event,closebulkactionprogressui:new $Event,endmovemessages:new $Event,endsetjunkstatus:new $Event,enddeleteallfromsender:new $Event,endmoveallfromsender:new $Event,endundosendermovetoblocklist:new $Event,sethiddenbulkselectallstate:new $Event},Operations:{MarkMessages:0,FlagMessages:1,MoveMessages:2,DeleteMessagePart:3,MarkMessagePartForJmr:4,SetJunkStatus:5},EventTypes:{onproxycompleted:"onproxycompleted",ongetfolderlist:"ongetfolderlist",ongetquickviewlist:"ongetquickviewlist",ongetmessagelist:"ongetmessagelist",ongetmessage:"ongetmessage",onbootstrapmessage:"onbootstrapmessage",ongetmessagepart:"ongetmessagepart",onstoplistening:"onstoplistening"}};InboxServices.preEndUpdateUi=function InboxServices$preEndUpdateUi(a,c,d,b){InboxServices.Events.preendupdateui.fire([a,c,d,b])};InboxServices._endUpdateUi=function InboxServices$_endUpdateUi(b,a){InboxServices.Events.endupdateui.fire([b,false,a])};InboxServices._endUpdateUiInner=function InboxServices$_endUpdateUiInner(c,a,b){InboxServices.Events.endupdateui.fire([c,a,b])};InboxServices.processPostActionInfo=function InboxServices$processPostActionInfo(d,e,c,b){var a=d.postActionInfo;if(a){if(b)a.args["onCompletionUiUpdateFn"]=b;if(c!=null)a.args["processedCount"]=c;if(a.nextActionFn&&e)a.nextActionFn(a.args,d);else a.onCompletionEvent.fire([a.args])}return a?true:false};InboxServices._processRspForBulkAction=function InboxServices$_processRspForBulkAction(b,a,f){var d=false,e=false,c=false;if(a.isBulk&&b.BatchInfo&&b.BatchInfo.IsLastBatch){c=InboxServices.processPostActionInfo(a,!InboxServices.stopAction,b.BatchInfo.ProcessedCount,f);if(!c)InboxServices.Events.closebulkactionprogressui.fire([])}else if(InboxServices.stopAction){e=true;if(a.postActionInfo)a.postActionInfo.args["processedCount"]=b.BatchInfo.ProcessedCount;InboxServices.beginRefreshInbox(true,true,a.messageListRenderingInfo,false,null,false,false,InboxServices._endBulkActionRefreshOnStop,InboxServices._bulkActionError,false,false,a)}else if(a.isBulk){InboxServices.Events.updatebulkactionprogressui.fire({count:b.BatchInfo.ProcessedCount});d=true}return {stopProcessing:e,executeNextBatch:d,postActionTaken:c}};InboxServices._endBulkActionRefreshOnStop=function InboxServices$_endBulkActionRefreshOnStop(e,a,d){var b=function(b){a["hasConfirmationMsg"]=b?true:false;InboxServices._endRefreshInbox(e,a,d)},c=InboxServices.processPostActionInfo(a,false,null,b);if(!c){InboxServices.Events.closebulkactionprogressui.fire([]);b(false)}};InboxServices._bulkActionError=function InboxServices$_bulkActionError(b,a){if(a.isHiddenBulk)InboxServices.Events.sethiddenbulkselectallstate.fire([false]);InboxServices.Events.closebulkactionprogressui.fire([]);Page.errorReportData.errorContainerOverride=ErrorDhtml;Page.errorReportData.ctx=a};InboxServices._raiseGetFolderEvent=function InboxServices$_raiseGetFolderEvent(b,a){var c=jQuery.extend({},{flHtml:b},a);jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.ongetfolderlist,c)};InboxServices._raiseGetQuickViewEvent=function InboxServices$_raiseGetQuickViewEvent(c,a){var b=jQuery.extend({},{qvHtml:c},a);jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.ongetquickviewlist,b)};InboxServices._maybeRaiseGetMessageListEvent=function InboxServices$_maybeRaiseGetMessageListEvent(b,c,a){if(b){var d=jQuery.extend({},{ml:b},c);if(a){a.mlServed=true;a.ml=b}jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.ongetmessagelist,d)}};InboxServices._maybeRaiseGetMessageEvent=function InboxServices$_maybeRaiseGetMessageEvent(b,c,a){if(b){var d=jQuery.extend({},{conversation:b},c);if(a)a.convServed=true;jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.ongetmessage,d)}};InboxServices._raiseStopListeningEvent=function InboxServices$_raiseStopListeningEvent(a){jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.onstoplistening,a)};InboxServices._raisebootstrapMessageEvent=function InboxServices$_raisebootstrapMessageEvent(a,c){if(a){var d=jQuery.extend({},{conversation:a},c),b=InboxServices.EventTypes.onbootstrapmessage;$Do.register(b,function e(){jQuery(InboxServices.Events).trigger(b,d)})}};InboxServices.getItemRenderingInfo=function InboxServices$getItemRenderingInfo(c,g){var b=c.getById(g);if(c.conv()){var f=b.conv(),d=b.id(),a=InboxPage.createConversationRenderingInfo(false);if(f)a.ConversationId=d;else a.MessageId=d}else{var i=b.id(),h=b.mad(),e=b.vm(),a=InboxPage.createMessageRenderingInfo();a.MessageId=i;a.AuxData=e||b.isDirtyMad()?null:InboxPage.createMessageAuxData(h);a.MarkAsRead="vm"!==e;if(b.ctu())a.ConversationUpsell=true}a.FolderId=c.viewType()===MessageListPage.ViewType.Folder?c.viewId():InboxPage.Config.sysFldrs.noneFid;return a};(function(){var d=window,c=d.jQuery,b=d.InboxServices,a=d.Cache,e=a.Types,t=d.HM.SortBy,xb=b.Config,r=d.InflightRequestMgr,q={read:{name:"isRead",partValueThatMarksTheWhole:false},flag:{name:"isFlagged",partValueThatMarksTheWhole:true}},f=function wb(a){return a.isFolder()},B=function rb(a){return a===d.InboxPage.Config.sysFldrs.trashFid},k=function ub(a){return a===d.InboxPage.Config.sysFldrs.junkFid},p=function mb(a){return B(a)||k(a)},y=function Z(a){return d.MessageListPage.isFolderConversationCapable(a)},o=function jb(a,b,e,g,f){b=b||d.InboxPage.Config.filters.noneFltid;var c=InboxPage.Config.sysFldrs;return a&&a!==c.draftsFid&&a!==c.sentFid&&a!==c.searchFid&&b===d.InboxPage.Config.filters.noneFltid&&e===1&&t[g]===t.Date&&!f},j=function sb(a){return o(a.viewId(),a.fltid(),a.pCur(),a.sBy(),a.sAsc())},A=function pb(b,a){return b.indexOf(a)>=0||b.getInsertIndex(a)>=0},z=function fb(a){return !a.isDelayed()},h=function L(c,d){if(c===undefined)c=true;if(d===undefined)d=true;var h=e.Conversation,i=e.Message,f=[],g=[];a.each(function(b,a){switch(a.type){case h:f.push(a.data.id());break;case i:g.push(a.data.id())}},null,true);if(c)for(var b=f.length-1;b>=0;b--)a.invalidateConversationById(f[b]);if(d)for(b=g.length-1;b>=0;b--)a.invalidateMessageById(g[b])},x=function W(){var b=a.getMessageListPages(false);c.each(b,function(c,b){a.invalidateMessageListPage(b.viewId(),b.pCur())})},m=function N(d,b,g,f,e){var c=a.getMessageListPage(d,b,false);if(c)if(!o(d,e,b,g,f)){a.invalidateMessageListPage(d,b);c=null}return c},i=function qb(e){var d=a.getMessageListPages(false),b=[];c.each(d,function f(c,a){if(a.containsId(e))b.push(a)});return b},w=function S(f){var b=null,d=e.Conversation;a.each(function(g,a){if(a.type==d){var e=a.data;if(c.inArray(e.messageIds(),f)){b=e.id();return false}}},null,true);return b},n=function ib(f,d){if(d.conv()&&!y(d.viewId())){var b=w(f);if(b){a.invalidateConversationById(b);var e=i(b);c.each(e,function(c,b){a.invalidateMessageListPage(b.viewId(),b.pCur())})}else x()}},C=function tb(d){var b=e.Conversation,c=e.Message;a.each(function(f,a){switch(a.type){case b:case c:var e=a.data;if(e.id()===d)e.showsTagging(false)}},null,true)},s=function vb(i,c,d,h){C(i);var r=p(h),g={invalidateSource:false,invalidateTarget:true},b=c.getById(i),n=c.viewId(),s=n!==h&&(k(n)||k(h));if(s){var o=e.Conversation,q=e.Message,l=null,j=null;a.each(function(g,c){var d=c.type,b=d===o,e=d===q;if(b||e){var a=c.data.id();if(a===i){if(b)j=a;else l=a;return false}}},null,true);if(l)a.invalidateMessageById(l);else if(j)a.invalidateConversationById(j)}if((f(c)||p(h))&&(!b||!c.removeItem(b)))g.invalidateSource=true;if(!g.invalidateSource&&d)if(c.viewId()===d.viewId()||d.containsId(i))g.invalidateTarget=false;else{var m=d.getInsertIndex(b);if(m>=0){var t=d.insertItem(b,m);g.invalidateTarget=!t;b.origIndex(-1);b.showsFlagUi(!r);b.invalidateMad()}}return g},g=function hb(d,g,j,h){var b=g.getById(d),k=null;if(b)var k=b[j];if(k)k.call(b,h);var l=i(d),a,e;c.each(l,function(c,b){if(b!==g&&f(b)){a=b.getById(d);if(a){e=a[j];if(e)e.call(a,h)}}});n(d,g);return b},u=function G(f,o,i,k,e,d){var j=g(f,o,e,d),c=null;if(j)c=i&&i.id()===f?i:j.conv()?a.getConversationByIdAndView(f,k,false,true):a.getMessageById(f,false,true);if(c){var h=false;if(!c.hasDom())h=true;else{var n=e==="flag"&&d,l=e==="read"&&!d,m=q[e].name;c.each(function(b,a){a[m](d);if(l&&!a.hasBody(a.defaultBodyType())){h=true;return false}if(n)return false})}if(h)b.invalidateConversationOrMessage(c);c.refreshCounts()}},v=function P(i,f,d,b,c){var l=q[b],k=l.name,e=l.partValueThatMarksTheWhole,m=d.getById(i);if(m){m[k](c);var j=false;d.each(function(b,a){if(a[k]()==e){j=true;return false}});var n=j?e:!e,h=d.id(),a=f.getById(h);if(!a||a[b]()!=n)g(h,f,b,c);if(h!==i){a=f.getById(i);if(a&&a[b]()!=c)a[b](c)}d.refreshCounts()}},l=function D(p,b,e,t,q){var u=b.viewId(),v=b.pCur(),h=false,l=false,g=m(e,t,b.sBy(),b.sAsc());if(p&&p.length>0)if(u!==e||e===d.InboxPage.Config.sysFldrs.trashFid){if(q)q();var k=null,r=[];c.each(p,function(m,d){k=s(d,b,g,e);if(!f(b)){var j=i(d);c.each(j,function(i,c){if(c!==b&&c!==g&&f(c)){var h=s(d,c,g,e);if(h.invalidateSource&&!r.contains(c)){r.push(c);a.invalidateMessageListPage(c.viewId(),c.pCur())}if(h.invalidateTarget)l=true}})}n(d,b);if(k.invalidateTarget)l=true;if(k.invalidateSource)h=true})}if(l&&g){a.invalidateMessageListPage(e,t);g=null}if(!j(b))b=null;else{if(!h){var o=b.count(),x=d.InboxPage.Config.pageSize;if(o>0&&o<=x){var w=b.getItem(o-1);if(!w.eof())h=true}}if(h){a.invalidateMessageListPage(u,v);b=null}}return b};b.getConversationViewType=function gb(e){var c=d.InboxPage.Config.sysFldrs,b=d.Conversation.ViewTypes,a;switch(e){case c.trashFid:a=b.Deleted;break;case c.junkFid:a=b.Junk;break;default:a=b.Normal}return a};b.maybeCacheMessageListPage=function cb(b){var c=false;if(j(b)){a.setMessageListPage(b,null,b.viewId(),b.pCur());c=true}else if(f(b))a.invalidateMessageListPage(b.viewId(),b.pCur());return c};b.invalidateConversationOrMessage=function R(b){var c=b.id();if(b.isConversation())a.invalidateConversationById(c);else a.invalidateMessageById(c)};b.maybeCacheConversation=function lb(c,d){d=d||{};if(z(c)){var e=c.id(),g=c.senders();if(c.isConversation())a.setConversation(c,d,e,c.viewType(),g);else a.setMessage(c,d,e,g[0]);var f=c.cid()||c.secretCid();if(f)r.onConversationAvailable(c,d,f,c.viewType());if(c.mid())r.onMessageAvailable(c,d,e)}else b.invalidateConversationOrMessage(c)};b.bootstrapConversation=function nb(a,c){b.maybeCacheConversation(a,c);b._raisebootstrapMessageEvent(a)};b.createInboxUiDataFixupInfo=function bb(a){return c.extend({mlServed:false,convServed:false},a)};b.maybeCacheInboxUiDataAndRaiseEvent=function O(c,d,t){var e=d.cacheFixupInfo||{};if(!c)return;var o=c.FolderListHtml;if(o){InboxServices._raiseGetFolderEvent(o,{ctx:d});c.FolderListHtml=""}var m=c.QuickViewListHtml;if(m){InboxServices._raiseGetQuickViewEvent(m,{ctx:d});c.QuickViewListHtml=""}var j=c.MessageListHtml;if(j){var i=d.messageListRenderingInfo,k=/pCur="(\d)"/.exec(j);if(k&&k.length===2){var n=k[1];if(n!=i.PageNumCurrent)i.PageNumCurrent=n}var g=c.MltRootHtml,h=c.MltSubHtml,l=e.titleInfo;if(l){g=g?g:l.rootTitle;h=h?h:l.subTitle}var f=new MessageListPage(null,j,i,g,h);f.setupElement();f.each(function(e,c){if(c.conv()){var d=a.getConversationByIdAndView(c.id(),b.getConversationViewType(f.viewId()),false,true);if(d&&c.count()>d.count())a.invalidateConversationById(c.id())}},null);c.MessageListHtml="";if(!d.dontCacheMessageList)b.maybeCacheMessageListPage(f);if(!e.mlServed)b._maybeRaiseGetMessageListEvent(f,{ctx:d},e)}var r=c.MessageHtml;if(r){var p=!!c.SuggestionHtml,s=!!d.prefetchMessageOnly,q=new Conversation(r,c.ItemInfo,null,null);c.MessageHtml="";InboxServices.maybeCacheConversation(q,{hasSuggestion:p,prefetched:s});if(!s&&!e.convServed)InboxServices._maybeRaiseGetMessageEvent(q,{ctx:d,hasSuggestion:p},e)}InboxServices._raiseStopListeningEvent({ctx:d,isInterrupted:!!t})};b.getCachedPageFromRenderingInfo=function V(a){return m(a.FolderId,parseInt(a.PageNumCurrent),a.SortKey||"Date",a.SortAsc,a.FilterId)};b.getCachedConversationFromRenderingInfo=function K(a){var c=!!a.ConversationId,d=a.ConversationId||a.MessageId;return b.getCachedConversation(d,c,a.FolderId,true,true)};b.getCachedConversation=function ob(f,g,h,d,e){var c=null;if(g)c=a.getConversationByIdAndView(f,b.getConversationViewType(h),d,e);else c=a.getMessageById(f,d,e);return c};b.conversationAvailableInCache=function Y(c,f,e){var d=c.data,a=c.metaData;if(a.hasSuggestion)b.invalidateConversationOrMessage(d);b._maybeRaiseGetMessageEvent(d,{ctx:f,hasSuggestion:a.hasSuggestion,fromCache:true,prefetched:a.prefetched},e)};b.fixupCacheForShowContentOnMessagePart=function M(c,b){if(!!b.AllowUnsafeContent)a.invalidateConversationById(c)};b.fixupCacheForShowContentOnMessage=function Q(b){if(!!b.AllowUnsafeContent)a.invalidateMessageById(b.MessageId)};b.fixupMessageListPagesWhenMarkingAsRead=function J(c,a,b){g(c,a,"read",b)};b.fixupCacheForMarkAsActionsAndRaiseEvent=function I(o,j,i,m,p,d,e,k){if(o){d.each(function(b,a){g(a.id(),d,j,i)});if(f(d)){var l=d.viewId(),q=a.getMessageListPage(l,1,false);if(q)a.invalidateMessageListPage(l,1)}h()}else{var n=b.getConversationViewType(m.FolderId);if(k)k();c.each(p,function(c,a){var b=d.getById(a);if(b&&(!e||b.conv()===e.isConversation()))u(a,d,e,n,j,i);else v(a,d,e,j,i)})}};b.fixupCacheForMessageListItemMovesAndRaiseEvent=function F(s,g,k,t,i,e,o){var n=false,q=g.viewId();if(s){var p=a.getMessageListPages(false),r=MessageListPage.ViewType;c.each(p,function(d,b){var c=b.viewId();if(r.Folder===b.viewType()&&(q===c||k===c))a.invalidateMessageListPage(c,b.pCur())})}else{var m=1;if(g.conv())a.invalidateMessageListPage(k,m);var d=l(t,g,k,m,o);if(d)if(d.count()===0)a.invalidateMessageListPage(d.viewId(),d.pCur());else if(!i.mlSkipServe){i.mlServed=true;b._maybeRaiseGetMessageListEvent(d,{ctx:e},i);n=true}if(e){var j=InboxPage.messageList,f=e.messageRenderingInfo||e.conversationRenderingInfo;if(f){if(g.containsId(f.MessageId||f.ConversationId))j.selectItemByRenderingInfo(f)}else{var h=e.messageListRenderingInfo;if(h&&h.AutoSelectMessageIndex!=-1)j.selectByIndex(h.AutoSelectMessageIndex,true,true);else j.clearSelection()}}}return n};b.fixupCacheForMessagePartMoves=function X(f,n,e,g){var j=function(){var b=Conversation.ViewTypes,a=[];a[b.Normal]={};a[b.Deleted]={};a[b.Junk]={};return a}(),k=a.getMessageListPages(false),d=e.getById(f),m=e.viewId();if(!d){a.invalidateMessageListPage(e.viewId(),e.pCur());c.each(k,function p(c,b){if(b.getById(f)||b.viewId()===g)a.invalidateMessageListPage(b.viewId(),b.pCur())});d=e.getById(n);if(d)e.removeItem(d)}else if(m!==g){var l=b.getConversationViewType(e.viewId()),i=d.count()-1;d.count(i);var h=j[l];h.adjusted=true;h.count=i;c.each(k,function o(o,e){var k=false,h=e.viewId();if(h===g&&!e.containsId(f)&&A(e,d))k=true;else if(e.containsId(f)){var n=b.getConversationViewType(h),i=j[n],c=i.count,l=e.getById(f),m=l.count();if(c===1)k=true;else if(h===g){c=m+1;l.count(c);i.adjusted=true;i.count=c}else if(i.adjusted)if(m!==c)l.count(c)}if(k)a.invalidateMessageListPage(h,e.pCur())})}a.invalidateConversationById(f)};b.invalidateConversationsAndMessagesBySender=function H(d){var e=a.getMessagesBySender(d,false).concat(a.getConversationsBySender(d,false));c.each(e,function(c,a){b.invalidateConversationOrMessage(a)})};b.fixupCacheWhenAddingContact=function ab(a,e,g){var c=d.InboxPage.Config.sysFldrs;if(f(a)&&a.viewId()===c.junkFid)l([e.id()],a,c.inboxFid,1,null);b.invalidateConversationsAndMessagesBySender(g)};b.fixupCacheForAutoRefresh=function db(b,d){if(!b.conv()||(d===null||d===""))return;var c=false;if(b.sAsc())c=true;else{var e=-1;b.each(function(a,b){if(d>b.mdt()){e=a;return false}});if(e>=0){var f;for(var g=e-1;g>=0;g--){f=b.getItem(g);if(f.conv())a.invalidateConversationById(f.id())}}else c=true}if(c)h(true,false)};b.fixupCacheForPsaMessages=function eb(f,b){var c=e.Conversation,d=e.Message;a.each(function(i,e){var a=e.data,g=e.type;if((g===c||g===d)&&(a.showsPsa()&&a.psaType()===f)&&(b?b!==a:true))a.showsPsa(false)},null,true)};b.fixupCacheForFolderListChanges=function U(e,g,b){var d=b.cacheFixupInfo.ml;if(!e||!d)return;var f=c(e),h=c(g);c.each(f.find("li[id]"),function(n,m){var f=c(m),e=f.attr("id"),j=h.find("li[id='{0}']".format(e)),i=parseInt(f.attr("count")),k=parseInt(j.attr("count")),g=k!==i,l=d&&d.viewId()===e&&(b.isAutoRefresh||b.isBulk);if(g&&!l)a.invalidateMessageListPage(e,1)})};b.fixupCacheForAutoSelectIndexMessageAndMoveAction=function E(r,l,e,q,o,g){var j=false,k=null,p=null,d=o?o.AutoSelectMessageIndex:-1;if(!r&&d>=0){j=true;var i;if(e&&e.isAttached())if(e.count()===1&&e.doesIdBelongTo(q[0]))i=e.id();var n=false,f=[];l.each(function(d,b){if(b.eof())n=true;var a=b.id();if(!f[a]&&i!==a&&c.inArray(a,q)===-1){f.push(a);f[a]=a}});var h=f.length;if(n&&h==0){d=-1;j=false}else if(n||d<h){d=Math.min(d,h-1);k=f[d];var m=l.getById(k);p=m.conv()?a.getConversationByIdAndView(m.id(),b.getConversationViewType(l.viewId()),g,g):a.getMessageById(m.id(),g,g)}}return {isMessageNeeded:j,guidNeeded:k,convMsg:p,actionOnLastConversationPart:!!i}};b.fixupCacheForConversationMoves=function T(d,f,e,k,l){if(f||d){if(!d){var g=b.getCachedConversationFromRenderingInfo(f);if(g)d=g.data}if(d&&d.containsAnyId(e))a.invalidateConversationById(d.cid())}var j=b.getConversationViewType(k),i=b.getConversationViewType(l);if(j!==i)if(e)c.each(e,function(d,b){var c=a.getConversationByIdAndView(b,i,false,false);if(c)a.invalidateConversationById(b)});else h(true,false)};b.fixupCacheAfterCompose=function kb(i,c,d,h){var e=HM.MessageActionType,g=d.conv();if(g){if(j(d))a.invalidateMessageListPage(d.viewId(),d.pCur())}else if(c){var f=i?d.getById(i):null;if(f)if(c===e.Reply||c===e.ReplyAll)f.rpl(true);else if(c===e.Forward)f.fwd(true)}if(h&&(g||c==e.ResumeDraft))b.invalidateConversationOrMessage(h)}})();(function(){var c=window,i=c.jQuery,b=c.ActionQueue,e=c.ActionQueueTypes.ActionType,d=c.Cache,a=c.InboxServices,f=a.Events,g=c.InflightRequestMgr;a.beginViewAllFromSender=function n(d,f,i){var g=a.createInboxUiDataFixupInfo(),c=b.getToken("ViewAllFromSender",e.view,[f],a._endRefreshInbox),h=function j(){HM.ViewAllFromSender(d,f,c.getSuccessCallback(),{showItemList:false,messageListRenderingInfo:d,cacheFixupInfo:g,id:i},c.getFailureCallback())};b.addToken(c,h)};a.beginBlockSenders=function q(b,c){HM.LFPP=function(){HM.BlockSenders(b.senders,a._endBlockSenders,c,a._bulkActionError)};HM.LFPP()};a._endBlockSenders=function t(c,b){if(b.postActionInfo){b.postActionInfo.args["unblockedSndrs"]=c;a.processPostActionInfo(b,false,null,null)}};a.beginCreateSendersMoveRules=function k(b,c){HM.LFPP=function(){HM.CreateSendersMoveRules(b.senders,b.toFldr,a._endCreateSendersMoveRules,c,a._bulkActionError)};HM.LFPP()};a._endCreateSendersMoveRules=function m(d,b){if(b.postActionInfo){b.postActionInfo.args["rulesCreated"]=true;a.processPostActionInfo(b,false,null,null)}};a.beginRefreshInbox=function r(v,l,c,j,f,D,B,E,C,q,r,h,H){var n=a.createInboxUiDataFixupInfo({callback:E,errorCallback:C}),A=c?c.BulkSelectAllTimestamp!=null:false;h=i.extend({},h,{showItemList:D,isAutoRefresh:q,ignoreCache:r,messageListRenderingInfo:c,itemRenderingInfo:f,cacheFixupInfo:n,maintainCurrentSelection:A,id:H});if(c!=null&&c.SearchKeyword!=null)c.SearchKeyword=c.SearchKeyword.replace(/"/g,"&quot;");var x=null;if(j){if(f)x=[f.ConversationId,f.FolderId,f.MessageId];var y=false,s=function I(b){a.conversationAvailableInCache(b,h,n);if(y){a._raiseStopListeningEvent({ctx:h});a._endRefreshInbox(null,h,null)}},t=a.getCachedConversationFromRenderingInfo(f),o=false;if(t)s(t);else if(f.ConversationId)o=g.registerForConversation(f.ConversationId,a.getConversationViewType(f.FolderId),s);else o=g.registerForMessage(f.MessageId,s);j=j&&!t&&!o}if(l&&c&&c.FolderId){var p=false,k=a.getCachedPageFromRenderingInfo(c);if(k){if(q||r)p=true;else{var m=c.AutoSelectMessageIndex;if(!j&&!isNaN(m)&&m!==-1&&k.countNormal()>m){var u=k.getItem(m),z=u.conv()?d.getConversationByIdAndView(u.id(),a.getConversationViewType(k.viewId()),true,true):d.getMessageById(u.id(),true,true);if(z)a.conversationAvailableInCache(z,h,n);else p=true}}if(p)d.invalidateMessageListPage(k.viewId(),k.pCur());else{a._maybeRaiseGetMessageListEvent(k,{ctx:h},n);l=false}}x=c?[c.FolderId]:null}if(!q&&!r&&!j&&!l)v=false;if(v||j||l){var G=B?HM.GetConversationInboxData:HM.GetInboxData,w=b.getToken("refreshInbox",e.view,x,a._endRefreshInbox,a._endRefreshInboxError),F=function J(){G(v,false,l,c,j,f,w.getSuccessCallback(),h,w.getFailureCallback())};b.addToken(w,F)}else if(o)y=true;else{a._raiseStopListeningEvent({ctx:h});a._endRefreshInbox(null,h,null)}};a._endRefreshInbox=function u(c,b,d){a.maybeCacheInboxUiDataAndRaiseEvent(c,b);if(a._processEndRefreshCallbacks(arguments,false))return;a._endUpdateUi(c,b,d);if(b.showItemList)InboxPage.showFullReadingPane(false)};a._endRefreshInboxError=function p(c,b){a.maybeCacheInboxUiDataAndRaiseEvent(c,b,true);a._processEndRefreshCallbacks(arguments,true)};a._processEndRefreshCallbacks=function j(c,d){var b=false,a=c[1].cacheFixupInfo;if(a){var f=a.callback,e=a.errorCallback;if(!d&&f){a.callback=null;f.apply(null,c);b=true}else if(d&&e){a.errorCallback=null;e.apply(null,c);b=true}}return b};a._endGetMessageListPage=function o(c,b){b.maintainCurrentSelection=true;a._endUpdateUiInner(c,true,b);f.endgetmessagelistpage.fire([])};a._endGetMessageListPageError=function l(){f.endgetmessagelistpage.fire([])};a.beginClearFolder=function s(f,c,k){var i=a.createInboxUiDataFixupInfo();d.invalidateMessageListPage(f,1);if(c&&c.FolderId&&c.FolderId!==f)d.invalidateMessageListPage(c.FolderId,1);var g=b.getToken("ClearFolder",e.async,[f],h),j=function l(){HM.ClearFolder(f,c,g.getSuccessCallback(),{id:k,messageListRenderingInfo:c,cacheFixupInfo:i},g.getFailureCallback())};b.addToken(g,j)};var h=function v(c,b){a.maybeCacheInboxUiDataAndRaiseEvent(c,b);a._endUpdateUi.apply(null,arguments)}})();(function(){var d=window,A=d.jQuery,b=d.ActionQueue,c=d.ActionQueueTypes.ActionType,a=d.InboxServices,f=a.Events,e=a.Operations,g=d.InflightRequestMgr,m=d.Cache,j=function n(){var a=null,b=d.InboxPage.readingPane;if(b.isShowingMessage())a=b.cv;return a};a.beginMarkMessages=function v(q,h,w,r,t,k,o,m,p,x){var l=a.createInboxUiDataFixupInfo();l.sourcePage=q;var g=null!=r;if(!g&&h.length==0)return;InboxPage.maybeDisableRefreshForReadAction();if(g){var s=k?d.InboxPage.Strings.bulkProgressUiRead:d.InboxPage.Strings.bulkProgressUiUnread;f.showbulkactionprogressui.fire({isMark:true,actionOrFldr:Page.decode(s)})}var u=j();a.fixupCacheForMarkAsActionsAndRaiseEvent(g,"read",k,m,h,q,u,function z(){a.preEndUpdateUi(null,e.MarkMessages,{mids:h,isBulk:g,asRead:k,markingDuplicates:p},l.sourcePage);l.alreadyCalledPreEndUpdate=true});var n=ActionQueue.getToken("MarkMessagesReadState",g?c.blocking:c.async,h,i,g?a._bulkActionError:null),v=function y(){HM.MarkMessagesReadState(k,h,w,r,m,o,n.getSuccessCallback(),{messages:h,isBulk:g,isHiddenBulk:t,asRead:k,messageListRenderingInfo:m,refreshFolderAndQuickViewLists:o,markingDuplicates:p,cacheFixupInfo:l,id:x},n.getFailureCallback())};b.addToken(n,v)};var i=function y(f,d,l){var h=d.cacheFixupInfo,j=a._processRspForBulkAction(f,d,null);if(j.stopProcessing)return;if(j.executeNextBatch){var g=b.getToken("MarkMessagesReadStateLoop",c.blocking,null,i,a._bulkActionError),k=function m(){HM.MarkMessagesReadState(d.asRead,null,null,f.BatchInfo,d.messageListRenderingInfo,d.refreshFolderAndQuickViewLists,g.getSuccessCallback(),d,g.getFailureCallback())};b.addToken(g,k);return}if(!h.alreadyCalledPreEndUpdate)a.preEndUpdateUi(f,e.MarkMessages,{mids:d.messages,isBulk:d.isBulk,asRead:d.asRead,markingDuplicates:d.markingDuplicates},h.sourcePage);a.maybeCacheInboxUiDataAndRaiseEvent(f,d);a._endUpdateUi(f,d,l)};a.beginFlagMessages=function u(p,s,i,u,q,j,n,l,o,v){var k=a.createInboxUiDataFixupInfo();k.sourcePage=p;var g=null!=q;if(!g&&i.length==0)return;InboxPage.maybeDisableRefreshForFlagAction();if(g){var r=j?d.InboxPage.Strings.bulkProgressUiFlag:d.InboxPage.Strings.bulkProgressUiUnflag;f.showbulkactionprogressui.fire({isMark:true,actionOrFldr:Page.decode(r)})}a.fixupCacheForMarkAsActionsAndRaiseEvent(g,"flag",j,l,i,p,s,function x(){a.preEndUpdateUi(null,e.FlagMessages,{mids:i,isBulk:g,asFlagged:j,flaggingDuplicates:o},k.sourcePage);k.alreadyCalledPreEndUpdate=true});var m=ActionQueue.getToken("MarkMessagesFlagState",g?c.blocking:c.async,i,h,g?a._bulkActionError:null),t=function w(){HM.MarkMessagesFlagState(j,i,u,q,l,n,m.getSuccessCallback(),{messages:i,isBulk:g,asFlagged:j,messageListRenderingInfo:l,refreshFolderAndQuickViewLists:n,flaggingDuplicates:o,cacheFixupInfo:k,id:v},m.getFailureCallback())};b.addToken(m,t)};var h=function x(f,d,l){var i=d.cacheFixupInfo,j=a._processRspForBulkAction(f,d,null);if(j.stopProcessing)return;if(j.executeNextBatch){var g=b.getToken("MarkMessagesFlagStateLoop",c.blocking,null,h,a._bulkActionError),k=function m(){HM.MarkMessagesFlagState(d.asFlagged,null,null,f.BatchInfo,d.messageListRenderingInfo,d.refreshFolderAndQuickViewLists,g.getSuccessCallback(),d,g.getFailureCallback())};b.addToken(g,k);return}if(!i.alreadyCalledPreEndUpdate)a.preEndUpdateUi(f,e.FlagMessages,{mids:d.messages,isBulk:d.isBulk,asFlagged:d.asFlagged,flaggingDuplicates:d.flaggingDuplicates},i.sourcePage);a.maybeCacheInboxUiDataAndRaiseEvent(f,d);a._endUpdateUi(f,d,l)};a.beginMoveMessages=function w(o,B,j,T,O,M,k,i,q,C,Q,H,r,J,h,m,x,y,L,F){var l=a.createInboxUiDataFixupInfo({sourcePage:o}),n=null!=O;if(!n&&j.length==0){a._raiseStopListeningEvent({ctx:{id:F}});return}var K=k==d.InboxPage.Config.sysFldrs.trashFid;if(!K&&k==i){if(M)f.sethiddenbulkselectallstate.fire([false]);if(C)a.processPostActionInfo({postActionInfo:C},true,0,null);a._raiseStopListeningEvent({ctx:{id:F}});return}if(n){var P=K&&k==i,R=y&&y.folderName?y.folderName:FolderQuickViewListHelper.getFolderNameByFid(i);f.showbulkactionprogressui.fire({isMark:false,actionOrFldr:R,isPermanentDelete:P,customUi:y})}Page.setPerformanceId("Move");var A=null;if(Q)A=FolderQuickViewListHelper.getFolderNameByFid(i);var u=null,t=null;x=!!x;var p={msgs:j,fromFid:k,toFid:i,isBulk:n,isHiddenBulk:M,messageListRenderingInfo:q,refreshFolderAndQuickViewLists:H,folderNameForRuleSuggestion:A,postActionInfo:C,fetchMessageList:r,messageRenderingInfo:u,conversationRenderingInfo:t,fetchItem:m,blockIfDelete:x,movingDuplicates:L,cacheFixupInfo:l,id:F},G=false,I=r&&q.AutoSelectMessageIndex!=-1,v=a.fixupCacheForAutoSelectIndexMessageAndMoveAction(n,o,B,j,q,false,l,p);if(v.isMessageNeeded){if(!h){p.itemRenderingInfo=h=InboxServices.getItemRenderingInfo(o,v.guidNeeded);if(J){a.fixupCacheForConversationMoves(v.convMsg,h,j,k,i);if(!v.actionOnLastConversationPart&&B&&B.containsId(j[0])){q.AutoSelectMessageIndex=-1;G=true}}}}else a.fixupCacheForConversationMoves(null,null,j,k,i);if(J)p.conversationRenderingInfo=t=h;else p.messageRenderingInfo=u=h;var N=a.fixupCacheForMessageListItemMovesAndRaiseEvent(n,o,i,j,l,p,function W(){InboxServices.preEndUpdateUi(null,e.MoveMessages,{mids:j,isBulk:n,toFid:i,fromFid:k,movingDuplicates:L,itemRenderingInfo:h},o);l.alreadyCalledPreEndUpdate=true});$BSI.informPVHead();$BSI.informLoaded(true);if(N)r=false;var z=false;if(m||I&&h){var D=function U(b){a.conversationAvailableInCache(b,p,l)},w=a.getCachedConversationFromRenderingInfo(h);if(w)D(w);else if(h.ConversationId)z=g.registerForConversation(h.ConversationId,a.getConversationViewType(h.FolderId),D);else z=g.registerForMessage(h.MessageId,D);m=m&&!w&&!z;if(!m&&I&&(N||G)&&!w&&!z)m=true}if(r&&!m)t=u=null;l.titleInfo={};var s=o.rootTitle();l.titleInfo.rootTitle=s?s:null;s=o.subTitle();l.titleInfo.subTitle=s?s:"";var E=ActionQueue.getToken("MoveMessagesToFolderFromMessage",n?c.blocking:c.async,[k,i].concat(j),a._endMoveMessages,n?a._bulkActionError:null),S=function V(){HM.MoveMessagesToFolder(k,i,j,T,O,q,r,H,A,u,t,m,x,E.getSuccessCallback(),p,E.getFailureCallback())};b.addToken(E,S)};a._endMoveMessages=function z(h,g,l){var m=g.cacheFixupInfo;if(l)g.postActionInfo.args["unblockedSndrs"]=l;var j=function(b){g["hasConfirmationMsg"]=!!b;if(!m.alreadyCalledPreEndUpdate)a.preEndUpdateUi(h,e.MoveMessages,{mids:g.msgs,isBulk:g.isBulk,toFid:g.toFid,fromFid:g.fromFid,itemRenderingInfo:g.messageRenderingInfo||g.conversationRenderingInfo,movingDuplicates:g.movingDuplicates},m.sourcePage);a.maybeCacheInboxUiDataAndRaiseEvent(h,g);a._endUpdateUi(h,g);f.endmovemessages.fire([h])},i=a._processRspForBulkAction(h,g,j);if(i.stopProcessing)return;if(i.executeNextBatch){var k=b.getToken("MoveMessagesToFolderLoop",c.blocking,null,a._endMoveMessages,a._bulkActionError),o=function p(){HM.MoveMessagesToFolder(g.fromFid,g.toFid,null,null,h.BatchInfo,g.messageListRenderingInfo,g.fetchMessageList,g.refreshFolderAndQuickViewLists,g.folderNameForRuleSuggestion,g.messageRenderingInfo,g.conversationRenderingInfo,g.fetchItem,g.blockIfDelete,k.getSuccessCallback(),g,k.getFailureCallback())};b.addToken(k,o);return}else if(!g.isBulk&&g.blockIfDelete&&g.fromFid==d.InboxPage.Config.sysFldrs.junkFid){var n=g.msgs.length;g.postActionInfo.args["blockFromJunk"]=1;i.postActionTaken=a.processPostActionInfo(g,!a.stopAction,n,j)}if(!i.postActionTaken)j()};a.beginCreateMoveRule=function r(f,d,h,e,i){var a=b.getToken("CreateMoveRule",c.async,null,e),g=function j(){HM.CreateMoveRule(f,d,h,a.getSuccessCallback(),{id:i},a.getFailureCallback())};b.addToken(a,g)};a.beginAddContactFromMessage=function o(l,n,g,f,j,d,m,p){var h=DemandLoadHandler.createFppCallback(m,null),i=a.createInboxUiDataFixupInfo({callback:h});a.fixupCacheWhenAddingContact(l,n,d);var e=b.getToken("AddContactFromMessage",c.async,[g.MessageId,d],k),o=function q(){HM.AddContactFromMessage(g,f,j,d,DemandLoadHandler.filterFetchedContentIds([HM.ContentId.ReadMessageAddContact]),e.getSuccessCallback(),{messageListRenderingInfo:f,id:p,cacheFixupInfo:i},e.getFailureCallback())};b.addToken(e,o)};var k=function p(d,c){var f=arguments,b=c.cacheFixupInfo,e=b.callback;b.callback=null;a.maybeCacheInboxUiDataAndRaiseEvent(d,c);e.apply(null,f)};a.beginGetComposeData=function s(a,e,g){var d=b.getToken("GetComposeData",c.view,[a.FolderId,a.MessageId],l),f=function h(){HM.GetComposeData(a,e,d.getSuccessCallback(),{actionType:e,messageRenderingInfo:a,csiPerfTrace:InboxPage.composeFrame.getCsiPerfTrace(),id:g},d.getFailureCallback())};b.addToken(d,f)};var l=function t(b,a){InboxServices._raiseStopListeningEvent({ctx:a});InboxPage.composeFrame.show(b,a.actionType,a.messageRenderingInfo,false,a.csiPerfTrace)};a.beginRestoreHiddenTrash=function q(d,h){var f=a.createInboxUiDataFixupInfo();m.invalidateMessageListPage(d.FolderId,d.PageNumCurrent);var e=b.getToken("RestoreHiddenTrash",c.view,null,a._endRefreshInbox),g=function i(){HM.RestoreHiddenTrash(d,e.getSuccessCallback(),{showItemList:false,messageListRenderingInfo:d,dontCacheMessageList:true,cacheFixupInfo:f,id:h},e.getFailureCallback())};b.addToken(e,g)}})();(function(){var d=window,m=d.jQuery,a=d.InboxServices,n=d.Cache,b=d.ActionQueue,c=d.ActionQueueTypes.ActionType,e=function f(f,c){var e=arguments,b=c.cacheFixupInfo,d=b.callback;b.callback=null;a.maybeCacheInboxUiDataAndRaiseEvent(f,c);d.apply(null,e)};a.beginGetSingleMessagePart=function i(f,m,g,k,h,j,n){var i=a.createInboxUiDataFixupInfo({callback:j});a.fixupCacheForShowContentOnMessagePart(f,g);var d=b.getToken("GetSingleMessagePart",c.view,[f],e),l=function o(){HM.GetSingleMessagePart(f,m,g,k,h==true,d.getSuccessCallback(),{cacheFixupInfo:i,id:n},d.getFailureCallback())};b.addToken(d,l)};a.beginGetFullMessagePart=function k(g,d,k,h,j,m){var i=a.createInboxUiDataFixupInfo({callback:j});if(g)a.fixupCacheForShowContentOnMessagePart(g,d);else a.fixupCacheForShowContentOnMessage(d);var f=b.getToken("GetFullMessagePart",c.view,[d.MessageId,d.SenderEmail],e),l=function n(){HM.GetFullMessagePart(d,k,h,f.getSuccessCallback(),{cacheFixupInfo:i,id:m},f.getFailureCallback())};b.addToken(f,l)};a.beginGetManyMessageParts=function j(d,k,g,i,f,e,h,l){var a=b.getToken("GetManyMessageParts",c.view,[d],h),j=function m(){HM.GetManyMessageParts(d,k,g,i,f,e==true,a.getSuccessCallback(),{id:l},a.getFailureCallback())};b.addToken(a,j)};a.beginDeleteMessagePart=function l(l,o,f,p,j,i,m,q){var k=a.createInboxUiDataFixupInfo({callback:m}),g=d.InboxPage.Config.sysFldrs.trashFid;a.fixupCacheForMessagePartMoves(o,f,l,g);var h=b.getToken("MoveMessagesToFolderFromMessagePart",c.async,[j,g,f],e),n=function r(){HM.MoveMessagesToFolder(j,g,[f],[p],null,i,false,false,null,null,null,false,false,h.getSuccessCallback(),{mid:f,messageListRenderingInfo:i,id:q,cacheFixupInfo:k},h.getFailureCallback())};b.addToken(h,n)};a.beginMarkMessagePartForJmr=function g(k,j,i,n,s,w,t,d,g,u,m,f,o,r,p,v,y){var q=a.createInboxUiDataFixupInfo({callback:v}),l=a.getFidForJmrType(f,k.viewId());a.fixupCacheForMessagePartMoves(i,g,k,l);var h=b.getToken("MarkMessagePartForJmr",c.async,[i,n,l,d?d.SenderEmail:null],e),x=function z(){HM.MarkMessagePartForJmr(j,i,n,s,w,t,d,[g],[u],m,f,o,r,p,h.getSuccessCallback(),{fetchConversation:j,jmrType:f,mpFid:m,mpMid:g,messageListRenderingInfo:d,id:y,cacheFixupInfo:q},h.getFailureCallback())};b.addToken(h,x)};a.beginAddContactFromMessagePart=function h(p,j,i,n,r,o,v,g,m,d,q,t){var h=j.id(),k=DemandLoadHandler.createFppCallback(q,null),l=a.createInboxUiDataFixupInfo({callback:k});a.fixupCacheWhenAddingContact(p,j,d);var f=b.getToken("AddContactFromMessagePart",c.async,[h,d],e),s=function u(){HM.AddContactFromMessagePart(h,i,n,r,o,g,m,d,DemandLoadHandler.filterFetchedContentIds([HM.ContentId.ReadMessageAddContact]),f.getSuccessCallback(),{mid:g.MessageId,fid:i,id:t,cacheFixupInfo:l},f.getFailureCallback())};b.addToken(f,s)}})();(function(){var d=window,c=d.jQuery,a=d.InboxServices,b=d.InflightRequestMgr;function f(d){var e=[];if(d.mris)c.each(d.mris,function g(c,a){e.push(b.declareMessageAsInflight(a.MessageId))});if(d.cris)c.each(d.cris,function f(d,c){if(c.ConversationId)e.push(b.declareConversationAsInflight(c.ConversationId,a.getConversationViewType(c.FolderId)));if(c.MessageId)e.push(b.declareMessageAsInflight(c.MessageId))});return e}function e(a){if(a)c.each(a,function d(c,a){b.undeclareRequest(a)})}a.beginPrefetchMessages=function i(m,b,h,n,k,e,j,l){var i=[];c.each(b,function(d,b){var a=b.item.id();if(a&&c.inArray(a,i)==-1)i.push(a)});var g=ActionQueue.getToken("PrefetchMessages",m?ActionQueueTypes.ActionType.prefetchView:ActionQueueTypes.ActionType.prefetch,i,a._endPrefetchMessages,a._prefetchMessagesError),o=function p(){var p=b.length;for(var m=0;m<p;m++){var q=b[m].item;if(!a.conversationNeedsToBePrefetched(q.id(),q.conv(),n)){b.splice(m--,1);p--}}if(b.length>h)b.splice(h,b.length-h);var i={cris:null,mris:null};if(b.length>0)k(b,i,e);e=c.extend({callback:j,errorCallback:l,prefetchItems:b,inflightTokens:null,token:g},e);var o=g.getSuccessCallback();if(b.length>0){e.inflightTokens=f(i);HM.PrefetchMessages(i.mris,i.cris,o,e,g.getFailureCallback())}else d.setTimeout(function(){o({Data:[]},e,false)},1)};ActionQueue.addToken(g,o);return g};a._endPrefetchMessages=function j(h,b,i){var d=h.Data,g=d.length,f;for(var c=0;c<g;c++){f=new Conversation(d[c].Html,d[c],null,null);a.maybeCacheConversation(f,{prefetched:true})}e(b.inflightTokens);if(b.callback)b.callback(b.prefetchItems,b.token.isCancelled(),i,b)};a._prefetchMessagesError=function h(b,a){if(a){if(a.inflightTokens)e(a.inflightTokens);if(a.errorCallback)a.errorCallback.apply(null,arguments)}};a.conversationNeedsToBePrefetched=function g(c,e,d){var f=a.getCachedConversation(c,e,d||"",false,false)||(e?b.isConversationInflight(c,a.getConversationViewType(d)):b.isMessageInflight(c));return !f}})();(function(){var b=window,f=b.jQuery,a=b.InboxServices,e=a.Events,g=a.Operations,n=b.Cache,c=b.ActionQueue,d=b.ActionQueueTypes.ActionType;a.getFidForJmrType=function l(g,e){var c=b.InboxPage.Config.sysFldrs,a=b.HM.JmrType,d=e,f=e===c.junkFid;switch(g){case a.Junk:case a.Compromised:d=c.junkFid;break;case a.NotJunk:if(f)d=c.inboxFid;break;case a.Phish:d=c.trashFid}return d};a.setJunkStatus=function m(k,H,j,M,F,x,B,l,r,m,J,p,y,D,z,C,N){var i=null!=F;if(!i&&j.length==0)return;var u=b.HM.JmrType,n=InboxServices.createInboxUiDataFixupInfo({sourcePage:k,mlSkipServe:false});if(i){var v,s;if(l===u.Junk){v=false;s=FolderQuickViewListHelper.getFolderNameByFid(b.InboxPage.Config.sysFldrs.junkFid)}else{v=true;var I=l===u.NotJunk?InboxPage.Strings.bulkProgressUiNotJunk:InboxPage.Strings.bulkProgressUiPhish;s=Page.decode(I)}e.showbulkactionprogressui.fire({isMark:v,actionOrFldr:s})}Page.setPerformanceId("JK");var o={jmrType:l,guids:j,fid:x,setReportToJunkOK:B,isBulk:i,messageListRenderingInfo:r,messageRenderingInfo:m,refreshMessageList:p,refreshFolderAndQuickViewLists:y,removeFromList:D,suppressListTransition:z,markSenderAsSafe:C,refreshMessage:J,cacheFixupInfo:n,id:N};if(!i){var E=Cache.Types,A={};Cache.each(function(b,d){var c=d.type;if(c===E.Conversation||c===E.Message){var a=d.data;if(f.inArray(a.id(),j)>=0||a.hasDom()&&a.containsAnyId(j))f.each(a.senders(),function(c,a){if(a&&!b[a])b[a]=a})}},A,true);f.each(A,function(c,b){a.invalidateConversationsAndMessagesBySender(b)})}var t=k.viewId(),G=a.getFidForJmrType(l,t);if(t!==G||u.Phish===l&&b.InboxPage.Config.sysFldrs.trashFid===t){var q=a.fixupCacheForAutoSelectIndexMessageAndMoveAction(i,k,H,j,r,true,n,o);if(q.isMessageNeeded)if(!k.conv()&&!m)m=InboxServices.getItemRenderingInfo(k,q.guidNeeded);else if(q.convMsg)a.conversationAvailableInCache(q.convMsg,o,n);else n.mlSkipServe=true}var K=a.fixupCacheForMessageListItemMovesAndRaiseEvent(i,k,G,j,n,o,function P(){a.preEndUpdateUi(null,g.SetJunkStatus,{mids:j,isBulk:i,jmrType:l},k);n.alreadyCalledPreEndUpdate=true});if(K&&p)o.refreshMessageList=p=false;var w=c.getToken("MarkMessagesForJmr",i?d.blocking:d.async,[x,m?m.SenderEmail:null].concat(j),h,i?a._bulkActionError:null),L=function O(){HM.MarkMessagesForJmr(x,j,M,F,l,B,r,m,p,y,D,z,C,w.getSuccessCallback(),o,w.getFailureCallback())};c.addToken(w,L)};var h=function k(i,f,o){var j=b.HM.JmrType,l=f.cacheFixupInfo,m=a._processRspForBulkAction(i,f,null);if(m.stopProcessing)return;if(m.executeNextBatch){var k=c.getToken("MarkMessagesForJmrLoop",d.blocking,null,h,a._bulkActionError),n=function p(){HM.MarkMessagesForJmr(f.fid,null,null,i.BatchInfo,f.jmrType,f.setReportToJunkOK,f.messageListRenderingInfo,f.messageRenderingInfo,f.refreshMessageList,f.refreshFolderAndQuickViewLists,f.removeFromList,f.suppressListTransition,f.markSenderAsSafe,k.getSuccessCallback(),f,k.getFailureCallback())};c.addToken(k,n);return}if(!l.alreadyCalledPreEndUpdate)a.preEndUpdateUi(i,g.SetJunkStatus,{mids:f.guids,isBulk:f.isBulk,jmrType:f.jmrType},l.sourcePage);a.maybeCacheInboxUiDataAndRaiseEvent(i,f);if(j.Unsubscribe==f.jmrType&&!f.refreshMessage)i.MessageHtml="";if(f.jmrType==j.Compromised)alert(Page.decode(InboxPage.Strings.markAsCompromisedMsg));a._endUpdateUi(i,f,o);if(j.Unsubscribe==f.jmrType||j.Junk==f.jmrType||j.Phish==f.jmrType||j.Compromised==f.jmrType)InboxPage.Config.hasSeenReportUi=true;e.endsetjunkstatus.fire([i])};a.beginUndoSenderMoveToBlockList=function i(e,f){var b=c.getToken("UndoSenderMoveToBlockList",d.async,[e],a._endUndoSenderMoveToBlockList),g=function h(){HM.UndoSenderMoveToBlockList(e,f,b.getSuccessCallback(),null,b.getFailureCallback())};c.addToken(b,g)};a._endUndoSenderMoveToBlockList=function j(a){e.endundosendermovetoblocklist.fire([a])}})();(function(){var a=ActionQueueTypes.ActionType;InboxServices.deleteVMFromPhone=function b(e){var c=[e],b=ActionQueue.getToken("DeleteVoicemailOnPhone",a.async,c,InboxServices._endUpdateUi),d=function f(){HM.DeleteVoicemailOnPhone(c,b.getSuccessCallback(),null,b.getFailureCallback())};ActionQueue.addToken(b,d)};InboxServices.markVMAsSaved=function c(e){var c=[e],b=ActionQueue.getToken("SaveVoicemailOnPhone",a.async,c,InboxServices._endUpdateUi),d=function f(){HM.SaveVoicemailOnPhone(c,b.getSuccessCallback(),null,b.getFailureCallback())};ActionQueue.addToken(b,d)}})();(function(){var b=window,a=b.InboxServices,f=b.Cache,c=b.ActionQueue,e=b.ActionQueueTypes.ActionType;a.beginSvmFeedback=function g(k,h,g,l){var i=a.createInboxUiDataFixupInfo();f.invalidateMessageById(h.MessageId);var b=c.getToken("SvmFeedback",e.blocking,null,d),j=function m(){HM.SvmFeedback(k,h,g,b.getSuccessCallback(),{messageListRenderingInfo:g,id:l,cacheFixupInfo:i},b.getFailureCallback())};c.addToken(b,j)};var d=function h(c,b,d){a.maybeCacheInboxUiDataAndRaiseEvent(c,b);a._endUpdateUi(c,b,d)}})();window.DemandLoadServices={Events:{},EventTypes:{onenddemandload:"onenddemandload"}};DemandLoadServices.beginDemandLoad=function DemandLoadServices$beginDemandLoad(b,c,a,d){HM.LFPP=function(){HM.DemandLoad(b,DemandLoadServices._endDemandLoad,{callbacks:c,id:d},a?a:null)};HM.LFPP()};DemandLoadServices._endDemandLoad=function DemandLoadServices$_endDemandLoad(b,a){jQuery(DemandLoadServices.Events).trigger(DemandLoadServices.EventTypes.onenddemandload,{contentHash:b,callbacks:a.callbacks,ctx:a})};if(!window["LiveViews"])LiveViews={Providers:{}};LiveViews._started=false;LiveViews._pendingRegistration=[];LiveViews.QueueState=new $Enum("NotSent","Waiting","Done");LiveViews.Kind=new $Enum("Hotmail","External");LiveViews.HmlvTypes=new $Enum("Photo","Video");LiveViews._delayRegistration=function LiveViews$_delayRegistration(c,d){var b=LiveViews._pendingRegistration,a=b[c];if(!a){a=[];a.kind=c;b.push(a);b[c]=a}a.push(d)};LiveViews.getHmlvDataElem=function LiveViews$getHmlvDataElem(b){var a="hmlv";return Control.getAncestorByAttr(b,a)};LiveViews.makeElvDivUnique=function LiveViews$makeElvDivUnique(b,e){if(b.id.indexOf(e)!==0){var c=b.id,d=e+"_",f=$(c);if(f)f.id=b.id=d+c;var a=$(c+"_staticcontent");if(a)a.id=d+a.id}};LiveViews.createElvRequest=function LiveView$createElvRequest(b){var a=new HM.SandboxRequest;a.ID=b.id+"__"+ ++LiveViews.ElvIdSeed;a.Uri=b.url;a.Provider=b.provider;a.AuthOption=HM.SandboxAuthenticationOption[b.auth];a.AuthParam=b.authParam;return a};LiveViews.registerElv=function LiveViews$registerElv(b,a){LiveViews._delayRegistration(LiveViews.Kind.External,[b,a])};LiveViews.createHmlvRequest=function LiveViews$createHmlvRequest(b){var a=new HM.HMLiveViewRequestObject;a.Id=b.container.id;a.Sender=InboxPage.senderName;a.Type=b.type;a.SubType=b.subType;a.Data=b.data;a.ExtraData=b.extraData;b.registered=true;return a};LiveViews.registerHmlv=function LiveViews$registerHmlv(b,a){LiveViews._delayRegistration(LiveViews.Kind.Hotmail,[b,a])};Type.createStaticClass(LiveViews,"LiveViews");function UiElementBase(a,c,b){this._html=c;this._elt=a?jQuery(a):null;this._props=b||{};this._cache={};this._attached=this._elt?this._elt.parent().length==1:false;this._useJqueryHydration=true}UiElementBase.getElementFromHtml=function UiElementBase$getElementFromHtml(b){var a=document.createElement("DIV");try{a.innerHTML=b}catch(c){a.innerHTML=b.replace(/<p.*>/gi,"<br/>")}return jQuery(a.children)};UiElementBase.prototype={_debuggableProperties:[],getDebugObject:function(){var a=this._debuggableProperties;if(a&&jQuery.isArray(a)&&a.length>0){var b={},c=this;a.sort();jQuery.each(a,function(g,e){var a;try{var d=c[e];if(d==undefined)a="undefined";else if(d==null)a="null";else if(typeof d=="function")a=c[e]();else a=d}catch(f){a="{!#error#!}"}finally{b[e]=a}});return b}return null},swap:function(a,b){var c=this._getElement(),d=a._getElement();d.replaceWith(c);if(b)a._postDetachCleanup();else a._postRemoveCleanup();this._attached=true},attach:function(a){var b=this._getElement();b.appendTo(a);this._attached=true},remove:function(){if(this.isAttached())this._elt.remove();this._postRemoveCleanup()},detach:function(){this._elt.detach();this._postDetachCleanup()},isAttached:function(){return this._attached},hasDom:function(){return !!this._elt},getRawData:function(){return this._html||this._elt.html()},_getElement:function(){if(!this._elt)this.setupElement();return this._elt},_postRemoveCleanup:function(){this._elt=null;this._postDetachCleanup()},_postDetachCleanup:function(){this._attached=false},setupElement:function(){this._elt=this._useJqueryHydration?jQuery(this._html):UiElementBase.getElementFromHtml(this._html);this._reconcileProperties()},_updateUi:function(a,b){a="_ui_"+a;if(typeof this[a]==="function")this[a](b)},_get:function(a){var b=this._props[a];return b===undefined?this._callGetter(a):b},_set:function(b,a){var c="_set_"+b;if(this[c])a=this[c](a);if(this._elt)this._updateUi(b,a);this._props[b]=a;return a},_access:function(b,a){return a===undefined?this._get(b):this._set(b,a)},_callGetter:function(a){var b=this["_get_"+a]||this._getDefault;return this._getCached(a,b)},_getCached:function(a,c){var b=this._cache[a];return b===undefined?(this._cache[a]=$CD(this,c)(a)):b},_getDefault:function(a){return this._getDomAttr(a)},_getDomAttr:function(a){return this._elt?this._elt.attr(a):undefined},_reconcileProperties:function(a){var b=this._props;a=a||b;var c=jQuery.isArray(a);jQuery.each(a,$CD(this,function(e,a){a=c?a:e;var d=b[a];if(d!==undefined&&d!==this._callGetter(a))this._updateUi(a,d)}))}};UiElementBase.createClass("UiElementBase");function UiElementCollection(c,b,a){UiElementBase.call(this,c,b,a);this._items={};this._itemIdx=[]}UiElementCollection.prototype={initializeCollection:function(d,c){var b={},a=[];d.each(function(g,f){var d=c(g,f);if(UiElementBase.isInstance(d)){var e=d.id();b[e]=d;a.push(e)}});this._items=b;this._itemIdx=a},count:function(b){var a=0;if(!b)a=this._itemIdx.length;else this.each(function(){++a},b);return a},getByElt:function(a){var b=a.id;return this.containsId(b)?this.getById(a.id):null},getItem:function(a){return this.getById(this._itemIdx[a])},getById:function(a){return this._items[a]||null},containsId:function(a){return !!this._items[a]},containsAnyId:function(c,a){a=a||function(){return true};var b=false;jQuery.each(c,$CD(this,function(d,c){if(this.containsId(c)&&a(this.indexOfId(c),this.getById(c))){b=true;return false}}));return b},indexOfElt:function(b){var a=this.getByElt(b);return a?this.indexOf(a):-1},indexOf:function(a){return this._itemIdx.indexOf(a.id())},indexOfId:function(a){return this._itemIdx.indexOf(a)},each:function(a,b){a=$CD(this,a);jQuery.each(this._itemIdx,$CD(this,function c(d,e){var c=this._items[e];if(!b||b(d,c))return a(d,c)}))},insertItem:function(b,c){var a=b.id();if(!this.containsId(a)){this._itemIdx.splice(c,0,a);this._items[a]=b;return true}return false},addItem:function(a){return this.insertItem(a,this.count())},removeItem:function(a){var b=this.indexOf(a);if(b!=-1){this._itemIdx.splice(b,1);delete this._items[a.id()];return true}return false},replaceItem:function(b,a){var d=this.indexOf(b);if(d!=-1){delete this._items[b.id()];var c=a.id();this._itemIdx[d]=c;this._items[c]=a;return true}return false},_postRemoveCleanup:function(){this._items={};this._itemIdx=[];this.callBase(UiElementBase,"_postRemoveCleanup")}};UiElementCollection.createClass("UiElementCollection",UiElementBase);function MessageListPage(h,g,a,e,f){UiElementCollection.call(this,h,g);var c=a.FolderId,d=c&&c!==InboxPage.Config.sysFldrs.noneFid,b=d?c:a.QuickViewId;this._viewId=b?b+"":b;this._viewType=d?a.IsSearchResults?MessageListPage.ViewType.Search:MessageListPage.ViewType.Folder:a.QuickViewId;this._pageNum=parseInt(a.PageNumCurrent,10);this._sortBy=a.SortKey||null;this._sortAsc=typeof a.SortAsc=="boolean"?a.SortAsc:null;this._normalCount=null;this._rootTitle=e;this._subTitle=f;this._itemProps={};if(this.hasDom()){this._reconcileProperties();this._setupItems()}}MessageListPage.Filter=new $Enum("All","Normal","Hidden");MessageListPage.ViewType=new $Enum("Folder","QuickView","Search");MessageListPage.Config={pageSize:InboxPage.Config.pageSize,sysFldrs:InboxPage.Config.sysFldrs};MessageListPage.isFolderConversationCapable=function MessageListPage$isFolderConversationCapable(b){var a=MessageListPage.Config.sysFldrs;return b!==a.draftsFid&&b!==a.sentFid&&b!==a.searchFid};MessageListPage.prototype={countFiltered:function(a){return this.count(this._getFilterDelegate(a))},countNormal:function(){var a=this._normalCount;if(a===null)a=this._normalCount=this.countFiltered(MessageListPage.Filter.Normal);return a},containsAnyIdFiltered:function(b,a){return this.containsAnyId(b,this._getFilterDelegate(a))},containsAnyIdNormal:function(){return this.containsAnyIdFiltered(MessageListPage.Filter.Normal)},eachFiltered:function(a,b){return this.each(a,this._getFilterDelegate(b))},eachNormal:function(a){return this.eachFiltered(a,MessageListPage.Filter.Normal)},getIdList:function(){return this._itemIdx.clone()},getIdListNormal:function(){var a=[];this.eachNormal(function(c,b){a.push(b.id())});return a},getInsertIndex:function(g){var f=this.sAsc(),b=this.count();if(b==0)return 0;var a=-1;for(var c=0;c<b;++c){var e=this._items[this._itemIdx[c]],d=g.compareByDate(e);if(f!=d>0){a=c;break}}if(a==0&&!this.getItem(0).bof())a=-1;else if(a==-1&&this.getItem(b-1).eof())a=b;return a},insertItem:function(a,b){var c=this.count(),h=this.callBase(UiElementCollection,"insertItem",[a,b]);if(h){if(b<c){var e=this.getItem(b+1);a.insertBefore(e);if(b==0){a.bof(e.bof());e.bof(false)}}else if(c==0){var g=this._elt.find("TBODY");if(g.length==1)a.attach(g);else{this.callBase(UiElementCollection,"removeItem",[a]);return false}}else{b=c;var d=this.getItem(c-1);a.insertAfter(d);a.eof(d.eof());d.eof(false)}for(var f=this.count()-1;f>=MessageListPage.Config.pageSize;f--){var a=this.getItem(f);if(a.visible())a.visible(false)}this._prepareNavControl();if(this._itemAffectsCount(a))if(a.conv())this._invalidateCounts();else this._addToCounts(1);if(this._normalCount!==null&&a.visible())this._normalCount++}return h},removeItem:function(b){var a=this._updateUiPreRemove(),c=this._removeItemImpl(b,a);this._updateUiPostRemove(a);return c},removeItemsById:function(c){var a=this._updateUiPreRemove(),b=[];jQuery.each(c,$CD(this,function(e,d){if(this.containsId(d)){var c=this.getById(d);if(this._removeItemImpl(c,a))b.push(c)}}));this._updateUiPostRemove(a);return b},_removeItemImpl:function(a,b){var d=this.count(),e=d-1,g=this.callBase(UiElementCollection,"removeItem",[a]);if(g){if(d>1){if(a.bof())this.getItem(0).bof(true);if(a.eof())this.getItem(e-1).eof(true)}var c;if(a.visible()){var f=MessageListPage.Config.pageSize;if(e>=f){c=this.getItem(f-1);c.visible(true);if(c.eof())b.isEol=true}else if(this._normalCount!==null)this._normalCount--;this._prepareNavControl();if(this._itemAffectsCount(a))if(a.conv())b.invalidateCounts=true;else b.decrementBy++}a.visible(true);a.selected(false);a.checked(false);a.detach()}return g},_prepareNavControl:function(){var a=this._elt.find("#mlPageNav");if(a.hasClass("BeginOfList")&&a.hasClass("EndOfList")){var b=this.countFiltered(MessageListPage.Filter.Hidden);if(b>0){this.mPgs(true);a.removeClass("EndOfList").show().find("#nextPageLink").attr("pnCur",2).end().find("#lastPageLink").attr("pnCur",2).end().find("LI").first().text(Page.decode(InboxPage.Strings.pageNavPgNumFormat).format(1,2))}else a.find("LI").first().text(Page.decode(InboxPage.Strings.pageNavPgNumFormat).format(1,1))}},_itemAffectsCount:function(a){return this._viewType!=MessageListPage.ViewType.QuickView||this._viewId!=MessageListItem.Config.flaggedQvid||a.flag()},_updateUiPreRemove:function(){return {isEol:false,decrementBy:0,invalidateCounts:false}},_updateUiPostRemove:function(b){if(b.invalidateCounts)this._invalidateCounts();else this._addToCounts(-b.decrementBy);if(b.isEol){var a=jQuery("#mlPageNav");if(a.length){a.addClass("EndOfList");if(a.hasClass("BeginOfList")){this.mPgs(false);if(this.countNormal()==0)a.hide()}}}},_invalidateCounts:function(){this.iCt(-1);this.mCt(-1)},getItemByDescendantElt:function(b){var a=jQuery(b).closest("[msg],[conv]");return a.length?this.getByElt(a[0]):null},viewId:function(){return this._viewId},viewType:function(){return this._viewType},isFolder:function(){return this.viewType()===MessageListPage.ViewType.Folder},rootTitle:function(a){return a===undefined?this._rootTitle:(this._rootTitle=a)},subTitle:function(a){return a===undefined?this._subTitle:(this_subTitle=a)},sBy:function(){return this._sortBy===null&&this.hasDom()?(this._sortBy=this._callGetter("sBy")):this._sortBy},sAsc:function(){return this._sortAsc===null&&this.hasDom()?(this._sortAsc=this._callGetter("sAsc")=="1"):this._sortAsc},pDir:function(){return this._callGetter("pDir")},aMid:function(){return this._callGetter("aMid")},aDate:function(){return this._callGetter("aDate")},pCur:function(){var a=this._pageNum;return isNaN(a)&&this.hasDom()?(this._pageNum=parseInt(this._callGetter("pCur"),10)||-1):a||-1},_addToCounts:function(a){if(a!=0){var b=this.iCt();if(b>=0)this.iCt(b+a);var c=this.mCt();if(c>=0)this.mCt(c+a)}},mCt:function(a){return this._access("mCt",a)},_get_mCt:function(){return parseInt(this._getDomAttr("mCt"),10)||-1},_set_mCt:function(a){return this._getValidIdxNum(a)},_ui_mCt:function(b){var a=this._elt.find("#mlRange");if(a)if(b>=0){a.text(String.format(Page.decode(InboxPage.Strings.pageNavMsgs),b));a.show()}else a.hide()},iCt:function(a){return parseInt(this._access("iCt",a),10)},_get_iCt:function(){return parseInt(this._getDomAttr("iCt"),10)||-1},_set_iCt:function(a){return this._getValidIdxNum(a)},_getValidIdxNum:function(a){a=parseInt(a,10);return isNaN(a)||a<0?-1:a},mPgs:function(a){return !!this._access("mPgs",a)},_get_mPgs:function(){return this._getDomAttr("mPgs")=="1"},big:function(){return !!this._callGetter("big")},srch:function(){return !!this._callGetter("srch")},vid:function(){return this._callGetter("vid")},saDate:function(){return this._callGetter("saDate")},kDate:function(){return this._callGetter("kDate")},fltid:function(){return this._callGetter("fltid")},sel:function(a){return this._access("sel",a)},_get_sel:function(){var a=parseInt(this._getDomAttr("sel"),10);return isNaN(a)?-1:a},hasConv:function(){return !!this._callGetter("hasConv")},conv:function(){return !!this._callGetter("ct")},hasConversation:function(b){if(!this.hasConv())return false;for(var a=b.length-1;a>=0;a--){var c=b[a];if(this.containsId(c)&&this.getById(c).conv())return true}return false},_debuggableProperties:["count","conv","viewId","isFolder","quickViewId","title","subtitle","pageNum","sBy","sAsc","pDir","aMid","aDate","pCur","mCt","iCt","mPgs","big","_items","srch","vid","saDate","kDate","fltid","hasConv","isAttached","hasDom"],prefetchBucketSize:function(){return parseInt(this._callGetter("pfbs"))},getSenderEmailsFromMids:function(c){var f=[],d={};for(var a=c.length-1;a>=0;a--){var g=c[a];if(this.containsId(g)){var e=this.getById(c[a]).getSenderEmails(true);if(e.length>0){var b=e[0];if(!d[b]){f.push(b);d[b]=true}}}}return f},_getFilterDelegate:function(a){if(typeof a=="function")return a;return !a||a==MessageListPage.Filter.All?null:function(c,b){return b.matchesFilter(a)}},setupElement:function(){this.callBase(UiElementBase,"setupElement");this._setupItems()},_postInitializeItems:function(){this.each(function(b,a){a.postInitialize()})},_setupItems:function(){this.initializeCollection(this._elt.find("tbody").children("[id]"),$CD(this,function a(d,a){var b=this._itemProps[a.id];if(!b)b=this._itemProps[a.id]={};var c=new MessageListItem(a,b);c.origIndex(d);return c}));setTimeout($CD(this,this._postInitializeItems),1)},_postDetachCleanup:function(){this.each(function(b,a){a.selected(false);a.checked(false)});this.sel(-1);this.callBase(UiElementBase,"_postDetachCleanup")}};MessageListPage.createClass("MessageListPage",UiElementCollection);(function(){var c=window,f=c.jQuery,e=c.InboxPage.Config,b=c.InboxPage.Strings,a=c["MessageListItem"]=function J(b,a){UiElementBase.call(this,b,a);this._checkElt=this._getEltByName('INPUT[name="mCk"]');this._dirtyMad=false;this._origIndex=-1},d=e.quickViews;a.Config={flaggedQvid:d.flaggedQvid,contactQvid:d.contactQvid};a.Strings={checkedCbTitle:b.checkedCbTitle,unCheckedCbTitle:b.unCheckedCbTitle,flaggedAltText:b.flaggedAltText,flaggedMsgText:b.flaggedMsgText,unflaggedAltText:b.unflaggedAltText,unflaggedMsgText:b.unflaggedMsgText,repliedMsgText:b.repliedMsgText,forwardedMsgText:b.forwardedMsgText,readMsgText:b.readMsgText,unreadMsgText:b.unreadMsgText};a.SelectedClass="MessageListItemSelected t_sel";a.unreadClass="mlUnrd";a.flaggedClass="mlFlgd";a.getSenderDataByElt=function j(a){return {email:a.getAttribute("email"),name:a.innerText}};a.prototype={_debuggableProperties:["id","visible","selected","checked","flag","read","msg","conv","rpl","conv","fwd","mad","bof","eof","mdt","ci","isAttached","hasDom"],id:function wb(){return this._callGetter("id")},matchesFilter:function A(a){switch(a){case MessageListPage.Filter.Normal:return this.visible();case MessageListPage.Filter.Hidden:return !this.visible();case MessageListPage.Filter.All:return true;default:return false}},visible:function db(a){return this._access("_visible",a)},_get__visible:function D(){return this._elt.css("display")!="none"},_ui__visible:function H(a){this._elt.toggle(a)},selected:function bb(a){return this._access("_selected",a)},_get__selected:function t(){return this._elt.hasClass(a.SelectedClass)},_ui__selected:function F(b){this._elt.toggleClass(a.SelectedClass,b)},checked:function cb(a){if(a===undefined)a=this._checkElt.checked;else{this._checkElt.checked=a;this.setCheckTitle()}return a},setCheckTitle:function B(){this._checkElt.title=this.checked()?InboxPage.Strings.checkedCbTitle:InboxPage.Strings.unCheckedCbTitle},flag:function kb(b){if(b===undefined)b=this._get("_flag");else{this._set("_flag",b);this.setCategory(a.Config.flaggedQvid,b)}return b},_get__flag:function R(){return this.hasCategory(a.Config.flaggedQvid)},_set__flag:function T(a){this.invalidateMad();return a},_ui__flag:function Z(b){if(InboxActions.setFlagIcon(this._elt[0],b))this._elt.toggleClass(a.flaggedClass,b)},read:function lb(a){return this._access("_read",a)},_get__read:function S(){return !this._elt.hasClass(a.unreadClass)},_set__read:function U(a){this.invalidateMad();return a},_ui__read:function ab(b){var e=a.unreadClass,c=this._elt,g=!c.hasClass(e),f=this.rpl(),d=this.fwd(),j=this.conv();if(g!=b){c.toggleClass(e,!b);var k=c.find("TD.Io IMG"),h=this._buildIoImgIconClassName(j,b,f,d),i=this._buildIoImgIconText(f,d,b);this._updateIcon(k[0],h,Page.decode(i))}},count:function hb(a){if(a===undefined)a=this._get("_count");else a=this.conv()?this._set("_count",a):1;return a},_get__count:function O(){return this.conv()?parseInt(this._elt.find(".Ct SPAN:first").text(),10)||1:1},_ui__count:function V(b){var a=this._elt.find(".Ct");if(1==b)a.text("");else a.find("SPAN").text(b)},msg:function tb(){return !!this._callGetter("msg")},conv:function jb(){return !!this._callGetter("conv")},rpl:function ub(a){return this._access("rpl",a)},_ui_rpl:function fb(a){var b=this._elt,e=b.attr("rpl")==="rpl",c=this.fwd()==="fwd",d=this.read(),h=this.conv();if(a!==e){b.attr("fwd","");var i=b.find("TD.Io IMG"),f=this._buildIoImgIconClassName(h,d,a,c),g=this._buildIoImgIconText(a,c,d);this._updateIcon(i[0],f,Page.decode(g))}},fwd:function qb(a){return this._access("fwd",a)},_ui_fwd:function eb(a){var b=this._elt,e=b.attr("fwd")==="fwd",c=this.rpl()==="rpl",d=this.read(),h=this.conv();if(a!==e){b.attr("rpl","");var i=b.find("TD.Io IMG"),f=this._buildIoImgIconClassName(h,d,c,a),g=this._buildIoImgIconText(c,a,d);this._updateIcon(i[0],f,Page.decode(g))}},mad:function rb(){return this._callGetter("mad")},isDirtyMad:function Q(){return this._dirtyMad},invalidateMad:function y(){this._dirtyMad=true},bof:function nb(a){return this._access("bof",a)},eof:function pb(a){return this._access("eof",a)},mdt:function sb(){return this._callGetter("mdt")},ci:function vb(a){return this._access("ci",a)},vm:function xb(){return this._callGetter("vm")},ctu:function ob(){return !!this._callGetter("ctu")},self:function mb(){return this._callGetter("self")},score:function ib(){return parseInt(this._callGetter("pfs"))},origIndex:function W(a){if(a!==undefined)this._origIndex=a;return this._origIndex},compareByDate:function v(c){var b=this.mdt(),a=c.mdt();return b<a?-1:b>a?1:0},vmOnPhone:function X(a){return this._access("_vmOnPhone",a)},_ui__vmOnPhone:function u(d){if(!d){var e=this._elt[0],a=$tag(e,"TD"),c=3==a.length,b=c?$tag($tag(a[1],"DIV")[0],"IMG"):$tag(a[4],"IMG");if(2==b.length)$setDisplay(b[1],false)}},showsFlagUi:function N(a){return this._access("_showsFlagUi",a)},_get__showsFlagUi:function l(){return this._elt.find("[aId='tFg']").css("display")!=="none"},_ui__showsFlagUi:function m(a){this._elt.find("[aId='tFg']").toggle(a)},getElt:function gb(){return this._elt?this._elt[0]:null},_getSenderElts:function s(b){var a=this._elt.find("SPAN[email]");return b?a:a.makeArray()},getSenderEmails:function n(a){return this.getSenderData(a,true)},getSenderData:function x(f,e){var d=this._getSenderElts(true),c=[],b={};d.each(function(i,h){var g=a.getSenderDataByElt(h),d=g.email;if(d&&!b[d]){c.push(e?d:g);b[d]=true;return !f}});return c},getCategories:function w(){return this.ci()?this.ci().split(","):[]},hasCategory:function K(a){return this.getCategories().contains(a+"")},addCategory:function I(a){return this.setCategory(a,true)},removeCategory:function r(a){return this.setCategory(a,false)},setCategory:function M(a,c){var b=this.getCategories();a=a+"";if(b.contains(a)!=c){if(c)b.push(a);else b.remove(a);this.ci(b.join(","));return true}return false},isSenderInContactList:function h(){return this.hasCategory(a.Config.contactQvid)},isTrustedSender:function o(){return !!this._callGetter("ts")},isHighPriority:function p(){return !!this._callGetter("hp")},isLowPriority:function z(){return !!this._callGetter("lp")},insertBefore:function G(a){this._elt.insertBefore(a._elt);this._attached=true},insertAfter:function L(a){this._elt.insertAfter(a._elt);this._attached=true},postInitialize:function q(){this._initCheckbox();this._initFlag()},_getEltByName:function C(a){return this._cache[a]||(this._cache[a]=f(a,this._elt)[0])},_postDetachCleanup:function k(){this.callBase(UiElementBase,"_postDetachCleanup");this.invalidateMad();this.selected(false);this.checked(false);this.visible(true)},_initCheckbox:function E(){var c=this._getEltByName('INPUT[name="mCk"]'),b=a.Strings;if(!c.title)c.title=this.checked()?b.checkedCbTitle:b.unCheckedCbTitle},_initFlag:function Y(){var b=this._getEltByName('IMG[name="mFg"]');if(b){var c=a.Strings;if(this.flag()){b.alt=c.flaggedAltText;b.title=c.flaggedMsgText}else{b.alt=c.unflaggedAltText;b.title=c.unflaggedMsgText}}},_buildIoImgIconClassName:function g(c,d,b,a){return ["i_c_",c?"a_":"",d?"r":"u",b?"r":a?"f":""].join("")},_buildIoImgIconText:function i(c,b,d){return a.Strings[c?"repliedMsgText":b?"forwardedMsgText":d?"readMsgText":"unreadMsgText"]},_updateIcon:function P(a,c,b){a.className=c;a.alt=b;a.title=b}};a.createClass("MessageListItem",UiElementBase)})();function Conversation(d,a,b,c){this._mid=a.MessageId;this._cid=a.ConversationId;this._view=a.View;this._isConv=a.IsConversation;this._messageIds=a.MessageIds||[a.MessageId];this._senders=a.SenderEmails||[];this._isDedup=a.IsDedup;this._ic=a.IdentityContext;this._psaType=a.PsaType;this._psaUrl=a.PsaUrl;this._psaHintFired=false;this._readInstrumentation=a.ReadInstrumentation;this._messageProps=c||{};UiElementCollection.call(this,null,d,b);this._useJqueryHydration=false}Conversation.ViewTypes=HM.ItemView;Conversation.PsaTypes=HM.PsaType;Conversation.prototype={_debuggableProperties:["id","hasDom","viewType","mid","cid","secretCid","convId","isConversation","senders","messageIds","count","unreadCount","ulr","_items"],id:function Conversation$id(){return this._isConv?this._cid:this._mid},invalidated:function Conversation$invalidated(){},viewType:function Conversation$viewType(){return this._view},mid:function Conversation$mid(){return this._mid},cid:function Conversation$cid(){return this._isConv?this._cid:null},secretCid:function Conversation$secretCid(){return this._isDedup?this._cid:null},doesIdBelongTo:function Conversation$doesIdBelongTo(a){var b=this.isConversation()&&this.cid()==a||this.secretCid()==a||!!this.getById(a);return b},isDedup:function Conversation$isDedup(){return this._isDedup},isConversation:function Conversation$isConversation(){return this._isConv},psaType:function Conversation$psaType(){return this._psaType},psaUrl:function Conversation$psaUrl(){return this._psaUrl},psaUrlFired:function Conversation$psaUrlFired(a){return a===undefined?this._psaUrlFired:(this._psaUrlFired=a)},showsPsa:function Conversation$showsPsa(a){return this._access("_showsPsa",a)},_get__showsPsa:function Conversation$_get__showsPsa(){return this._psaType!=Conversation.PsaTypes.None},_ui__showsPsa:function Conversation$_ui__showsPsa(a){this._elt.find("#messageSuperBarContainer").toggle(a)},showsTagging:function Conversation$showsTagging(a){return this._access("_showsTagging",a)},_get__showsTagging:function Conversation$_get__showsTagging(){return this._elt.find(".i_tagging").parent().css("display")!=="none"},_ui__showsTagging:function Conversation$_ui__showsTagging(a){this._elt.find(".i_tagging").parent().toggle(a)},showsFlagging:function Conversation$showsFlagging(a){return this._access("_showsFlagging",a)},_get__showsFlagging:function Conversation$_get__showsFlagging(){return this._elt.find('[aId="tFg"]').css("display")!=="none"},_ui__showsFlagging:function Conversation$_ui__showsFlagging(a){this._elt.find('[aId="tFg"]').toggle(a)},shouldShowCompromisedReporting:function Conversation$shouldShowCompromisedReporting(){return this._callGetter("cmp")},messageIds:function Conversation$messageIds(){return this._messageIds},senders:function Conversation$senders(){return this._senders},ulr:function Conversation$ulr(a){return this._access("ulr",a)},isDelayed:function Conversation$isDelayed(){return this._view===Conversation.ViewTypes.Delayed},readInstrumentation:function Conversation$readInstrumentation(){return this._readInstrumentation},addOrReplaceMessage:function Conversation$addOrReplaceMessage(a,f,e){var c=this._messageProps[a];if(!c)c=this._messageProps[a]={};var b=new Message(a,f,e,c);if(this.containsId(a)){var d=this.getById(a);this.replaceItem(d,b)}else{this.addItem(b);this._updateCounts(b)}return b},insertItem:function(a,b){this.callBase(UiElementCollection,"insertItem",[a,b]);this._updateCounts(a)},removeItem:function(a){var c=this.callBase(UiElementCollection,"removeItem",[a]);if(c){var d=a.id(),b=jQuery.inArray(d,this._messageIds);if(b!==-1)this._messageIds.splice(b,1)}this._updateCounts(a)},replaceItem:function(b,a){this.callBase(UiElementCollection,"replaceItem",[b,a]);if(b.isRead()!=a.isRead())this._updateUnreadCount()},updateReadState:function(c,a){if(this.isConversation()&&this.cid()==c||this.secretCid()!=null)this.each(function(c,b){b.isRead(a)});else{var b=this.getById(c);if(!b)return;b.isRead(a)}this._updateUnreadCount()},updateFlaggedState:function(d,a){var b=false;if(this.isConversation()&&this.cid()==d){if(a)this.getItem(0).isFlagged(a);else this.each(function(c,b){b.isFlagged(a)});b=true}else{var c=this.getById(d);if(c){c.isFlagged(a);b=true}}return b},refreshCounts:function Conversation$refreshCounts(){this._updateUnreadCount();this._updateTotalCount()},_updateCounts:function Conversation$_updateCounts(a){this._updateTotalCount();if(!a||!a.isRead())this._updateUnreadCount()},_updateTotalCount:function Conversation$updateTotalCount(){if(this.hasDom()&&this.isConversation()&&!this.isDedup()){var a=this._elt.find("#totalCount");a.text(this.count())}},_updateUnreadCount:function Conversation$_updateUnreadCount(){if(this.hasDom()&&this.isConversation()&&!this.isDedup()){var a=this._elt.find("#unreadCount"),b=this.count(function(b,a){return !a.isRead()});a.text(b)}},setupElement:function Conversation$setupElement(){this.callBase(UiElementBase,"setupElement");var a=this._elt.find("#msgParts").children("DIV[mid]");this.initializeCollection(a,$CD(this,function(f,d){var c=d.getAttribute("mid"),b=this._messageProps[c];if(!b)b=this._messageProps[c]={};var a=new Message(c,d,null,b),e=a.hasAnyBody()&&(!this.isConversation()||a.isUnreadOnClient()||a.isDraft());a.isExpanded(e);return a}));if(this.count()>0)this.getItem(0).isExpanded(true)},swap:function Conversation$swap(a,b){this.callBase(UiElementBase,"swap",[a,b]);this.attachIdentityContext(this._ic)},attach:function Conversation$attach(a){this.callBase(UiElementBase,"attach",[a]);this.attachIdentityContext(this._ic)},detach:function Conversation$detach(){this._cleanupInfoPanes();this.callBase(UiElementBase,"detach")},remove:function Conversation$remove(){this._cleanupInfoPanes();this.callBase(UiElementBase,"remove")},attachIdentityContext:function Conversation$attachIdentityContext(b){if(b){var a=document.createElement("DIV");a.style.display="none";this._elt.get(0).appendChild(a);$Utility.ajaxInnerHtml(a,b)}},_cleanupInfoPanes:function Conversation$_cleanupInfoPanes(){this.each(function(b,a){a.cleanupInfoPanes()})},_postDetachCleanup:function Conversation$_postDetachCleanup(){if(this.psaType()===Conversation.PsaTypes.Auth&&!this.showsPsa())this.showsPsa(true);this.callBase(UiElementCollection,"_postDetachCleanup")}};Conversation.createClass("Conversation",UiElementCollection);function Message(d,c,b,a){UiElementCollection.call(this,c,b,a);this._useJqueryHydration=false;if(this.hasDom())this._reconcileProperties();this._id=d;if(!this._props["bodies"])this._props["bodies"]={};if(this.hasDom()){this._setupBodies();this._setupNonpersistantProperties()}}(function(a,b){a.Config={flaggedQvid:b.quickViews.flaggedQvid};a.readClass="Read";a.unreadClass="Unread";a.expandedClass="Expanded";a.collapsedClass="Collapsed"})(Message,InboxPage.Config);Message.prototype={_debuggableProperties:["id","mid","isRead","isMixedReadState","isUnreadOnClient","isFlagged","isExpanded","idx","pfx","fid","ps","contactEmail","contactName","date","auxData","cdu","categories","icId","isSenderInContactList","isSenderInWhiteList","isCollapsible","zIndex","detailsVisible","recipientList"],id:function Message$id(){return this._id},getControlElement:function Message$getControlElement(){return this._elt&&this._elt.length==1?this._elt[0]:null},mid:function Message$mid(){return this._id},duplicateMsgIds:function Message$duplicateMsgIds(){return this._callGetter("_duplicateMsgIds")},_get__duplicateMsgIds:function Message$_get__duplicateMsgIds(){var a=this._getDomAttr("ids");return a?a.split(","):[]},isRead:function Message$isRead(a){return !!this._access("_isRead",a)},_set__isRead:function Message$_set__isRead(a){this.isMixedReadState(false);return a},_get__isRead:function Message$_get__isRead(){return true},_ui__isRead:function Message$_ui__isRead(a){if(a&&this.isUnreadOnClient()||!a&&this.isRead()){var b=this._getContainer();b.toggleClass(Message.unreadClass,!a);b.toggleClass(Message.readClass,a)}},isMixedReadState:function Message$isMixedReadState(a){return !!this._access("nr",a)},isUnreadOnClient:function Message$isUnreadOnClient(){return !this.isRead()||this.isMixedReadState()},isFlagged:function Message$isFlagged(a){if(a===undefined)a=this._get("flg");else{this._set("flg",a);this.setCategory(Message.Config.flaggedQvid,a)}return !!a},_ui_flg:function Message$_ui_flg(a){InboxActions.setFlagIcon(this._elt[0],a)},isExpanded:function Message$isExpanded(a){if(a===undefined)a=this._expanded;else if(this._expanded!=a){var b=this._getContainerDiv();b.toggleClass(Message.collapsedClass,!a);b.toggleClass(Message.expandedClass,a);this._expanded=a}return a},idx:function Message$idx(){return this._callGetter("idx")},_get_idx:function Message$_get_idx(){return parseInt(this._getDomAttr("idx"))},pfx:function Message$pfx(){return this._callGetter("pfx")},fid:function Message$fid(){return this._callGetter("fid")},ps:function Message$ps(){return this._callGetter("ps")},contactEmail:function Message$contactEmail(){return this._callGetter("ca")},contactName:function Message$contactName(){return this._callGetter("cn")},date:function Message$date(a){return this._access("_date",a)},_get__date:function Message$_get__date(){return this.getPrefixedElt("Date").innerHTML},_ui__date:function Message$_ui__date(a){this.getPrefixedElt("Date").innerHTML=a},auxData:function Message$auxData(){return this._callGetter("mad")},isDraft:function Message$isDraft(){return !!this._callGetter("dr")},cdu:function Message$cdu(){return this._callGetter("cdu")},categories:function Message$categories(a){return this._access("_categories",a)},_get__categories:function Message$_get__categories(){var a=this._getDomAttr("ci");return a?a.split(","):[]},setCategory:function Message$setCategory(a,c){var b=this.categories();a=a+"";if(b.contains(a)!=c){if(c)b.push(a);else b.remove(a);this.categories(b);return true}return false},icId:function Message$icId(){return this._callGetter("ic")},isSenderInContactList:function Message$isSenderInContactList(){return !!this._callGetter("ab")},isSenderInWhiteList:function Message$isSenderInWhiteList(){return !!this._callGetter("wl")},isCollapsible:function Message$isCollapsible(){return !!this._callGetter("cl")},zIndex:function Message$zIndex(a){return this._access("_zIndex",a)},_get__zIndex:function Message$_get__zIndex(){return this._elt.find("DIV.ReadMsgContainer").css("zIndex")},_ui__zIndex:function Message$_ui__zIndex(a){this._elt.find("DIV.ReadMsgContainer").css("zIndex",a)},detailsVisible:function Message$detailsVisible(a){if(a===undefined)a=this._detailsVisible;else if(this._detailsVisible!=a){var b=this._getContainer();b.toggleClass("HideH",!a);b.toggleClass("ShowH",a);var c=Message.unreadClass;if(Browser.isIE&&b.hasClass(c)){b.toggleClass(c);b.toggleClass(c)}this._detailsVisible=a}return a},recipientList:function Message$recipientList(a){return this._access("_recipientList",a)},_get__recipientList:function Message$_get__recipientList(){return this.getPrefixedElt("recip").innerHTML},_ui__recipientList:function Message$_ui__recipientList(a){this.getPrefixedElt("recip").innerHTML=a},defaultBodyType:function Message$defaultBodyType(){return this._callGetter("_defaultBodyType")},_get__defaultBodyType:function Message$_get__defaultBodyType(){return MessageBody.getTypeValue(this._getDomAttr("dbt"))},invalidateBody:function Message$invalidateBody(a){var b=this.getById(a);if(b){this.removeItem(b);delete this._props["bodies"][a]}},hasBody:function Message$hasBody(a){return this.containsId(a)},hasAnyBody:function Message$hasAnyBody(){return this.count()>0},getBody:function Message$getBody(a){return this.getById(a)},addOrReplaceBody:function Message$addOrReplaceBody(a,f,d){var b=this._props["bodies"][a];if(!b)b=this._props["bodies"][a]={};b["_html"]=d;var c=new MessageBody(f,d,this,b,a);if(this.containsId(a)){var e=this.getById(a);this.replaceItem(e,c)}else this.addItem(c);return c},getPrefixedElt:function Message$getPrefixedElt(a){return this._elt.find("#"+this.pfx()+a).get(0)},setupElement:function Message$setupElement(){this.callBase(UiElementBase,"setupElement");this._setupBodies();this._setupNonpersistantProperties()},cleanupInfoPanes:function Message$cleanupInfoPanes(){this.each(function(b,a){a.cleanupInfoPane()})},_setupNonpersistantProperties:function Message$_setupNonpersistantProperties(){this._expanded=!!this._elt.attr("ex");this._detailsVisible=this._getContainer().hasClass("ShowH")},_setupBodies:function Message$_setupBodies(){var c=this._elt.find("#"+this.pfx()+"msgPartBody"),a=c.children(0);if(a.length>0){var d=MessageBody.getTypeValue(a.attr("bt"));if(d!==undefined)this.addOrReplaceBody(d,a,null)}jQuery.each(this._props["bodies"],$CD(this,function(b,a){if(a["_html"])this.addOrReplaceBody(b,null,a["_html"])}));var b=this.defaultBodyType();if(a.length==0&&this.hasBody(b)){var e=this.getBody(b);e.attach(c)}},_getContainerDiv:function Message$_getContainerDiv(){return this._$containerDiv||(this._$containerDiv=this._elt.children().eq(0))},_getContainer:function Message$_getContainer(){return this._$container||(this._$container=this._elt.children().eq(0).children().eq(0))}};Message.createClass("Message",UiElementCollection);(function(){var d=window,b=d.jQuery,a=d["MessageBody"]=function e(e,c,b,a,d){UiElementBase.call(this,e,c,a);this._message=b;this._type=d;this._useJqueryHydration=false;if(this.hasDom()){this._attached=true;this._reconcileProperties()}};a.Types=HM.MessageBodyType;var c=InboxPage.Strings;a.Strings={hideDetails:c.hideDetails,showDetails:c.showDetails};a.getTypeValue=function(a){return MessageBody.Types[a]};a.getType=function(a){return a?MessageBody.Types.Full:MessageBody.Types.Part};a.prototype={id:function(){return this._type},message:function(){return this._message},type:function(){return this._type},pfx:function(){return this._callGetter("pfx")},showUnsafe:function(){return this._callGetter("su")!=null},codePageOverride:function(){var a=this._callGetter("cpo");return null!=a?a:-1},vm:function(){return this._callGetter("vm")},vop:function(){return this._callGetter("vop")},safety:function(){return this._callGetter("sf")},isSafe:function(){return this.safety()=="s"},replyForwardUrl:function(){return this._callGetter("rfu")},replyAction:function(){return this._callGetter("ra")},replyAllAction:function(){return this._callGetter("raa")},forwardAction:function(){return this._callGetter("fa")},warnOnReplyForward:function(){return this._callGetter("wrf")!=null},cdu:function(){return this._callGetter("cdu")},unsubscribeUrl:function(){return this._callGetter("uu")},isSvm:function(){return this._callGetter("svm")},isSbd:function(){return this._callGetter("sbd")},isPsaDown:function(){return this._callGetter("psa")},ulr:function(){return this._callGetter("ulr")},elv:function(){return this._callGetter("elv")},hasHmlv:function(){return this._callGetter("hmlv")!=null},hasElv:function(){return this.elv()!=null},showsInfoPane:function(a){return this._access("_showsInfoPane",a)},safetyBarLinkExpands:function(){this._callGetter("_safetyBarLinkExpands")},_get__safetyBarLinkExpands:function(){var a=this.getPrefixedElt("safetyBar");return a&&a.getAttribute("expands")},_get__showsInfoPane:function(){var a=b(this.getPrefixedElt("bodyHdr")).find(".InfoPane");return a.length>0&&a.css("display")!="none"},_ui__showsInfoPane:function(a){b(this.getPrefixedElt("bodyHdr")).find(".InfoPane").toggle(a)},stickyInfoPane:function(){return this._get("_stickyInfoPane")},_get__stickyInfoPane:function(){return b(this.getPrefixedElt("bodyHdr")).find(".InfoPane .Sticky").length>0},cleanupInfoPane:function(){if(this.showsInfoPane()&&!this.stickyInfoPane())this.showsInfoPane(false)},getAttachmentDataFromElt:function(a){a=b(a).closest("[aIdx]");if(a)return {aIdx:a.attr("aIdx"),aDepth:a.attr("aDepth"),isOfficePreview:a.attr("wacScenario")=="View",entryPt:a.attr("entryPt"),displayInNewWindow:a.attr("aNewWin")};else return null},vmSafetyBarState:function(a){return this._access("_vmSafetyBarState",a)},_get__vmSafetyBarState:function(){return undefined},_ui__vmSafetyBarState:function(d){var a=this.getPrefixedElt("safetyBar");if(!a)return;a=b(a).find("SPAN:first-child");var c=a.find("SPAN");c.eq(0).addClass("DisplayNone");c.eq(d?1:2).removeClass("DisplayNone");c.eq(!d?1:2).addClass("DisplayNone");c.eq(3).addClass("DisplayNone");var e=a.find("A");if(d)e.eq(1).addClass("DisplayNone");else{e.eq(0).addClass("DisplayNone");e.eq(1).addClass("DisplayNone")}},setDetailsVisible:function(b){var a=this.getPrefixedElt("details");if(a)a.title=Page.decode(MessageBody.Strings[b?"hideDetails":"showDetails"])},getPrefixedElt:function(a){return this._elt.find("#"+this.pfx()+a).get(0)},detach:function f(){this._cleanupInfoPane();this.callBase(UiElementBase,"detach")},remove:function g(){this._cleanupInfoPane();this.callBase(UiElementBase,"remove")},idx:function(){return this._message.idx()},mid:function(){return this._message.mid()},auxData:function(){return this._message.auxData()},contactEmail:function(){return this._message.contactEmail()}};a.createClass("MessageBody",UiElementBase)})();LiveViewContainerControl=function LiveViewContainerControl(a){Control.create(this,a);this._initialize()};LiveViewContainerControl._ICON_SIZE=28;LiveViewContainerControl._MINIMUM_TITLE_SIZE=150;LiveViewContainerControl._MAX_ICONS_ON_UPPER_BAR=5;LiveViewContainerControl.prototype={};var __p=LiveViewContainerControl.prototype;__p._initialize=function LiveViewContainerControl$_initialize(){this.hmlvData=eval(this.elt.getAttribute("hmlv"));if(this.hmlvData&&this.hmlvData.length>0)for(var ii=0;ii<this.hmlvData.length;ii++){var currentHmlvData=this.hmlvData[ii];currentHmlvData.provider=currentHmlvData[0];currentHmlvData.type=currentHmlvData[1];currentHmlvData.subType=currentHmlvData[2];currentHmlvData.icon=currentHmlvData[3];currentHmlvData.loadingTitle=currentHmlvData[4];currentHmlvData.data=currentHmlvData[5];currentHmlvData.extraData=currentHmlvData[6];currentHmlvData.container=$(this.elt.id+"_"+ii);currentHmlvData.registered=false;currentHmlvData.containerControl=this;currentHmlvData.hasBeenSelected=false}this.collapseExpandControl=$(this.elt.id+"_ce");this.upperIconBar=$(this.elt.id+"_uib");this.lowerIconBar=$(this.elt.id+"_lib");this.brandingArea=$(this.elt.id+"_brand");this.messagePartBody=Control.findControl(this.elt,"MessagePartBody");this.selectedIndex=-1;this._setCollapseState(this.elt.getAttribute("c")=="true");this._clickHandler=$CD(this,this._onIconClick);this.upperIconBar.attachEvent("onclick",this._clickHandler);this._clickHandler=$CD(this,this._onIconClick);this.lowerIconBar.attachEvent("onclick",this._clickHandler);this._resizeHandler=$CD(this,this._onResize);window.attachEvent("onresize",this._resizeHandler);this._buildIcons();this._createIconBar();this._selectHmlv(0)};__p.dispose=function LiveViewContainerControl$dispose(){if(this.isCollapsed)$BSI.reportEvent("lv.collapse",null);window.detachEvent("onclick",this._clickHandler);var a=0;if(this.hmlvData){this.hmlvData.forEach(function(b){if(b){if(b.hasBeenSelected)a++;if(b.binding)b.binding.dispose();b.binding=null;b.container=null;b.containerControl=null;b.iconControl=null}},null);if(this.hmlvData.length>1)$BSI.reportEvent("lv.tab.click",{tabClicks:a,totalTabs:this.hmlvData.length})}this.upperIconBar.detachEvent("onclick",this._clickHandler);this.lowerIconBar.detachEvent("onclick",this._clickHandler);window.detachEvent("onresize",this._resizeHandler);Control.destroy(this)};__p._buildIcons=function LiveViewContainerControl$_buildIcons(){for(var b=0;b<this.hmlvData.length;b++){var a=document.createElement("a");a.href="#";a.onclick=function(){return false};a.className="IconContainer";a.setAttribute("iconIndex",b+1);if(LiveViews.hmlvIconSutraLabel)a.setAttribute("sutra",LiveViews.hmlvIconSutraLabel);var c=document.createElement("div");c.style.backgroundImage="url("+this.hmlvData[b].icon+")";c.className="Icon";a.appendChild(c);this.hmlvData[b].iconControl=a;c=null;a=null}};__p._createIconBar=function LiveViewContainerControl$_createIconBar(i){if(InboxPage.readingPane&&InboxPage.readingPane.isAnyWideBodyExpanded()){if(this.messagePartBody){var d=this.messagePartBody.getMsgContainer();if(d&&d.parentElement)this.elt.style.width=d.parentElement.offsetWidth+"px"}}else this.elt.style.width="auto";var g=this.lowerIconBar.offsetWidth;if(this.hmlvData.length<=LiveViewContainerControl._MAX_ICONS_ON_UPPER_BAR&&this.hmlvData.length*LiveViewContainerControl._ICON_SIZE<g-this.brandingArea.offsetWidth-LiveViewContainerControl._MINIMUM_TITLE_SIZE){if(this._usesUpperBar&&i)return;this._usesUpperBar=true;while(this.upperIconBar.childNodes.length)this.upperIconBar.removeChild(this.upperIconBar.childNodes[0]);while(this.lowerIconBar.childNodes.length)this.lowerIconBar.removeChild(this.lowerIconBar.childNodes[0]);for(var b=0;b<this.hmlvData.length;b++)this.upperIconBar.appendChild(this.hmlvData[b].iconControl);$css.add($(this.elt.id+"_title"),"TitleWithUpper")}else{var a=Math.floor(g/LiveViewContainerControl._ICON_SIZE);if(a==0)return;var e=Math.ceil(this.hmlvData.length/a);if(!this._usesUpperBar&&a==this._iconsPerRow&&e==this._numRows&&i)return;this._usesUpperBar=false;this._iconsPerRow=a;this._numRows=e;while(this.upperIconBar.childNodes.length)this.upperIconBar.removeChild(this.upperIconBar.childNodes[0]);while(this.lowerIconBar.childNodes.length)this.lowerIconBar.removeChild(this.lowerIconBar.childNodes[0]);for(var b=0;b<e;b++){var c=document.createElement("div");c.style.height=LiveViewContainerControl._ICON_SIZE+"px";for(var f=0;f<a;f++){var h=b*a+f;if(h<this.hmlvData.length)c.appendChild(this.hmlvData[h].iconControl)}this.lowerIconBar.appendChild(c);c=null}$css.remove($(this.elt.id+"_title"),"TitleWithUpper")}};__p._onResize=function LiveViewContainerControl$_onResize(){this._createIconBar(true)};__p.updateLayout=function LiveViewContainerControl$updateLayout(){this._createIconBar(false);if(this.selectedIndex>=0){var a=this.hmlvData[this.selectedIndex];if(a)if(!(!a.registered&&!this.isCollapsed))if(a.binding&&a.binding.updateLayout)a.binding.updateLayout()}};__p._selectHmlv=function LiveViewContainerControl$_selectHmlv(b){if(this.selectedIndex==b)return;if(this.selectedIndex>=0){$css.swap(this.hmlvData[this.selectedIndex].container,"TabSelected","Tab");if(this.hmlvData.length>1)$css.swap(this.hmlvData[this.selectedIndex].iconControl,"IconContainerSelected","IconContainer")}this.selectedIndex=b;var a=this.hmlvData[this.selectedIndex];if(a){$css.swap(a.container,"Tab","TabSelected");if(this.hmlvData.length>1)$css.swap(a.iconControl,"IconContainer","IconContainerSelected");if(!this.isCollapsed)a.hasBeenSelected=true;if(!a.registered&&!this.isCollapsed)this._registerHmlv(a);else if(a.binding&&a.binding.onHmlvSelect)a.binding.onHmlvSelect();this.setTitle()}};__p.setTitle=function LiveViewContainerControl$setTitle(){var a=this.hmlvData[this.selectedIndex],b="";if(a.binding&&a.binding.hmlvTitle)b=a.binding.hmlvTitle;else b=a.loadingTitle;$(this.elt.id+"_title").innerText=b};__p._onIconClick=function LiveViewContainerControl$_onIconClick(){var a=Control.getAncestorByAttr(event.srcElement,"iconIndex");if(a){if(this.isCollapsed)this._setCollapseState(false);this._selectHmlv(a.getAttribute("iconIndex")-1)}return false};__p.toggleExpandHmlv=function LiveViewContainerControl$toggleExpandHmlv(){var a=event.srcElement;if(a&&$css.has(a,"SubBrand"))return;this._setCollapseState(!this.isCollapsed);return false};__p._setCollapseState=function LiveViewContainerControl$_setCollapseUI(c){this.isCollapsed=c;var b=$(this.elt.id+"_c");if(this.isCollapsed){$css.swap(this.collapseExpandControl,"Expanded","Collapsed");$css.swap(b,"Content","ContentCollapsed")}else{$css.swap(this.collapseExpandControl,"Collapsed","Expanded");$css.swap(b,"ContentCollapsed","Content")}var a=this.hmlvData[this.selectedIndex];if(a&&!this.isCollapsed)if(!a.registered)this._registerHmlv(a);else if(a.binding&&a.binding.onHmlvSelect)a.binding.onHmlvSelect()};__p._registerHmlv=function LiveViewContainerControl$_registerHmlv(a){LiveViews.registerHmlv(LiveViews.createHmlvRequest(a),a)};__p.onHmlvLoaded=function LiveViewContainerControl$onHmlvLoaded(){this.setTitle()};LiveViewContainerControl.createClass("LiveViewContainerControl");var LiveViewControlBase=function LiveViewControlBase(a){Control.create(this,a);this.initialize()};LiveViewControlBase.prototype={};var __p=LiveViewControlBase.prototype;__p.initialize=function LiveViewControlBase$initialize(){this.hmlvTitle=this.elt.getAttribute("t");this._hasClickBeenReported={Internal:false,External:false}};__p.dispose=function LiveViewControlBase$dispose(){Control.destroy(this)};__p._reportClick=function LiveViewControlBase$_reportClick(a){if(!this._hasClickBeenReported[a]){this._hasClickBeenReported[a]=true;var c=LiveViews.getHmlvDataElem(this.elt),b=c?c._hmlvData:null;if(b)$BSI.reportEvent("lv.click",{LiveViewProvider:b.provider,LiveViewType:b.type,LiveViewTarget:a})}};LiveViewControlBase.createClass("LiveViewControlBase");var Safety={};Safety.markAs=function Safety$markAs(e,f,g,d,a){var b=false,c=false;a=!!a;if(!InboxPage.Config.hasSeenReportUi){c=!Safety._showReportingQuestionUi(Page.decode(InboxPage.Strings.allowJunkReportingQuestion));if(c)return;b=true}Safety._setJunkStatus(e,g,b,f,true,null,null,d,a,false)};Safety.markAsNotJunk=function Safety$markAsNotJunk(c,b,a,d){if(b==InboxPage.Config.sysFldrs.junkFid)a=null;Safety._setJunkStatus(c,b,false,HM.JmrType.NotJunk,true,a,true,HM.RemoveSenderFromListOption.None,false,d)};Safety.markAsPhish=function Safety$markAsPhish(c,d){var a=false,b=false;if(!InboxPage.Config.hasSeenReportUi){b=!Safety._showReportingQuestionUi(Page.decode(InboxPage.Strings.allowJunkReportingQuestion));if(b)return;a=true}Safety._setJunkStatus(c,d,a,HM.JmrType.Phish,true,null,null,HM.RemoveSenderFromListOption.None,false,false)};Safety.markAsUnsubscribe=function Safety$markAsUnsubscribe(f,h,a,d,e){var b=false,c=false;if(!InboxPage.Config.hasSeenReportUi){c=!Safety._showReportingQuestionUi(Page.decode(InboxPage.Strings.unsubscribeText));if(c)return;b=true}var g=!!(a&&""!==a);Safety._setJunkStatus(f,h,b,HM.JmrType.Unsubscribe,false,d,true,e,false,false);if(g)window.open(a)};Safety._showReportingQuestionUi=function Safety$_showReportingQuestionUi(a){return confirm(a)};Safety._setJunkStatus=function Safety$_setJunkStatus(c,o,t,g,s,r,a,u,q,m){var l=g==HM.JmrType.Unsubscribe||g==HM.JmrType.NotJunk&&o!=InboxPage.Config.sysFldrs.junkFid,d=InboxPage.createMoveOrJunkActionMessageListRenderingInfo(c,l,s),f=null,h=c.mids,n=c.mads;if(c.isBulk){f=InboxPage.createBatchInfo();if(InboxPage.isUnreadFilterOrFlaggedQuickView()){var j=InboxPage.messageList.getDelayedRemovalMessageData();h=j.mids;n=j.mads}}var w=f!=null,k=InboxPage.messageList.ml,p=InboxPage.readingPane.cv||null,b=!FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(h,w,k),e=!!d;a=!!a||InboxPage.shouldWaitForMessageEvent(d);var x=!m,v=!l,i=new PostProcData(x,v);InboxPage.maybeUpdatePostProcDataForMessage(i,a,false);i.uiUpdate=b||e;var y=InboxPage.createDataEventHandlers(i,b,b,e,a,false,false,null,true);InboxServices.setJunkStatus(k,p,h,n,f,o,t,g,d,r,a,e,b,u,q,m,y)};Type.createStaticClass(Safety,"Safety");var Messages={};Messages.markAsReadUnread=function Messages$markAsReadUnread(b,e,m){var a=b.mids,i=b.mads,h=null,k=false;if(b.isBulk){h=InboxPage.createBatchInfo();if(InboxPage.isUnreadFilterOrFlaggedQuickView()){k=e&&InboxPage.messageList.ml.fltid()==InboxPage.Config.filters.unreadFltid;var j=InboxPage.messageList.getDelayedRemovalMessageData();a=j.mids;i=j.mads}}if(a&&!m){var r=InboxPage.messageList;for(var c=a.length-1;c>=0;c--){if($(a[c])==null)continue;var n=r.isRead(a[c]);if(!n&&r.hasConversation([a[c]]))continue;if(n==e){a.splice(c,1);i.splice(c,1)}}if(0==a.length&&!b.isBulk)return}var o=h!=null,f=InboxPage.messageList.ml,d=!FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(a,o,f),g=InboxPage.createMessageListRenderingInfo(true,k);g.LastUpdateTimestamp=f.kDate();var p=null;if(!m){var q=new PostProcData(false,false,false);q.uiUpdate=d||l;var l=o&&!e&&g.FilterId==HM.FilterType.Unread;p=InboxPage.createDataEventHandlers(q,d,d,l,false,false)}InboxServices.beginMarkMessages(f,a,i,h,b.isHiddenBulk,e,d,g,b.duplicateMsgIds&&b.duplicateMsgIds.length>0,p)};Messages.markAsFlaggedUnflagged=function Messages$markAsFlaggedUnflagged(c,f){var a=c.mids,i=c.mads,h=null,k=false,b=InboxPage.messageList.ml;if(c.isBulk){h=InboxPage.createBatchInfo();if(InboxPage.isUnreadFilterOrFlaggedQuickView()){k=!f&&InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid;var j=InboxPage.messageList.getDelayedRemovalMessageData();a=j.mids;i=j.mads}}if(a&&(!b.conv()||b.isFolder()&&MessageListPage.isFolderConversationCapable(b.viewId()))){for(var d=a.length-1;d>=0;d--){var n=b.getById(a[d]);if(!n)continue;if(n.flag()==f){a.splice(d,1);i.splice(d,1)}}if(0==a.length&&!c.isBulk)return}var m=h!=null,e=!FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(a,m,b),g=InboxPage.createMessageListRenderingInfo(true,k);g.LastUpdateTimestamp=InboxPage.messageList.ml.kDate();var l=m&&!f&&g.FilterId==HM.FilterType.Flagged,o=new PostProcData(false,false,false);o.uiUpdate=e||l;var r=InboxPage.createDataEventHandlers(o,e,e,l,false,false),p=InboxPage.readingPane,q=p.isShowingMessage()?p.cv:null;InboxServices.beginFlagMessages(b,q,a,i,h,f,e,g,c.duplicateMsgIds&&c.duplicateMsgIds.length>0,r)};Messages.remove=function Messages$remove(g,f,c,d,b,a,e){Messages.move(g,InboxPage.folderList.fid,InboxPage.Config.sysFldrs.trashFid,f,c,d,b,a,e)};Messages.move=function Messages$move(a,s,j,i,p,w,g,v,x,h){var c=null,k=a.mids,t=a.mads;if(a.isBulk){c=InboxPage.createBatchInfo();if(i){c.SenderSearch=i;c.Timestamp=InboxPage.messageList.ml.kDate()}else if(InboxPage.isUnreadFilterOrFlaggedQuickView()){var m=InboxPage.messageList.getDelayedRemovalMessageData();k=m.mids;t=m.mads}if(!g)g=InboxPage.createBulkMoveDataPoints("view");$BSI.reportEvent(j==InboxPage.Config.sysFldrs.trashFid?"DeleteRemove.Messaging.Mail":"Move.Messaging.Mail",g)}var o=MessageList.doMessagesStayInView(s,j),b=InboxPage.createMoveOrJunkActionMessageListRenderingInfo(a,o,true);if(p)b.AutoSelectMessageIndex=-1;var r=(!h||!h.disableSuggestion)&&!i&&b.SearchKeyword!=""&&InboxPage.messageList.areAllItemsSelectedInView(),f=!v||o||!InboxPage.messageList.canSimulateMove(a.mids,a.isBulk),q=null,d=false;if(!a.isBulk&&!f&&!p&&(InboxPage.isReadingPaneOn||InboxPage.readingPane.isFullView)){d=true;q=Messages._getItemRenderingInfoForMove(a)}var y=a&&!!a.duplicateMsgIds,n=InboxPage.messageList.ml,u=InboxPage.readingPane.cv||null,z=c!=null,e=!FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(k,z,n),l=new PostProcData(true,true,d||b.AutoSelectMessageIndex!=-1);InboxPage.maybeUpdatePostProcDataForMessage(l,d,r);l.uiUpdate=e||f;var A=InboxPage.createDataEventHandlers(l,e,e,f,d||b.AutoSelectMessageIndex!==-1||y,false,false,null,true);InboxServices.beginMoveMessages(n,u,k,t,c,a.isHiddenBulk,s,j,b,w,r,e,f,InboxPage.messageList.ml.conv(),q,d,x,h,a.duplicateMsgIds&&a.duplicateMsgIds.length>0,A)};Messages._getItemRenderingInfoForMove=function Messages$_getItemRenderingInfoForMove(g){var a=InboxPage.messageList;if(g.isBulk)return;var k=a.getAutoSelectIndex(),c={};g.mids.forEach(function(a){c[a]=true});var f=a.ml.count(),d=0,i=0;a.ml.each(function(b,a){if(c[a.id()]){i++;return}else if(k==d)return false;else d++});var h=d+i,b=null;if(h<f)b=a.getItemRenderingInfo(a.ml.getItem(h));else for(var e=f-1;e>=0;e--){var j=a.ml.getItem(e);if(!c[j.id()]){b=a.getItemRenderingInfo(j);break}}return b};Messages.print=function Messages$print(a,e,d){if(a&&a.length>0&&InboxPage.allowAction("print",a[0])){var c=[];for(var b=a.length-1;b>=0;b--){c.push(a[b]);c.push(e[b]?"m":"c")}var f="/mail/PrintMessages.aspx?cpids="+c.join(",")+"&isSafe="+d+"&FolderID="+InboxPage.folderList.fid;window.open(f,"","width=600px,height=400px,menubar=no,location=no,toolbar=no,resizable=yes,scrollbars=yes")}};Messages.viewSource=function Messages$viewSource(a){var b=String.format("{0}/mail/GetMessageSource.aspx?{1}={2}&folderid={3}",InboxPage.getSrcHttps,a.mads[0]?"msgid":"convid",a.mids[0],InboxPage.folderList.fid);window.open(b)};Messages.replyForward=function Messages$replyForward(f,k,h,j){var a=f.mb,c=a[k]();if(h!=c)if(InboxPage.composeFrame){var d=f.createMessageRenderingInfo();d.AllowUnsafeContent=true;if(!a.warnOnReplyForward()||confirm(Page.decode(InboxPage.Strings.replyForwardWarning))){var g=new PostProcData(true,false);g.skipCsi=true;var l=InboxPage.createDataEventHandlers(g,false,false,false,false,false,false,null,true),i=HM.MessageActionType[c];InboxServices.beginGetComposeData(d,i,l)}}else{var b=String.format(a.replyForwardUrl(),c,a.showUnsafe()||e?"True":"False"),e=a.warnOnReplyForward();if(b)if(e)Page.showMessage(Page.decode(InboxPage.Strings.replyForwardWarning),b,null,"_self");else Page.postWithFolderQuickViewCache("NewMessage",b)}else alert(Page.decode(j));return false};Type.createStaticClass(Messages,"Messages");var ButtonList=function ButtonList(c){Control.create(this,c);this._buttons={};this._keys=[];this._data={};this._enabled=false;this.Events={onbuttonclick:new $Event,ondispose:new $Event};var b=$tag(c,"li"),f=b.length;for(var a=0;a<f;a++){if(b[a].className=="Divider")continue;var e=b[a].getAttribute("key");this.initializeButton(b[a],e)}var d=c.getAttribute("enabled")=="true";this.setEnabled(d)};ButtonList.prototype={elt:null,userdata:null,_buttons:null,_keys:null,_data:null,initializeButton:function ButtonList$initializeButton(b,a){this._keys.push(a);this._buttons[a]=b;this._data[a]=b.getAttribute("data")},_enabled:true,getEnabled:function ButtonList$getEnabled(){return this._enabled},setEnabled:function ButtonList$setEnabled(a){if(a==this._enabled)return;if(a)$replaceClass(this.elt,"Disabled","Enabled");else $replaceClass(this.elt,"Enabled","Disabled");this.elt.setAttribute("enabled",a.toString());this._enabled=a},forEach:function ButtonList$forEach(c,d){var e=this._keys.length;for(var a=0;a<e;a++){var b=this._keys[a];c(this,{button:this._buttons[b],idx:a,key:b,context:d})}},clear:function ButtonList$clear(){this._buttons={};this._keys=[];this._data={};var a=$tag(this.elt,"UL")[0];a.innerHTML=""},count:function ButtonList$count(){return this._keys.length},containsButtonKey:function ButtonList$containsButtonKey(a){return this._keys.exists(a)},getButtonProperty:function ButtonList$getButtonElt(b,c){var a=this._buttons[b];switch(c){case "elt":return a;case "enabled":return !$css.has(a,"Disabled");case "visible":return $getDisplay(a);case "text":return $tag(a,"SPAN")[0].innerText;case "selected":return $css.has(a,"Selected");case "html":return $tag(a,"SPAN")[0].innerHTML;case "data":return this._data[b]}},setButtonProperty:function ButtonList$setButtonProperty(c,d,b){var a=this._buttons[c];switch(d){case "enabled":if(b)$css.remove(a,"Disabled");else $css.add(a,"Disabled");break;case "selected":if(b)$css.add(a,"Selected");else $css.remove(a,"Selected");break;case "visible":$setDisplay(a,b);break;case "text":$tag(a,"SPAN")[0].innerText=b;break;case "html":$tag(a,"SPAN")[0].innerHTML=b;break;case "data":this._data[c]=b}},dispose:function ButtonList$dispose(){this.userdata=null;Control.destroy(this)},_buttonOnClick:function ButtonList$_buttonOnClick(a){if(!a)return;var b={button:Control.getAncestorByAttr(event.srcElement,"key"),key:a,data:this._data[a]};if(this._enabled&&this.getButtonProperty(a,"enabled"))this.Events.onbuttonclick.fire([this,b])}};ButtonList.prototype.addButton=function ButtonList$addButton(c){this._buttons={};this._keys=[];var d=$tag(this.elt,"UL")[0];d.innerHTML+=this.getButtonHTML(c);var b=$tag(d,"LI"),f=b.length;for(var a=0;a<f;a++){if(b[a].className=="Divider")continue;var e=b[a].getAttribute("key");this._keys.push(e);this._buttons[e]=b[a]}this._data[c.key]=c.data};ButtonList.createClass("ButtonList");var Menu=function Menu(b,a){ButtonList.call(this,b);this.Events={onbuttonclick:new $Event,ondispose:new $Event,onhidden:new $Event};this.setEnabled(true);this.owner=a;this._focusHandler=$CD(this,this._focusOut);this.elt.attachEvent("onfocusout",this._focusHandler);this._keyDownHandler=$CD(this,this._keyDown);this.elt.attachEvent("onkeydown",this._keyDownHandler);this.hide()};Menu.prototype={owner:null,_focusHandler:null,dispose:function Menu$dispose(){this.hide();if(this.owner!=null){this.Events.ondispose.fire([this]);this.elt.detachEvent("onfocusout",this._focusHandler);this.owner=null;this.callBase(ButtonList,"dispose")}},_keyDown:function Menu$keyDown(){this._lastKey=event.keyCode},_focusOut:function Menu$onFocusOut(){if(!this.elt.contains(event.toElement)&&this.elt!=event.toElement){if(this._lastKey==9&&this.owner&&this.owner.focus)$callFocus(this.owner);this.dispose()}},getButtonHTML:function Menu$getButtonHTML(a){return String.format(Menu._BUTTON_HTML,a.key,a.caption||"",a.tooltip||"")},focus:function Menu$focus(){if(this._keys.length>0){var a=null;this.forEach(function(c,b){if(!a&&c.getButtonProperty(b.key,"visible"))a=$tag(c.getButtonProperty(b.key,"elt"),"A")[0]});if(a)$callFocus(a)}},_selected:null,getSelectedButton:function Menu$getSelectedButton(){return this._selected},setSelectedButton:function Menu$setSelectedButton(a){if(this._selected)this.setButtonProperty(this._selected,"selected",false);if(a)this.setButtonProperty(a,"selected",true)},reposition:function Menu$reposition(a){AlignBehavior.DropDown(this.elt,this.owner,a)},show:function Menu$show(a){$setDisplay(this.elt,true);this.reposition(a)},hide:function Menu$hide(){if(this.elt!=null)$setDisplay(this.elt,false);this.Events.onhidden.fire([this])},_buttonOnClick:function Menu$_buttonOnClick(a){if(a){this.callBase(ButtonList,"_buttonOnClick",[a]);this.dispose()}},getButtonHTML:function ButtonList$getButtonHTML(a){return Menu.CreateButtonHTML(a)}};if(Browser.isIE6){var oldShow=Menu.prototype.show;Menu.prototype.show=function Menu$show(b){oldShow.call(this,b);var a=this;setTimeout(function(){var b=$tag(a.elt,"DIV");b[b.length-1].style.height=$tag(a.elt,"UL")[0].offsetHeight+"px"},0)}}Menu._BUTTON_HTML='<li key="{0}"><a unselectable=on href="#" onclick="event.returnValue=false;return false;" title="{2}">{1}</a></li>';Menu._DIVIDIER_HTML='<li class="Divider"><div></div></li>';Menu.CreateButtonHTML=function Menu$CreateButtonHTML(a){if(a.caption=="-")return Menu._DIVIDIER_HTML;return String.format(Menu._BUTTON_HTML,a.key,a.caption||"",a.tooltip||a.caption||"")};Menu.CreateMenuHTML=function Menu$CreateMenuHTML(c){var b=['<div onclick="Control.invoke(\'Menu\', \'_buttonOnClick\', event, Control.lookup(event.srcElement, \'key\'));return false;" enabled="false" class="Menu t_hovl c_m Disabled" style="display: none;"><div class="MenuTop"><div class="MenuItems"><ul>'],d=c.length;for(var a=0;a<d;a++)b[a+1]=Menu.CreateButtonHTML(c[a]);b[d+1]='</ul></div></div><div class="shadow"></div></div>';return b.join("")};Menu.Create=function Menu$Create(b){var a=document.createElement("div");document.body.appendChild(a);a.innerHTML=Menu.CreateMenuHTML(b||[]);a=a.firstChild;return a};Menu.Destroy=function Menu$Destroy(a){if(a!=null&&a.parentElement!=null)document.body.removeChild(a.parentElement)};Menu.createClass("Menu",ButtonList);var AlignBehavior={};AlignBehavior.DropDown=function AlignBehavior$DropDown(d,e,c){if(e&&e.document===d.document){c=c||{};c.x=c.x||0;c.y=c.y||0;$f.dockIt(d,e,0,c,1)}else{var f=$getLocation(e,c),h=f.left;if(document.documentElement.dir=="rtl")h=f.right-d.offsetWidth;var a={x:h,y:f.bottom},b=a.x+d.offsetWidth-document.body.offsetWidth;a.x=b>0?a.x-b:a.x;if(document.documentElement.dir=="rtl")a.x=a.x<0?0:a.x;var i=a.x,g=0;if(Browser.isSF){b=a.y+d.offsetHeight-document.body.offsetHeight;g=(b>0?a.y-b:a.y)+document.body.scrollTop}else{b=a.y-document.getElementsByTagName("HTML")[0].scrollTop+d.offsetHeight-document.body.offsetHeight;g=b>0?a.y-b:a.y}d.style.left=i+"px";d.style.top=g+"px"}};function SelectionMsgPane(a){Control.create(this,a);this.selectionElt=$("selection");this.countElt=$("selCount");this.selAllMsgElt=$("selAll");this.genMsgContainer=$("genMsgContainer");this.genMsg=$("genMsg");if(InboxPage.isReadingPaneOn)this.genMsgHdr=$("genMsgHdr");else this.closeElt=$("CloseMessaging")}__p=SelectionMsgPane.prototype={};__p.selectionElt=null;__p.countElt=null;__p.selAllMsgElt=null;__p.genMsgContainer=null;__p.genMsgHdr=null;__p.genMsgContainer=null;__p.closeElt=null;__p.dispose=function SelectionMsgPane$dispose(){this.selectionElt=null;this.countElt=null;this.selAllMsgElt=null;this.genMsgContainer=null;this.genMsgHdr=null;this.genMsg=null;this.closeElt=null;Control.destroy(this)};__p.hide=function SelectionMsgPane$hide(){$setDisplay(this.elt,false)};__p.show=function SelectionMsgPane$show(c,b,a){if(InboxPage.isReadingPaneOn)if($getDisplay(InboxPage.readingPane.elt)){InboxPage.readingPane.reset();$setDisplay(InboxPage.readingPane.elt,false)}$setDisplay(this.genMsgContainer,b);$setDisplay(this.selectionElt,c);if(!InboxPage.isReadingPaneOn)$setDisplay(this.closeElt,a);$setDisplay(this.elt,true);if(InboxPage.isReadingPaneOn)this.elt.scrollTop=0};__p.showGeneralMsg=function SelectionMsgPane$showGeneralMsg(b,a,d){if(b)this.genMsg.innerHTML=b;if(InboxPage.isReadingPaneOn){var c=false;if(a){this.genMsgHdr.innerHTML=a;c=true}$setDisplay(this.genMsgHdr,c)}this.show(false,true,d)};SelectionMsgPane.Sel="Sel";SelectionMsgPane.SelPrompt="SelPrompt";SelectionMsgPane.NoSel="NoSel";__p.updateSelectedCount=function SelectionMsgPane$updateSelectedCount(a,e){var f=true,c=SelectionMsgPane.Sel,b;if(e){var d;if(!InboxPage.isQuickViewFilterOrSearch()){var i=FolderQuickViewListHelper.getFolderNameByFid(InboxPage.folderList.fid),h=Page.decode(InboxPage.folderList.fid==InboxPage.Config.sysFldrs.inboxFid?InboxPage.Strings.inboxFolder:InboxPage.Strings.specificFolder);d=String.format(h,i.encodeHtml())}else d=Page.decode(InboxPage.Strings.genericView);var g=String.format(Page.decode(InboxPage.Strings.bulkSelectPrompt),d);this.selAllMsgElt.innerHTML=g;c=SelectionMsgPane.SelPrompt}if(-1==a)b=InboxPage.formatMsgWithGenericFolderOrViewString(Page.decode(InboxPage.Strings.allSelected));else if(0==a&&InboxPage.isReadingPaneOn)c=SelectionMsgPane.NoSel;else if(e||InboxPage.isReadingPaneOn||a>0&&$getDisplay(this.elt)&&$getDisplay(this.selectionElt)&&$css.has(this.selectionElt,SelectionMsgPane.Sel))if(1==a)b=Page.decode(InboxPage.Strings.oneMsgSelected);else b=String.format(Page.decode(InboxPage.Strings.someMsgsSelectedTmpl),a);else f=false;if(f){this.selectionElt.className=c;if(b)this.countElt.innerHTML=b;this.show(true,false,false);if(InboxPage.isReadingPaneOn){InboxPage.readingPane.mode=ReadingPane.NOT_MESSAGE_MODE;InboxPage.resetContentHeight($("SelMsgPaneInner"))}}else this.hide()};SelectionMsgPane.createClass("SelectionMsgPane");function SearchPane(a){Control.create(this,a);this.advSrchContainer=$("advSrch");this.srchQuery=$("srchQuery");this.titleSrchContainer=$("titleSearchContainer")}__p=SearchPane.prototype={};__p.advSrchContainer=null;__p.srchQuery=null;__p.hasSearchQuery=false;__p.titleSrchContainer=null;__p.isOpen=false;__p.dispose=function SearchPane$dispose(){this.advSrchContainer=this.srchQuery=this.titleSrchContainer=null;Control.destroy(this)};__p.hide=function SearchPane$hide(){if(!this.isOpen)return;$setDisplay(this.elt,false);$setDisplay(this.srchQuery,false);$setDisplay(this.titleSrchContainer,true);InboxPage._onResize(null,true);this.isOpen=false};__p.show=function SearchPane$show(){if(this.isOpen)return;$setDisplay(this.titleSrchContainer,false);$setDisplay(this.elt,true);$setDisplay(this.srchQuery,this.hasSearchQuery);InboxPage._onResize(null,true);this.isOpen=true};__p.setContent=function SearchPane$setContent(a){if(a)this.advSrchContainer.innerHTML=a};__p.setSrchQuery=function SearchPane$setSrchQuery(a){if(a){var c=String.format(Page.decode(InboxPage.Strings.srchResults),'<span dir="ltr">'+a.encodeHtml()+"</span>");this.srchQuery.innerHTML=c;this.hasSearchQuery=true}else if(a!=null){var b=Page.decode(InboxPage.Strings.srchResultsAllMsgs);this.srchQuery.innerHTML=b;this.hasSearchQuery=true}else this.hasSearchQuery=false;if(this.isOpen){$setDisplay(this.srchQuery,this.hasSearchQuery);InboxPage._onResize(null,true)}};SearchPane.createClass("SearchPane");function MessageList(b,a){Control.create(this,b);this._sorted=InboxPage.isSortByConvReq;this.ml=a;this._setStateFromDom(false);InboxServices.Events.endgetmessagelistpage.attach($CD(this,this._endGetMessageListPage))}__p=MessageList.prototype={};__p.disableRefreshForMl=false;__p._bulkSelectAll=false;__p._hiddenBulkSelectAll=false;__p._selectionMids=[];__p._selectionMads=[];__p._lastSelectedOrDeselectedIndex=-1;__p._shiftClickPivotAction=true;__p._sorted=false;__p.dispose=function MessageList$dispose(){Control.destroy(this)};__p._setStateFromDom=function MessageList$_setStateFromDom(e){var a=$tag(this.elt,"div");if(null==a||a.length==0)return;a=a[0];this.setHiddenBulkSelectAll(false);if(this.isBulkSelectAllState()&&e){this.setCheckAllCheckBox(true);this.checkRange(0,0,true,true);this._clearPivotState();this.updateSelectedCount()}else{if(this.getCheckedCount()>0)this._refreshSelectionFromChecks();else{this.clearSelectionState();var c=this.ml.sel();if(-1!=c){var b=this.ml.getItem(c);this.selectMsg(b,c);b.selected(true);this._ensureVisible(b.getElt())}}this.setCheckAllCheckBox(false)}if(InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.junkFid&&InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.trashFid&&InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.sentFid&&InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.draftsFid){var d=$("atiml");if(d)$Ads.SetSDTag(d.value);$Ads.SetTag($Ads.Tags.PV,"I")}else{$Ads.SetSDTag("");$Ads.SetTag($Ads.Tags.PV,"")}};__p.setMessageListPage=function MessageList$setMessageListPage(a,e,d){var b=-1;if(a===this.ml)b=this.getSelectionIndex();else{a.swap(this.ml,true);this.ml=a}this._setStateFromDom(e);var c=b!==-1?b:d;if(c!==-1)this.selectByIndex(c,true,true);if(!InboxPage.isReadingPaneOn)InboxPage.resetContentHeight($("messageListContentContainer"));this.disableRefreshForMl=false};__p.cleanUpContextMenu=function MessageList$cleanUpContextMenu(){if(this._prepareContextMenuForUiUpdate)this._prepareContextMenuForUiUpdate()};__p.cancelContextMenuTimers=function MessageList$cancelContextMenuTimers(){if(this._cancelMenuEvents)this._cancelMenuEvents()};__p.getItemCount=function MessageList$getItemCount(){return parseInt(this.ml.iCt())};__p.getMessageCount=function MessageList$getMessageCount(){return parseInt(this.ml.mCt())};__p.isMoreThanOnePage=function MessagesList$isMoreThanOnePage(){return this.ml.mPgs()};__p.setIsMoreThanOnePage=function MessagesList$setIsMoreThanOnePage(a){this.ml.mPgs(a)};__p.getCategories=function MessageList$getCategories(a){return this.ml.getById(a).getCategories()};__p.isMessageInCategory=function MessageList$isMessageInCategory(a){return this.ml.getById(a).hasCategory()};__p.addCategory=function MessageList$addCategory(b,a){return this.ml.getById(b).addCategory(a)};__p.removeCategory=function MessageList$removeCategory(b,a){return this.ml.getById(b).removeCategory(a)};__p.getViewId=function MessageList$getViewId(){return this.ml.vid()};__p.updateCount=function MessageList$updateCount(b,a){this.ml.getById(b).count(a)};__p.canSimulateMove=function MessageList$canSimulateMove(a,f){if(f||this.ml.mCt()>0&&this.hasConversation(a))return false;var b=this.ml.countFiltered(MessageListPage.Filter.Hidden),d=this.ml.countNormal();if(b==0&&d-a.length<=0)return false;var e=this.ml.getItem(this.ml.countNormal()-1).eof(),c=a.length<=b||e;return c};__p.clearSelectionForMove=function MessageList$clearSelectionForMove(){this.setCheckAllCheckBox(false);this.clearSelectionState()};__p.selectItemByRenderingInfo=function MessageList$selectItemByRenderingInfo(a){if(a&&this.ml.countNormal()>0){var b=a.MessageId||a.ConversationId;this.selectByMid(b,true,true);var c=this.ml.getItem(0).getElt();this._ensureVisible(c);this._ensureVisible($(b))}};__p.hide=function MessageList$hide(){$css.add($("messageListSplitPane"),"MessageListSplitPaneHidden");$css.add($("msgListToolbarsContainer"),"MsgListToolbarsContainerHidden")};__p.show=function MessageList$show(){InboxPage.isReadMessageMode=false;InboxPage.isFullView=false;if(!InboxPage.isReadingPaneOn)this.clearSelection();$css.remove($("messageListSplitPane"),"MessageListSplitPaneHidden");$css.remove($("msgListToolbarsContainer"),"MsgListToolbarsContainerHidden")};__p.sort=function MessageList$sort(c){var h="Conversation",b=this.ml,e=false;if(h==c||b.conv()&&b.srch()&&"Date"==c){c="Date";e=true}var d=null,g=HM.SortBy[c]==HM.SortBy.Date,f=e?h:c;if(!g)if(b.big())d=InboxPage.Strings.cannotSortBigInbox;else if(b.srch())d=InboxPage.Strings.cannotSortSearch;if(!d&&(e&&!b.conv()||!e&&b.conv()))if(!b.srch()){$BSI.reportEvent("ml.sort",{sortView:f});InboxPage.onSubmitSortConversationView(!b.conv(),c);return}else d=InboxPage.Strings.cannotSortSearch;if(d){alert(Page.decode(d));return}if(InboxPage.messageList.resetGotoPickerValues)InboxPage.messageList.resetGotoPickerValues(c);this._sorted=true;var a=InboxPage.createMessageListRenderingInfo(false);a.FolderId=InboxPage.folderList.fid;a.QuickViewId=InboxPage.quickViewList.qvid;a.FilterId=b.fltid();a.IsSearchResults=InboxPage.folderList.isSrch;a.SearchKeyword=InboxPage.folderList.srchKw;a.AdvancedSearch=InboxPage.advancedSearch&&InboxPage.advancedSearch.getSearch();a.SortKey=c;a.SortAsc=b.sBy()==c?!b.sAsc():!g;a.NumberOfMessages=b.mCt();a.IsFavoriteSelected=InboxPage.folderList.isFavoriteSelected;Page.setPerformanceId("SO");$BSI.reportEvent("ml.sort",{sortView:f+(a.SortAsc?"Incr":"Decr")});InboxPage.beginRefreshInbox(true,true,a,false,null,false,false)};__p._getSearchMessageListRenderingInfo=function MessageList$_getSearchMessageListRenderingInfo(){var a=InboxPage.createMessageListRenderingInfo(false),b=this.ml;if(HM.SortBy[b.sBy()]!=HM.SortBy.Date){a.SortKey="Date";a.SortAsc=false}else{a.SortKey=b.sBy();a.SortAsc=b.sAsc()}a.IsSearchResults=true;a.FolderId=InboxPage.Config.sysFldrs.searchFid;return a};__p.search=function MessageList$search(a){var b=this._getSearchMessageListRenderingInfo();b.SearchKeyword=a;Page.setPerformanceId("SR");if(InboxPage.advancedSearch)InboxPage.advancedSearch.reset();var c=/(\sOR\s)|(\sAND\s)|[:]/;$BSI.reportEvent("ml.search.bsb",{sq:a&&c.test(a)?"1":"0",cx:this._getSearchComplexity(a)});this._searchInner(b)};__p.advancedSearch=function MessageList$advancedSearch(b){var a=this._getSearchMessageListRenderingInfo();a.AdvancedSearch=b;$BSI.informNav(null,"SR");SearchBox.resetValue();$BSI.reportEvent("ml.search.asb",{});this._searchInner(a)};__p._searchInner=function MessageList$_searchInner(a){InboxPage.beginRefreshInbox(true,true,a,false,null,false,false)};__p.searchAllFromSender=function MessageList$searchAllFromSender(c){$BSI.reportEvent("ml.cm.fe",{});var b=this._getSearchMessageListRenderingInfo(),a=new PostProcData(true,true);a.uiUpdate=true;var d=InboxPage.createDataEventHandlers(a,true,true,true,false,false);InboxServices.beginViewAllFromSender(b,c,d)};__p.restoreHiddenTrash=function MessageList$restoreHiddenTrash(){var b=InboxPage.createMessageListRenderingInfo(true),a=new PostProcData(true,true);a.uiUpdate=true;var c=InboxPage.createDataEventHandlers(a,true,true,true,false,false);InboxServices.beginRestoreHiddenTrash(b,c)};__p._getSearchComplexity=function MessageList$_getSearchComplexity(b){var c=/[^\s!"():]+/g,a=b?b.match(c):null;return a?a.length:0};__p._onBodyClick=function MessageList$_onBodyClick(){var b=event.srcElement;$callFocus(jQuery(event.srcElement).closest("tr").find("input").get(0));if("mCk"==b.name||"mCC"==b.getAttribute("name")){this._onCheckMessageClick(event);return true}else if("tFg"==Control.lookup(b,"aId")){this._onFlagMessageClick(Control.getAncestorByAttr(b,"aId"));return true}if($getTextSelection(b))return;var a=Control.getAncestorByAttr(b,"msg");if(null==a){a=Control.getAncestorByAttr(b,"conv");if(null==a)return true}if(event.shiftKey||event.ctrlKey){window.open(String.format("{0}?mad={1}&{2}&n={3}{4}",Page.SELF_PATH,a.getAttribute("mad"),String.format(a.getAttribute("conv")?"cid={0}":"mid={0}",a.id),Page.queryString.newNonce,InboxPage.folderList.isSrch?"":String.format("&fid={0}&fav={1}",InboxPage.folderList.fid,InboxPage.folderList.isFavoriteSelected)));event.returnValue=false;event.cancelBubble=true;return true}if(InboxPage.isReadingPaneOn&&InboxPage.readingPane.mode==ReadingPane.MESSAGE_MODE)if(InboxPage.readingPane.getItemId()==a.id)return;this._shiftClickPivotAction=true;Page.setPerformanceId(a.getAttribute("conv")?"RC":"R");this.openMessage(a.id)};__p.openMessageByIndex=function MessageList$openMessageByIndex(b){if(-1!=b){var a=this.ml.getItem(b);if(a)this.openMessage(a.id())}};__p.openMessage=function MessageList$openMessage(c){var b=this.ml.getById(c),a=b.getElt();if(!InboxPage.isReadingPaneOn)this.saveSelection();this.selectByElem(a,true,-1,true,false,false,!InboxPage.isReadingPaneOn);this._openMessageByElt(a)};__p._onDblClick=function MessageList$_onDblClick(){if(!InboxPage.isReadingPaneOn)return;var a=InboxPage.readingPane;if(a.mode==ReadingPane.MESSAGE_MODE)if(a.setHTMLed)a.openFullView();else a.doubleClicked=true};__p._onNavClick=function MessageList$_onNavClick(){var a=Control.getAncestorByAttr(event.srcElement,"pnCur");if(null==a)return;if("gotoLink"==jQuery(a).attr("id")){if(InboxPage.messageList.launchGotoPicker)InboxPage.messageList.launchGotoPicker(jQuery(a).attr("type"))}else{Page.setPerformanceId("PG");this._openPageByElt(a)}};__p.getItemRenderingInfo=function MessageList$getItemRenderingInfo(a){a=this._getItemFromElt(a);return InboxServices.getItemRenderingInfo(this.ml,a.id())};__p._openMessageByElt=function MessageList$_openMessageByElt(a,g,h,d){var e=this.ml.getByElt(a).getSenderEmails(true),b=this.getItemRenderingInfo(a);if(e.length>0)b.SenderEmail=e[0];var c=null;if(typeof d=="function")c=function(b,a){a.maintainCurrentSelection=false;InboxServices.Events.endupdateui.fire([b,false,a]);d()};var f=new PostProcData(true,!InboxPage.isRestoringState);f.uiUpdate=true;InboxPage.beginRefreshInbox(false,false,null,true,b,false,this.ml.conv(),c,null,false,false,null,f);if(g)setTimeout($CC($CD(this,this._ensureVisible),[a]),1)};__p._endGetMessageListPage=function MessageList$_endGetMessageListPage(){this._getMessageListPageWorking=false};__p.next=function MessageList$next(c){var b=this._selectNextOrPreviousValidElem(true);this._shiftClickPivotAction=true;if(!b){var a=$("nextPageLink");if(a&&$getDisplay(a))this._openPageByElt(a,0)}else{Page.setPerformanceId("Next");this._openMessageByElt(b,true,c)}};__p.previous=function MessageList$previous(c){if(-1==this._lastSelectedOrDeselectedIndex)return;var b=this._selectNextOrPreviousValidElem(false);this._shiftClickPivotAction=true;if(!b){var a=$("prevPageLink");if(a&&$getDisplay(a))this._openPageByElt(a,InboxPage.Config.pageSize-1)}else{Page.setPerformanceId("Pre");this._openMessageByElt(b,true,c)}};__p.hasNextAndPreviousValidElem=function MessageList$hasNextAndPreviousValidElem(){var a={hasNext:false,hasPrev:false},b=this.getSelectionIndex();if(b<0)return a;var c=$("mlPageNav");a.hasNext=!$css.has(c,"EndOfList");a.hasPrev=!$css.has(c,"BeginOfList");if(!a.hasPrev)a.hasPrev=this._getNextOrPreviousMsgIndex(false,b,false)>=0;if(!a.hasNext)a.hasNext=this._getNextOrPreviousMsgIndex(true,b,false)>=0;return a};__p._selectNextOrPreviousValidElem=function MessageList$_selectNextValidElem(c){var a=this._lastSelectedOrDeselectedIndex;a=this._getNextOrPreviousMsgIndex(c,a,false);if(a<0)return null;else{var b=this.ml.getItem(a);return this.selectByItem(b,true,a,true)?b.getElt():null}};__p._getNextOrPreviousMsgIndex=function MessageList$_getNextOrPreviousMsgIndex(e,a,b){var c=this._getValidMsgFn(),d=b?this.ml.count():this.ml.countNormal();while(true){a+=e?1:-1;if(a<0||a>=d)break;var f=this.ml.getItem(a);if(c(this,f))return a}return -1};__p.getNextOrPreviousMessageListItem=function MessageList$getNextOrPreviousMessageListItem(g,d,e){var c=null,a=this.ml;if(a.containsId(d)){var h=a.getById(d),f=a.indexOf(h),b=this._getNextOrPreviousMsgIndex(g,f,e);if(b!=-1)c=a.getItem(b)}return c};__p._ensureVisible=function MessageList$_ensureVisible(a){$scrollIntoView(a,_ge("messageListScrollableContainer"))};__p.updateSortMenu=function MessageList$updateSortMenu(){var a=this.ml,o=$("sortMenu"),m=$("SortByDate"),f=$("SortBySender"),l=$("SortBySubject"),n=$("SortBySize"),c=$("SortByConversation"),e=InboxPage.Config.sysFldrs.sentFid==InboxPage.folderList.fid||InboxPage.Config.sysFldrs.draftsFid==InboxPage.folderList.fid,i=false,r=$tag(o,"A")[0],p="Sender"!=a.sBy()?a.sBy():e?"To":"From",h=a.sBy();if(a.conv()&&!a.srch()&&!e)h=p="Conversation";if(this._sorted)r.title=String.format(InboxPage.Strings.sortByCaption,InboxPage.Strings.sortBy[p]);var k=InboxPage.Strings.sortBy[e?"To":"From"];$tag(f,"SPAN")[0].innerHTML=k;f.title=String.format(InboxPage.Strings.sortByCaption,k);var b="sel";$css.remove(m,b);$css.remove(f,b);$css.remove(l,b);$css.remove(n,b);if(c){$css.remove(c,b);var q=$getDisplay(c.parentElement),j=!a.srch()&&!e?true:false;if(q!=j){$setDisplay(c.parentElement,j);i=true}}$css.add($("SortBy"+h),b);var d="clear";$tag(m,"IMG")[0].className=d;$tag(f,"IMG")[0].className=d;$tag(l,"IMG")[0].className=d;$tag(n,"IMG")[0].className=d;if(c)$tag(c,"IMG")[0].className=d;$tag($("SortBy"+h),"IMG")[0].className=a.sAsc()?"g_sort_asc":"g_sort_desc";var g=$getDescendantByClass(o,"UL","c_m");if(i&&g&&g.binding)g.binding.invalidatePosition()};__p._updateItemListState=function MessageList$_updateItemListState(b,f,e,d){var c=this.ml;if(f)c.eachNormal(function(b,a){d(a,e)});else for(var a=b.length-1;a>=0;a--){var g=b[a];if(!c.containsId(g))return;d(c.getById(b[a]),e)}};__p.updateReadState=function MessageList$updateReadState(b,a,c){this._updateItemListState(b,a,c,$CD(this,this.updateReadStateByElt))};__p.updateReadStateByElt=function MessageList$updateReadStateByElt(a,c){var b=false,d=this.ml;if(a&&a.read()!=c){InboxServices.fixupMessageListPagesWhenMarkingAsRead(a.id(),d,c);b=true}return b};__p.isConversation=function MessageList$isConversation(a){return this.ml.getById(a).conv()};__p.isSenderInContactList=function MessageList$isSenderInContactList(a){return this.ml.getById(a).isSenderInContactList()};__p._updateFlagStateByItem=function MessageList$_updateFlagStateByItem(a,b){if(a&&a.flag()!=b)a.flag(b)};__p.isFlagged=function MessageList$isFlagged(a){return this.ml.getById(a).flag()};__p.isRead=function MessageList$isRead(a){return this.ml.getById(a).read()};__p.hasConversation=function MessageList$hasConversation(a){return this.ml.hasConversation(a)};__p.removeVMOnPhoneStatus=function MessageList$removeVMOnPhoneStatus(){this.ml.getByIdx(this.getSelectionIndex()).vmOnPhone(false)};__p._getItemFromElt=function MessageList$getItemFromElt(a){return MessageListItem.isInstance(a)?a:this.ml.getByElt(a)};MessageList.createSelectedMessageData=function MessageList$createSelectedMessageData(b,d,c,a){return MessageList._createSelectedMessageDataImpl(b,d,c,false,a)};MessageList.createHiddenBulkSelectedMessageData=function MessageList$createHiddenBulkSelectedMessageData(){return MessageList._createSelectedMessageDataImpl(true,null,null,true)};MessageList._createSelectedMessageDataImpl=function MessageList$_createSelectedMessageDataImpl(h,c,b,e,a){if(a&&a.length>0){var f=b[0];b=[];c=a;var g=c.length;for(var d=0;d<g;d++)b.push(f)}return {isBulk:h,mids:c,mads:b,duplicateMsgIds:a,isHiddenBulk:e}};MessageList.doMessagesStayInView=function MessageList$doMessagesStayInView(a,b){return (a==InboxPage.Config.sysFldrs.searchFid||a==InboxPage.Config.sysFldrs.noneFid)&&b!=InboxPage.Config.sysFldrs.trashFid&&b!=InboxPage.Config.sysFldrs.junkFid};__p.getSelectedMessageData=function MessageList$getSelectedMessageData(){var c=null,b=null,a=this.isBulkSelectAllState();if(!a){c=this._selectionMids.clone();b=this._selectionMads.clone()}return MessageList.createSelectedMessageData(a,c,b)};__p.getDelayedRemovalMessageData=function MessageList$getDelayedRemovalMessageData(){var a=[],b=[],c=this._getValidMsgFn();this.ml.eachNormal($CD(this,function(e,d){if(!c(this,d))this._selectMsgInner(d,a,b)}));if(a.length==0){a=null;b=null}return {mids:a,mads:b}};__p.selectByIndex=function MessageList$selectByIndex(a,c,d){if(a<0||a>=this.ml.countNormal())return null;var b=this.ml.getItem(a);return this.selectByItem(b,c,a,d)?b.getElt():null};__p.selectByMid=function MessageList$selectByMid(e,c,d,b){var a=this.ml.getById(e);return this.selectByItem(a,c,-1,d,false,b)?a.getElt():null};__p._getSelectedItem=function MessageList$_getSelectedItem(b){var a=this.ml.getItemByDescendantElt(b);return a?a.getElt():null};__p.selectByElem=function MessageList$selectByElem(b,f,h,g,c,e,d){if(!b)return null;var a=this.ml.getByElt(b);return this.selectByItem(a,f,h,g,c,e,d)?a.getElt():null};__p.selectByItem=function MessageList$selectByItem(a,f,b,g,d,e,c){if(!a)return false;if(-1==b)b=this.ml.indexOf(a);if(-1==b)return false;if(g){this.clearSelection(false,c);this.ml.sel(-1)}if(f){if(!d&&!this.isBulkSelectAllState())this.selectMsg(a,b);if(!c){a.selected(true);if(e)setTimeout($CD(this,function(){this._ensureVisible(a.getElt())}),1)}}else{if(!d)this.unselectMsg(a,b);if(!c&&a.selected())a.selected(false)}return true};__p.clearSelection=function MessageList$clearSelection(a,b){var c=this.ml;if(c.countNormal()==0)return;a=a||b;c.each($CD(this,function(d,c){this.selectByItem(c,false,d,false,true,false,b);if(!a)c.checked(false)}));if(!a)this.setCheckAllCheckBox(false);this.clearSelectionState()};__p.clearSelectionState=function MessageList$clearSelectionState(){this._bulkSelectAll=false;this._selectionMids=[];this._selectionMads=[];this._clearPivotState()};__p._clearPivotState=function MessageList$_clearPivotState(){this._lastSelectedOrDeselectedIndex=-1;this._shiftClickPivotAction=true};__p.selectMsg=function MessageList$selectMsg(a,b){this._selectMsgInner(a,this._selectionMids,this._selectionMads);this._lastSelectedOrDeselectedIndex=b};__p._selectMsgInner=function MessageList$_selectMsgInner(a,d,c){a=this._getItemFromElt(a);var e=a.id(),b=a.mad(),f=b?InboxPage.createMessageAuxData(b):"";d.push(e);c.push(f)};__p.unselectMsg=function MessageList$unselectMsg(b,c){b=this._getItemFromElt(b);if(this.isBulkSelectAllState()){$BSI.reportEvent("bk.uncheck",{unchecked:true});this._bulkSelectAll=false;this.ml.eachNormal($CD(this,function(a,b){if(a!=c)this.selectMsg(b,a)}))}else{var d=b.id(),a=this._selectionMids.indexOf(d);if(a>=0){this._selectionMids.splice(a,1);this._selectionMads.splice(a,1)}}this._lastSelectedOrDeselectedIndex=c};__p.getSelectionIndex=function MessageList$getSelectionIndex(){return this.areAnyItemsSelected()?this._lastSelectedOrDeselectedIndex:-1};__p.getAutoSelectIndex=function MessageList$getAutoSelectIndex(){if(!this.areAnyItemsSelected()||this._lastSelectedOrDeselectedIndex<0)return -1;var c=this.ml,b=0;for(var a=this._lastSelectedOrDeselectedIndex-1;a>=0;a--)if(c.getItem(a).checked())b++;return this._lastSelectedOrDeselectedIndex-b};__p._onFlagMessageClick=function MessageList$_onFlagMessageClick(b){var a=this.ml.getItemByDescendantElt(b);InboxActions.markMessageAsFlaggedUnflagged(a.id(),a.mad()||"",!a.flag())};__p._onCheckMessageClick=function MessageList$_onCheckMessageClick(j){var h=j.srcElement,b=$("msgChkAll"),a=this.ml.getItemByDescendantElt(h),c=this.ml.indexOf(a),f=false;if("TD"==h.nodeName)a.checked(!a.checked());else a.setCheckTitle();var d=this._lastSelectedOrDeselectedIndex;if(this.isOneItemSelected()){var g=this.ml.getById(this._selectionMids[0]),e=g.checked();if(g.id()==a.id())f=e;else if(!e)this.clearSelection(true)}if(!f)this.selectByItem(a,a.checked(),c,false);if(event.shiftKey&&d>-1)if(d<c)this.checkRange(d,c,this._shiftClickPivotAction);else this.checkRange(c,d,this._shiftClickPivotAction);if(b.checked==true&&a.checked()==false)this.setCheckAllCheckBox(false,b);else if(b.checked==false&&a.checked()==true){var i=this.areAllItemsChecked();this.setCheckAllCheckBox(i,b)}this.updateSelectedCount(this._shouldShowBulkSelectPrompt(b.checked));if(!(event.shiftKey&&this._lastSelectedOrDeselectedIndex>-1))this._shiftClickPivotAction=a.checked()};__p.areAllItemsChecked=function MessageList$areAllItemsChecked(){var a=true;this.ml.eachNormal($CD(this,function(c,b){if(!b.checked()){a=false;return false}}));return a};__p._refreshSelectionFromChecks=function MessageList$_refreshSelectionFromChecks(){this.clearSelectionState();this.ml.eachNormal($CD(this,function(b,a){if(a.checked())this.selectMsg(a,b)}))};__p.saveSelection=function MessageList$saveSelection(){this._savedSelection=this.getSelectedMessageData().mids};__p.restoreSelection=function MessageList$restoreSelection(){var a=this._savedSelection;if(a&&a.length>0){var e=a.length;for(var b=0;b<e;b++){var d=a[b],c=this.ml.getById(d);if(c){c.checked(true);this.selectByMid(d,true,false,false)}}}if(this.areAllItemsChecked())this.setCheckAllCheckBox(true,$("msgChkAll"));this._savedSelection=[]};__p.updateSelectedCount=function MessageList$updateSelectedCount(a){var b=this.isBulkSelectAllState()?-1:this._getSelectionListCount();InboxPage.selectionMsgPane.updateSelectedCount(b,a)};__p.isOneItemSelected=function MessageList$isOneItemSelected(){return 1==this._getSelectionListCount()};__p.areAnyItemsSelected=function MessageList$areAnyItemsSelected(){return this.isBulkSelectAllState()||this._getSelectionListCount()>0};__p.areAllItemsSelectedInView=function MessageList$areAllItemsSelectedInView(){return this.isBulkSelectAllState()||!this.isMoreThanOnePage()&&this.ml.countNormal()==this._getSelectionListCount()};__p._getSelectionListCount=function MessageList$_getSelectionListCount(){return this._selectionMids.length};__p.getCheckedCount=function MessageList$getCheckedCount(){var a=0;this.ml.eachNormal($CD(this,function(c,b){if(b.checked())a++}));return a};__p.checkRange=function MessageList$checkRange(d,e,b,c){var a=this.ml.countNormal();if(!c)a=Math.min(e+1,a);this.ml.eachNormal($CD(this,function(e,c){if(e>=a||e<d)return;if(c.checked()!=b){c.checked(b);this.selectByItem(c,b,e,false)}}));if(!c)this.updateSelectedCount()};__p.checkAll=function MessageList$checkAll(a){this.clearSelection();if(a)this.checkRange(0,0,a,true);this.setCheckAllCheckBox(a);this._lastSelectedOrDeselectedIndex=a?0:-1;this.updateSelectedCount(this._shouldShowBulkSelectPrompt(a))};__p.setCheckAllCheckBox=function MessageList$setCheckAllCheckBox(b,a){if(!a)a=$("msgChkAll");a.checked=b;a.title=b?InboxPage.Strings.selectNone:InboxPage.Strings.selectAll};__p._shouldShowBulkSelectPrompt=function MessageList$_shouldShowBulkSelectPrompt(a){return a&&InboxPage.Config.isBulkSelectEnabled&&this.isMoreThanOnePage()};__p.isBulkSelectAllState=function MessageList$isBulkSelectAllState(){return this._bulkSelectAll};__p.bulkSelectAll=function MessageList$bulkSelectAll(){this.clearSelectionState();this._bulkSelectAll=true;this.updateSelectedCount()};__p.getHiddenBulkSelectAll=function MessageList$getHiddenBulkSelectAll(){return this._hiddenBulkSelectAll};__p.setHiddenBulkSelectAll=function MessageList$setHiddenBulkSelectAll(a){this._hiddenBulkSelectAll=a};__p.hasFocus=__p.focus=function MessageList$emptyFunction(){};MessageList.createClass("MessageList");__p=MessageList.prototype;__p._openPageByElt=function MessageList$_openPageByElt(e,b,f){if(f&&this._getMessageListPageWorking)return;this._getMessageListPageWorking=true;var g=e.getAttribute("pnCur"),d=e.getAttribute("pnDir"),a=InboxPage.createMessageListRenderingInfo(true);a.PageNumCurrent=g;switch(d){case "FirstPage":this.setFirstOrLastPageParams(a,true);break;case "LastPage":this.setFirstOrLastPageParams(a,false);break;case "NextPage":this._setNextPageParams(a);break;case "PreviousPage":this._setPrevPageParams(a);break;default:this.setFirstOrLastPageParams(a,true)}var c=true;if(this.isBulkSelectAllState()&&!InboxPage.isUnreadFilterOrFlaggedQuickView()){a.BulkSelectAllTimestamp=this.ml.saDate();a.AutoSelectMessageIndex=-1;c=false}else if(null!=b)a.AutoSelectMessageIndex=b;$BSI.reportEvent("ml.paging",{dir:d,by:this.ml.conv()?"Conversation":a.SortKey,asc:a.SortAsc?"1":"0"});InboxPage.beginRefreshInbox(c,true,a,false,null,false,false,InboxServices._endGetMessageListPage,InboxServices._endGetMessageListPageError)};__p._setNextPageParams=function MessageList$_setNextPageParams(b){var d=null,c=null,f=false,a=this.ml,g=this._findNextPageMsgAnchor();if(g){var e=a.getByElt(g);if(e){d=e.id();c=e.mdt()}}else if(HM.ListNavigateDirection[a.pDir()]==HM.ListNavigateDirection.FirstPage)f=true;else if(a.aMid()&&a.aDate()){d=a.aMid();c=a.aDate()}if(!f&&d&&c){b.PageDirection=HM.ListNavigateDirection.NextPage;b.AnchorId=d;b.AnchorDate=c}else this.setFirstOrLastPageParams(b,true)};__p._setPrevPageParams=function MessageList$_setPrevPageParams(a){var b=this.ml;if(b.aMid()&&b.aDate()){a.PageDirection=HM.ListNavigateDirection.PreviousPage;a.AnchorId=b.aMid();a.AnchorDate=b.aDate()}else this.setFirstOrLastPageParams(a,true)};__p.setFirstOrLastPageParams=function MessageList$setFirstPageParams(a,b){a.PageDirection=b?HM.ListNavigateDirection.FirstPage:HM.ListNavigateDirection.LastPage;a.AnchorId=null;a.AnchorDate=null};__p._findNextPageMsgAnchor=function MessageList$_findNextPageMsgAnchor(){var e=this._getValidMsgFn(),b=null,d=this.ml,f=d.countNormal();for(var a=f-1;a>=0;--a){var c=d.getItem(a);if(e(this,c)){b=c.getElt();break}}return b};__p._getValidMsgFn=function MessageList$_getValidMsgFn(){var a;if(this.ml.fltid()==InboxPage.Config.filters.unreadFltid&&InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid)a=function(a,b){return a._isValidAnchorMsgForUnreadView(b)&&a._isValidAnchorMsgForFlaggedView(b)};else if(this.ml.fltid()==InboxPage.Config.filters.unreadFltid)a=function(a,b){return a._isValidAnchorMsgForUnreadView(b)};else if(InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid)a=function(a,b){return a._isValidAnchorMsgForFlaggedView(b)};else a=function(a,b){return a._isValidAnchorMsgForNormalView(b)};return a};__p._isValidAnchorMsgForNormalView=function MessageList$_isValidAnchorMsgForNormalView(){return true};__p._isValidAnchorMsgForUnreadView=function MessageList$_isValidAnchorMsgForUnreadView(a){return !a.read()};__p._isValidAnchorMsgForFlaggedView=function MessageList$_isValidAnchorMsgForFlaggedView(a){return a.flag()};function FolderList(a){Control.create(this,a);this._setStateFromDom()}FolderList.JUNK_NAME="J";FolderList.NOT_JUNK_NAME="NJ";FolderList.UNSAFE_NAME="MU";FolderList.SAFE_NAME="MS";__p=FolderList.prototype={};__p.fid=__p.fst=__p.ft=null;__p.dispose=function FolderList$dispose(){Control.destroy(this)};__p._setStateFromDom=function FolderList$_setStateFromDom(){FolderQuickViewListHelper.initLeftNavTitles(this.elt);var a=$getDescendantByAttr(this.elt,"div","flmain","flmain");this.fid=a.getAttribute("selfid");this.fst=a.getAttribute("fst");this.isSrch=null!=a.getAttribute("isSrch");this.isFavoriteSelected=null!=a.getAttribute("fav");this.srchKw=a.getAttribute("srchKw");this.askws=a.getAttribute("askws");this.asfrm=a.getAttribute("asfrm");this.asto=a.getAttribute("asto");this.assub=a.getAttribute("assub");this.asfld=a.getAttribute("asfld");this.asbeg=a.getAttribute("asbeg");this.asend=a.getAttribute("asend");this.asatt=!!a.getAttribute("asatt");setTimeout($CD(this,function(){this._updateHeader()}),10);this._setSearchState()};__p._setSearchState=function FolderList$_setSearchState(){var a=InboxPage.advancedSearch;if(this.isSrch){SearchBox.setValue(this.srchKw);InboxPage.searchPane.setSrchQuery(this.srchKw);if(a&&a.isLoaded())a.setSearchFromDom()}else{SearchBox.resetValue();InboxPage.searchPane.setSrchQuery(null);if(a&&a.isLoaded())a.setSearch(null).hide()}};__p._updateHeader=function FolderList$_updateHeader(){var a=$(InboxPage.Config.sysFldrs.inboxFid),b=a.getAttribute("count");$HeaderCookie.updateUnreadCount(b)};__p._onclick=function FolderList$_onclick(){var d=FolderQuickViewListHelper.resolveToFolderElt(event.srcElement),b=d.folderElt,c=d.targetElt;if(!c){if(window.ExpandCollapse)ExpandCollapse.handleClick(event.srcElement,App.config.excoCookieValFl);return}else{var a=InboxPage.readingPane;this.goToFldrByElt(b,c,b.id===InboxPage.folderList.fid&&!(a.isFullView&&a.isShowingMessage()))}};__p.goToFldrByElt=function FolderList$goToFldrByElt(a,d,c){var f=a.id,e=null!=a.getAttribute("isSrch"),b=d.getAttribute("fidref")!=null;this.goToFldr(f,e,b,c)};__p.setOnBeforeGoToFldrCallback=function FolderList$setOnBeforeGoToFldrCallback(a){this.onBeforeGoToFldrCallback=a};__p.goToFldr=function FolderList$goToFldr(g,b,e,f){if(this.onBeforeGoToFldrCallback&&this.onBeforeGoToFldrCallback())return;InboxPage.messageList.clearSelectionState();var d=InboxPage.messageList.ml,a=InboxPage.createMessageListRenderingInfo(false);a.FolderId=g;a.SortKey=d.sBy();a.SortAsc=d.sAsc();a.IsSearchResults=b;a.SearchKeyword=b?this.srchKw:null;a.AdvancedSearch=b&&InboxPage.advancedSearch?InboxPage.advancedSearch.getSearch():null;a.IsFavoriteSelected=e;Page.setPerformanceId("VI");var c=new PostProcData(true,true);c.composeFrame.hide=true;InboxPage.maybeUpdatePostProcDataForMessage(c,false,false);InboxPage.beginRefreshInbox(true,true,a,false,null,true,false,null,null,false,f,null,c)};__p.setHTML=function FolderList$setHTML(a){this.elt.innerHTML=a;this._setStateFromDom()};__p.updateSelection=function FolderList$updateSelection(c){var d=c.FolderId,a=jQuery("#folderList"),b=InboxPage.Config.sysFldrs,e=this.fid;(function h(){var g="selfid",h="t_sel",f="ItemSelected",i="BoldText";function c(c,g){if(c){var e,d;if(c===b.inboxFid){e='[idref="'+c+'"]';d=".lnav_topItem"}else{e="#"+c;d=".lnav_itemLnk"}a.find(e).toggleClass(f,g).find(d).toggleClass(h,g)}}if(e!=d){c(e);c(d);a.attr(g,d)}})();(function i(){var e="fst",c=null;switch(d){case b.inboxFid:c="INBOX";break;case b.trashFid:c="TRASH";break;case b.junkFid:c="JUNK";break;case b.sentFid:c="SENT";break;case b.draftsFid:c="DRAFTS"}if(c)a.attr(e,c);else a.removeAttr(e)})();if(c.IsFavorite){var f="fav";a.attr(f,f)}(function g(){var e="isSrch",i="srchKw",g="as",n="askws",m="asfrm",p="asto",o="assub",l="asfld",j="asbeg",k="asend",f="asatt";if(c.IsSearchResults){a.attr(e,e);a.attr(i,c.SearchKeyword);var b=c.AdvancedSearch;if(b){a.attr(g,g).attr(n,b.Keywords).attr(m,b.From).attr(p,b.To).attr(o,b.Subject).attr(l,b.Folder).attr(j,b.DateBegin).attr(k,b.DateEnd);if(b.HasAttachment)a.attr(f,f)}}else a.removeAttr(e).attr(i,"").removeAttr(g).removeAttr(n).removeAttr(m).removeAttr(p).removeAttr(o).removeAttr(l).removeAttr(j).removeAttr(k).removeAttr(f);var h=InboxPage.Config.sysFldrs.searchFid;a.find("#"+h).toggle(d===h)})();this.setHTML(a.parent().html())};FolderList.createClass("FolderList");function QuickViewList(a){Control.create(this,a);this._setStateFromDom()}__p=QuickViewList.prototype={};__p.qvid=null;__p.dispose=function QuickViewList$dispose(){Control.destroy(this)};__p.setOnBeforeGoToQuickViewCallback=function FolderList$setOnBeforeGoToQuickViewCallback(a){this.onBeforeGoToQuickViewCallback=a};__p._setStateFromDom=function QuickViewList$_setStateFromDom(){FolderQuickViewListHelper.initLeftNavTitles(this.elt);var a=$tag(this.elt,"ul");if(!Object.isNull(a)&&a.length>0){a=a[0];this.qvid=a.getAttribute("qvid")}};__p._onclick=function QuickViewList$_onclick(){var a=Control.getAncestorByAttr(event.srcElement,"qvid");if(null==a||!a.id||a.id.substring(0,3)!="qv-"){if(window.ExpandCollapse)ExpandCollapse.handleClick(event.srcElement,App.config.excoCookieValQv);return}var b=parseInt(a.id.substring(3));if(isNaN(b))return;this._goToQuickView(b)};__p._onclickHeader=function QuickViewList$_onclickHeader(){};__p._goToQuickView=function QuickViewList$_goToQuickView(c){if(this.onBeforeGoToQuickViewCallback&&this.onBeforeGoToQuickViewCallback())return;InboxPage.messageList.clearSelectionState();$BSI.reportEvent("Filter.Messaging.Mail",{QuickView:c});var d=InboxPage.messageList.ml,a=InboxPage.createMessageListRenderingInfo(false);a.QuickViewId=c;a.SortKey=d.sBy();a.SortAsc=d.sAsc();var b=new PostProcData(true,true);b.composeFrame.hide=true;InboxPage.maybeUpdatePostProcDataForMessage(b,false,false);InboxPage.beginRefreshInbox(true,true,a,false,null,true,false,null,null,false,false,null,b)};__p.setHTML=function QuickViewList$setHTML(a){this.elt.innerHTML=a;this._setStateFromDom()};__p.clearSelection=function QuickViewList$clearSelection(){var a="ItemSelected",b="t_sel";jQuery(this.elt).find("."+a).removeClass(a).find("."+b).removeClass(b);this.qvid=null};QuickViewList.createClass("QuickViewList");function ReadingPane(c,a,b){Control.create(this,c);if(a)this._attachConversation(a);this._setStateFromDom();if(a&&b)setTimeout($CD(this,function(){this._maybeAutoExpandMessage(b)}),1);window.ic_viewemail=function(a){InboxPage.messageList.searchAllFromSender(a)}}ReadingPane.allNotExpandedClass="AllNotExpanded";ReadingPane.allExpandedClass="AllExpanded";ReadingPane.NO_MODE=0;ReadingPane.MESSAGE_MODE=1;ReadingPane.NOT_MESSAGE_MODE=2;ReadingPane.DELAY_LOADED_MODE=3;ReadingPane.READ_NAME="R";__p=ReadingPane.prototype={};__p.isFullView=false;__p.mode=ReadingPane.NO_MODE;__p._msgParts=null;__p._allBodies=false;__p.dispose=function ReadingPane$dispose(){this._disposeMsgParts();Control.destroy(this)};__p._disposeMsgParts=function ReadingPane$disposeMsgParts(){this.mode=ReadingPane.NO_MODE;if(this._msgParts!=null){this._doForAllMessageParts(function(a){a.dispose()});this._msgParts=null}this._msgPartsArray=null;this._actionMid=null;if($ic&&$ic.ic)$ic.ic.removeICsFromNamespace("rm")};__p._doForAllMessageParts=function ReadingPane$_doForAllMessageParts(b){for(var a in this._msgParts)if(!FunctionHelper.isSpecialMember(this._msgParts,a))if(false===b(this._msgParts[a]))break};__p._setStateFromDom=function ReadingPane$_setStateFromDom(){if(!$getDisplay(this.elt)){this.mode=ReadingPane.NOT_MESSAGE_MODE;return}var a=$tag(this.elt,"div");if(null==a||a.length==0){this.mode=ReadingPane.NO_MODE;return}this._child=a[0];if(this.cv.isDelayed()){this.mode=ReadingPane.DELAY_LOADED_MODE;return}ReadingPane.downloadFrame=$("downloadFrame");if(null!=ReadingPane.downloadFrame)ReadingPane.downloadFrame.attachEvent("onload",ReadingPane._handleDownloadAttachmentError);var d={},b=[];this.cv.each($CD(this,function(e,a){var c=new MessagePart(a.getControlElement(),a);d[a.mid()]=c;b.push(c);if(null==this._actionMid)this._actionMid=a.isDraft()?null:a.mid()}));this._msgParts=d;this._msgPartsArray=b;if(null==this._actionMid)this._actionMid=this.cv.getItem(0).mid();this._allBodies=false;this.updateNextPrevMessageArrows();var c=$("atirp");if(c)$Ads.SetSDTag(c.value);$Ads.SetTag($Ads.Tags.PV,"R");this.mode=ReadingPane.MESSAGE_MODE;this.setHTMLed=true;setTimeout($CC(ReadingPane._handlePsaView,[this.cv]),1)};ReadingPane._handlePsaView=function ReadingPane$_handlePsaView(a){var f=a.psaUrl();if(f&&!a.psaUrlFired()){OptionsWriter.fireOption(f);a.psaUrlFired(true)}if(a.showsPsa()){var d=Conversation.PsaTypes,b={};b[d.Upsell]="PSAUpsell";b[d.Auth]="LiveViewAuth";var c=b[a.psaType()];if(c)$BSI.reportEvent("ReadView.Messaging.Mail.SuperBar",{SuperBarType:c});var e=a.psaType();if(e===Conversation.PsaTypes.Upsell)InboxServices.fixupCacheForPsaMessages(e,a)}};__p._scrollToMessagePart=function ReadingPane$_scrollToMessagePart(b){if(InboxPage.isReadingPaneOn)$scrollIntoView(b.elt,$("readingPaneContainer"),2);else{var a=$getLocation(b.elt);window.scrollTo(a.left,a.top-2)}};__p.setConversation=function ReadingPane$setConversation(a,b){this._disposeMsgParts();this._attachConversation(a);if(!InboxPage.isReadingPaneOn)InboxPage.selectionMsgPane.hide();else if(!$getDisplay(this.elt)){InboxPage.selectionMsgPane.hide();$setDisplay(this.elt,true)}this._setStateFromDom();this._showHideFlaggingUi();this._maybeAutoExpandMessage(b);setTimeout($CD(this,this._handleWideLayout),1)};__p._attachConversation=function ReadingPane$_attachConversation(a){if(this._isConversationAttached())this.cv.remove();this.cv=a;this.cv.attach(this.elt)};__p._showHideFlaggingUi=function ReadingPane$_showHideFlaggingUi(){var a=InboxPage.Config.sysFldrs,b=InboxPage.folderList.fid,c=b===a.trashFid||b===a.junkFid;this.cv.showsFlagging(!c)};__p._maybeAutoExpandMessage=function ReadingPane$_maybeAutoExpandMessage(b){var c=this.cv;if(b&&c.isConversation()&&c.containsId(b)){var a=this._msgParts[b];if(a){var e=a.msg;if(e.hasAnyBody())a.updateHeaderUi(true);if(!(Browser.isIE6&&!InboxPage.readingPane)){var d=$CD(this,function(){this._scrollToMessagePart(a)});setTimeout(d,50)}}}};__p._isConversationAttached=function ReadingPane$_isConversationAttached(){return this.cv&&this.cv.isAttached()};__p.shouldShowCompromisedReporting=function ReadingPane$shouldShowCompromisedReporting(){return this.isShowingMessage()&&this.cv.shouldShowCompromisedReporting()};__p.handlePageLoadWithMsg=function ReadingPane$handlePageLoadWithMsg(){setTimeout($CD(this,this._handleWideLayout),1)};__p.updateNextPrevMessageArrows=function ReadingPane$updateNextPrevMessageArrows(){var a=InboxPage.messageList.hasNextAndPreviousValidElem();if(a.hasNext)$css.remove($("readingPaneContentContainer"),"NextMessageDisabled");else $css.add($("readingPaneContentContainer"),"NextMessageDisabled");if(a.hasPrev)$css.remove($("readingPaneContentContainer"),"PreviousMessageDisabled");else $css.add($("readingPaneContentContainer"),"PreviousMessageDisabled")};__p.reset=function ReadingPane$reset(){if(InboxPage.isReadingPaneOn){if(this._isConversationAttached())this.cv.remove();this.elt.innerHTML="";this.elt.scrollTop=0}this.mode=ReadingPane.NO_MODE};__p.getItemId=function ReadingPane$getItemId(){return this.cv.id()};__p.getMessagePart=function ReadingPane$getMessagePart(a){return this._msgParts[a]};__p.numMessageParts=function ReadingPane$numMessageParts(){return this._msgPartsArray.length};__p.isVoicemail=function ReadingPane$isVoicemail(){if(this.cv.isConversation())return false;else return this.getActionableMsgPart().getBody().mb.vm()};__p.getSelectedMessageData=function ReadingPane$getSelectedMessageData(){var a=null;if(this.isShowingMessage()){var b=this.cv;if(b.isConversation()){var c=b.secretCid()||b.cid();if(c&&InboxPage.messageList.ml.containsId(c))a=MessageList.createSelectedMessageData(false,[c],[""])}else{var d=this.getActionableMsgPart(),f=[d.msg.mid()],g=InboxPage.createMessageAuxData(d.getBody().mb.auxData()),e=[g];a=MessageList.createSelectedMessageData(false,f,e,d.msg.duplicateMsgIds())}}return a};__p.getActionableMsgPartActions=function ReadingPane$_getActionableMsgPartActions(){var a=this.getActionableMsgPart();return a.getActionsHandler()};__p.getActionableMsgPart=function ReadingPane$getActionableMsgPart(){if(null==this._actionMid)this._assignActionMid();var a=this._msgParts[this._actionMid];return a};__p._assignActionMid=function ReadingPane$_assignActionMid(){if(1==this._msgPartsArray.length)this._actionMid=this._msgPartsArray[0].msg.mid();else{var c=this._msgPartsArray.length;for(var a=0;a<c;a++){var b=this._msgPartsArray[a];if(!b.msg.isDraft()){this._actionMid=b.msg.mid();break}}}if(null==this._actionMid)this._actionMid=this._msgPartsArray[0].msg.mid()};__p.collapseAll=function ReadingPane$collapseAll(){this._updateSubSubjectUi(false);this._doForAllMessageParts(function(a){if(a.msg.isExpanded())a.updateHeaderUi(false)});$BSI.reportEvent("rm.clsall")};__p.expandAll=function ReadingPane$expandAll(){$BSI.reportEvent("rm.expall");if(this._allBodies)this._expandAllHeadersUi();else{var b=null,d={},f=this._msgPartsArray.length;for(var c=0;c<f;c++){var a=this._msgPartsArray[c];if(null==b&&!a.hasAnyBody())b=a.msg.mid();if(!a.hasAnyBody())d[a.msg.mid()]=a.msg.idx()}if(null!=b){var e=new PostProcData(false,false);InboxPage.maybeUpdatePostProcDataForMessage(e,true,false);var g=InboxPage.createDataEventHandlers(e,false,false,false,true,false,true);InboxServices.beginGetManyMessageParts(this.cv.cid(),InboxPage.folderList.fid,b,-1,d,!this.cv.ulr(),$CD(this,this._endExpandAll),g)}else this._expandAllHeadersUi()}};__p._endExpandAll=function ReadingPane$_endExpandAll(d,e){var a=d.MessagePartData,c;for(var b in a)if(!FunctionHelper.isSpecialMember(a,b)){c=this._msgParts[b];c.setPartData(MessageBody.Types.Part,a[b]);c.updateHeaderUi(true)}this._insertIdentityContext(d.IdentityContext);jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.ongetmessagepart,{ctx:e});this.expandAll()};__p._expandAllHeadersUi=function ReadingPane$_expandAllHeadersUi(){this._updateSubSubjectUi(true);this._doForAllMessageParts(function(a){a.updateHeaderUi(true)});this._allBodies=true;var a=InboxPage.messageList.ml;if(a.containsId(this.cv.id())||a.containsId(this.cv.secretCid()))InboxActions.markAsRead();else Messages.markAsReadUnread(this.getSelectedMessageData(),true)};__p._updateSubSubjectUi=function ReadingPane$_updateSubSubjectUi(a){$replaceClass($("subSubjectToolbar"),a?ReadingPane.allNotExpandedClass:ReadingPane.allExpandedClass,a?ReadingPane.allExpandedClass:ReadingPane.allNotExpandedClass)};__p._getTargetMessagesForReRender=function ReadingPane$_getTargetMessagesForReRender(j,g){var c=null,f={},h=this._msgPartsArray.length,d=0,e=0;for(var a=0;a<h;a++){var b=this._msgPartsArray[a];if(g(j,b)){if(null==c){c=b.msg.mid();d=a}e=a;f[b.msg.mid()]=b.msg.idx()}}var i=e-d+1;return {mpMap:f,startingMid:c,numParts:i}};__p._markMessagePartForJmr=function ReadingPane$_markMessagePartForJmr(d,a,o,l,n){var h=false,b=HM.JmrType;if(b.Unsubscribe==a||b.Junk==a||b.Phish==a||b.Compromised==a){var i=false;if(!InboxPage.Config.hasSeenReportUi){i=!confirm(Page.decode(InboxPage.Strings.allowJunkReportingQuestion));if(i)return;h=true}}var f=d.getSelectedMessageData(),m=InboxPage.createMoveOrJunkActionMessageListRenderingInfo(f,true,false),c=this._getTargetMessagesForReRender(d,l),e=d.getBody().mb.unsubscribeUrl(),j=b.Unsubscribe==a&&e!=null&&e!="",g=c.startingMid!=null&&!j,k=new PostProcData(false,false);InboxPage.maybeUpdatePostProcDataForMessage(k,true,false);var p=InboxPage.createDataEventHandlers(k,false,false,false,true,false,true);InboxServices.beginMarkMessagePartForJmr(InboxPage.messageList.ml,g,this.cv.cid(),InboxPage.folderList.fid,c.startingMid,c.numParts,g?c.mpMap:{o:"o"},m,f.mids[0],f.mads[0],d.msg.fid(),a,h,n,o,$CD(this,this._endMarkMessagePartForJmr),p);if(j)window.open(e)};__p.markMessagePartAsJunk=function ReadingPane$markMessagePartAsJunk(d,b,a){var c=this._msgParts[d];if(1==this._msgPartsArray.length)c.markAsUnsafe(b,a);else{var e=function(b,a){return a.msg.contactEmail()==b.msg.contactEmail()&&a.hasAnyBody()&&a.msg.mid()!=b.msg.mid()};this._markMessagePartForJmr(c,b,false,e,a)}};__p.markMessagePartAsNotJunk=function ReadingPane$markMessagePartAsNotJunk(c,b){var a=this._msgParts[c],e=a.getSelectedMessageData();if(1==this._msgPartsArray.length)a.markAsSafe(b);else{var d=function(b,a){return a.msg.contactEmail()==b.msg.contactEmail()&&a.hasAnyBody()&&(a.msg.fid()!=InboxPage.Config.sysFldrs.junkFid||a.msg.mid()!=b.msg.mid())};this._markMessagePartForJmr(a,HM.JmrType.NotJunk,b,d,HM.RemoveSenderFromListOption.None)}};__p.markMessagePartAsUnsubscribe=function ReadingPane$markMessagePartAsUnsubscribe(c){var a=this._msgParts[c],e=a.getSelectedMessageData();if(1==this._msgPartsArray.length)a.unsubscribe();else{var d=function(c,b){return b.msg.contactEmail()==a.msg.contactEmail()&&b.hasAnyBody()},b=a.getRemoveOption();this._markMessagePartForJmr(a,HM.JmrType.Unsubscribe,false,d,b)}};__p._endMarkMessagePartForJmr=function ReadingPane$_endMarkMessagePartForJmr(e,a){var b=HM.JmrType;InboxServices.preEndUpdateUi(e,InboxServices.Operations.MarkMessagePartForJmr,{mids:[a.mpMid],isBulk:false,jmrType:a.jmrType},InboxPage.messageList.ml);if(b.Unsubscribe==a.jmrType||b.Junk==a.jmrType||b.Phish==a.jmrType)InboxPage.Config.hasSeenReportUi=true;if(a.fetchConversation){var c=e.MessagePartData;for(var d in c){if(FunctionHelper.isSpecialMember(c,d))continue;var g=c[d],f=this._msgParts[d];f.setPartData(MessageBody.Types.Part,g);f.hideHistory();f.invalidateFullBody()}this._insertIdentityContext(e.IdentityContext)}if(b.Junk==a.jmrType||b.Phish==a.jmrType||b.Compromised==a.jmrType||b.NotJunk==a.jmrType&&a.mpFid==InboxPage.Config.sysFldrs.junkFid)this._removeMessagePartFromUi(a.mpMid);jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.ongetmessagepart,{ctx:a})};__p.addContactFromMessagePart=function ReadingPane$addContactFromMessagePart(h){var a=this._msgParts[h];if(1==this._msgPartsArray.length)a.addContact();else{var d=function(b,a){return a.msg.contactEmail()==b.msg.contactEmail()&&(a.msg.fid()!=InboxPage.Config.sysFldrs.junkFid||a.msg.mid()!=b.msg.mid())},b=this._getTargetMessagesForReRender(a,d),f=b.startingMid!=null,e=a.getMessageRenderingInfo(),c=new PostProcData(false,false);c.composeFrame.load=true;var g=InboxPage.createDataEventHandlers(c,false,false,false,true,false,true);InboxServices.beginAddContactFromMessagePart(InboxPage.messageList.ml,this.cv,InboxPage.folderList.fid,b.startingMid,b.numParts,f?b.mpMap:{o:"o"},this._msgPartsArray.length,e,a.msg.contactName(),a.msg.contactEmail(),$CD(this,this._endAddContactFromMessagePart),g)}};__p._endAddContactFromMessagePart=function ReadingPane$_endAddContactFromMessagePart(a,b){var c=a.MessagePartData;for(var d in c){if(FunctionHelper.isSpecialMember(c,d))continue;var f=c[d],g=this._msgParts[d];this._replaceMessagePartWithHtml(g,f[HM.MessagePartDataType.Message])}var e=a.InfoPaneHtml;if(e)InboxPage.showInfoPane(e);if(b.fid==InboxPage.Config.sysFldrs.junkFid)this._removeMessagePartFromUi(b.mid);else this._msgParts[b.mid].updateHeaderUi(true);this._insertIdentityContext(a.IdentityContext);if(a.RedirectUrl)MessagePart.showDedupUi(function(){MessagePart.handleRedirect(a,true)});jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.ongetmessagepart,{ctx:b})};__p._insertIdentityContext=function ReadingPane$_insertIdentityContext(a){this.cv.attachIdentityContext(a)};__p._replaceMessagePartWithHtml=function ReadingPane$_replaceMessagePartWithHtml(d,g){var a=d.msg;if(a.icId())$ic.ic.removeIC(a.icId());d.dispose();var b=this.cv.addOrReplaceMessage(a.id(),null,g),f=a.zIndex(),e=a.isExpanded();b.swap(a);b.zIndex(f);var c=new MessagePart(b.getControlElement(),b);c.updateHeaderUi(e);this._msgParts[a.mid()]=c;var h=this._msgPartsArray.indexOf(d);this._msgPartsArray[h]=c};__p.deleteMessagePart=function ReadingPane$deleteMessagePart(f){var c=this._msgParts[f],a=c.getSelectedMessageData();if(1==this._msgPartsArray.length||a.duplicateMsgIds&&a.duplicateMsgIds.length>0)Messages.remove(a);else{var d=InboxPage.createMoveOrJunkActionMessageListRenderingInfo(a,true,false),b=new PostProcData(false,false);b.uiUpdate=true;var e=InboxPage.createDataEventHandlers(b,false,false,true,false,false);InboxServices.beginDeleteMessagePart(InboxPage.messageList.ml,InboxPage.readingPane.cv.id(),a.mids[0],a.mads[0],c.msg.fid(),d,$CD(this,this._endDeleteMessagePart),e)}};__p._endDeleteMessagePart=function ReadingPane$_endDeleteMessagePart(c,a){var b=a.mid;InboxServices.preEndUpdateUi(c,InboxServices.Operations.DeleteMessagePart,{mids:[b],isBulk:false},InboxPage.messageList.ml);this._removeMessagePartFromUi(b);InboxServices._endUpdateUi(c,a);jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.ongetmessagelist,{ctx:a})};__p._removeMessagePartFromUi=function ReadingPane$_removeMessagePartFromUi(b){var e=this._msgParts[b],c=e.msg,g=c.isUnreadOnClient();this._msgParts[b]=null;delete this._msgParts[b];this._msgPartsArray.remove(e);e.dispose();c.remove();this.cv.removeItem(c);if(b==this._actionMid)this._actionMid=null;var a=InboxPage.messageList,f=this.getItemId();if(a.ml.getById(f)&&this._msgPartsArray)a.updateCount(f,this._msgPartsArray.length);else{this.reset();var d=a.getAutoSelectIndex();if(d!=-1){a.selectByIndex(d,true,true);a.openMessageByIndex(d)}}};__p.getUnreadMids=function ReadingPane$getUnreadMids(){var a={};a.unreadMids=[];a.foundDupes=false;this._doForAllMessageParts(function(b){var c=b.getBody();if(b.msg.isMixedReadState()&&(!c||c&&!c.mb.vm()))if(b.msg.duplicateMsgIds()&&b.msg.duplicateMsgIds().length>0){a.foundDupes=true;for(var d=0;d<b.msg.duplicateMsgIds().length;d++)a.unreadMids.push(b.msg.duplicateMsgIds()[d])}else{var e=b.msg.mid();a.unreadMids.push(e)}});return a};__p.updateReadState=function ReadingPane$updateReadState(b,a){this.cv.updateReadState(b,a)};ReadingPane.downloadAttachment=function ReadingPane$downloadAttachment(a){if(null!=ReadingPane.downloadFrame)ReadingPane.downloadFrame.src=a};ReadingPane._handleDownloadAttachmentError=function ReadingPane$_handleDownloadAttachmentError(){var a=null;try{var b=null;if(Browser.isIE)b=ReadingPane.downloadFrame.contentWindow.document.parentWindow;else b=ReadingPane.downloadFrame.contentWindow;a={show:b.bShowMessage,block:b.bBlockClient,descr:b.sErrorDescription,yesNo:b.iYesCode,data:b.sData};if(a.show&&a.descr)if(a.block)if(a.yesNo>=0){var d=confirm(a.descr)?a.yesNo:-1;if(15==d&&null!=ReadingPane.downloadFrame)ReadingPane.downloadAttachment(a.data)}else alert(a.descr);else{var c=Infopane.getInstance();c.setContent(a.descr);$css.add(c.elt,"BorderNoTop");c.show()}}catch(e){return}};__p.updateLayout=function ReadingPane$updateLayout(){setTimeout($CD(this,this.collapseLayout),1);setTimeout($CD(this,this._maybeExpandLayout),1)};__p._maybeExpandLayout=function ReadingPane$_maybeExpandLayout(){if(this.isAnyWideBodyExpanded())this._expandLayout()};__p._expandLayout=function ReadingPane$_expandLayout(b){this._hideWideMessageBars();var a=$("contentRight");if(InboxPage.hasSkyscraper){if($css.has(a,"WithSkyscraper"))$css.remove(a,"WithSkyscraper");if(Browser.isIE6)$("MainContent").className=$("MainContent").className}if("BottomUnmanaged"==Page.getLayout()){$css.add(a,"RightUnmanaged");if(Browser.isIE6)a.style.width=$("MainContent").offsetWidth+"px"}else{InboxPage.showFullReadingPane(true,false,b);InboxPage.resetSkyscraperScroll(true);InboxPage.readingPane.focus();InboxToolbar.updateToolbarState()}this.resetMessageWidths();this._doForAllMessageParts(function(a){a.maybeUpdateLiveViewLayout()})};__p.getWideBodyCount=function ReadingPane$getWideBodyCount(){var a=0;this._doForAllMessageParts(function(b){if(b.msg.isExpanded()){var c=b.getBody();if(c.isWide)a++}});return a};__p.isAnyWideBodyExpanded=function ReadingPane$_isAnyWideBodyExpanded(){atLeastOneWideBody=false;this._doForAllMessageParts(function(b){if(b.msg.isExpanded()){var a=b.getBody();a.calculateWidth();if(a.isWide){atLeastOneWideBody=true;return false}}});return atLeastOneWideBody};__p.collapseLayout=function ReadingPane$collapseLayout(){var a=$("contentRight");if(InboxPage.hasSkyscraper){$css.add(a,"WithSkyscraper");if(Browser.isIE6)$("MainContent").className=$("MainContent").className}if("BottomUnmanaged"==Page.getLayout()){if($css.has(a,"RightUnmanaged"))$css.remove(a,"RightUnmanaged");if(Browser.isIE6)a.style.width="auto"}this._doForAllMessageParts(function(a){a.maybeUpdateLiveViewLayout()})};__p._handleWideLayout=function ReadingPane$_handleWideLayout(){this.collapseLayout();setTimeout($CD(this,this._handleWideLayout2),1)};__p._handleWideLayout2=function ReadingPage$_handleWideLayout2(){var b=0;this._doForAllMessageParts(function(d){if(d.msg.isExpanded()){var c=d.getBody();c.calculateWidth();if(c.isWide){var a=c.mb.getPrefixedElt("readMsgBodyContainer");if(a&&a.scrollWidth>b)b=a.scrollWidth}}});this._unhideWideMessageBars();var c=this.isAnyWideBodyExpanded(),f=Browser.isSF?document.body:$tag(document,"HTML")[0],a=parseInt(InboxPage.Config.readingPane.unmanagedAutoExpandMessageAtWidth);a=isNaN(a)||a<0?-1:a;var h="BottomUnmanaged"==Page.getLayout(),d=this.isFullView&&c&&(h&&(a==-1||f.offsetWidth<a)||!InboxPage.hasSkyscraper),e=true;if(this.doubleClicked){this.doubleClicked=false;d=true}if(d){var g=$("contentRight");if(g.offsetWidth-(Browser.isIE6?b+35:b)<160)e=false;if(Browser.isIE6)setTimeout($CD(this,this._expandLayout),0);else this._expandLayout()}else if(c&&this.isFullView)this._doForAllMessageParts(function(b){if(b.msg.isExpanded()){var a=b.getBody();if(a.isWide&&!a.mb.safetyBarLinkExpands())a.showWideMsgBar()}});InboxPage.callDelayedBsi(e)};__p._hideWideMessageBars=function ReadingPane$_hideWideMessageBars(){var a=$("contentRight");$css.add(a,"HideWideMessageBars")};__p._unhideWideMessageBars=function ReadingPane$_unhideWideMessageBars(){var a=$("contentRight");if($css.has(a,"HideWideMessageBars"))$css.remove(a,"HideWideMessageBars")};__p._onShowFullClick=function ReadingPane$_onShowFullClick(){this._expandLayout()};__p.resetMessageWidths=function ReadingPane$resetMessageWidths(){if("BottomUnmanaged"!=Page.getLayout())this._doForAllMessageParts(function(a){a.resetWidth()})};__p.closeMessage=function ReadingPane$closeMessage(a){if(a===undefined)a=true;var b=a?new PostProcData(true,!InboxPage.isRestoringState,false):null;if(b)InboxPage.maybeUpdatePostProcDataForMessage(b,false,false);InboxPage.showFullReadingPane(false,false,b);if(!InboxPage.isReadingPaneOn)InboxPage.messageList.restoreSelection();setTimeout(InboxToolbar.updateToolbarState,1)};__p.openFullView=function ReadingPane$openFullView(){this._expandLayout(new PostProcData(false,!InboxPage.isRestoringState))};__p.showFullView=function ReadingPane$showFullView(){if(this.isFullView)return;var a=$("readingPaneSplitPane");if("Bottom"==InboxPage.Config.readingPane.location){a._oldTop=a.style.top;a.style.top=null}else if("Right"==InboxPage.Config.readingPane.location){a._oldLeft=a.style[Loc.LEFT];a.style[Loc.LEFT]=null}InboxPage._onResize(null,false,true);$updateClass(a,["ReadingPaneSplitPaneFull"],["ReadingPaneSplitPaneRight","ReadingPaneSplitPaneBottom","ReadingPaneSplitPaneHidden"]);$css.add($("mainContentContainer"),"ReadMsgMode");this.isFullView=true;if(InboxPage.messageList.hasFocus())this.focus(true);this.resetMessageWidths()};__p.hideFullView=function ReadingPane$hideFullView(){if(!this.isFullView)return;this.collapseLayout();var b=InboxPage.Config.readingPane.location,a=$("readingPaneSplitPane");if("Bottom"==b){a.style.top=a._oldTop;a.style._oldTop=null;$updateClass(a,["ReadingPaneSplitPaneBottom"],["ReadingPaneSplitPaneFull"])}else if("Right"==b){a.style[Loc.LEFT]=a._oldLeft;a.style._oldLeft=null;$updateClass(a,["ReadingPaneSplitPaneRight"],["ReadingPaneSplitPaneFull"])}else $css.add(a,"ReadingPaneSplitPaneHidden");InboxPage._onResize(null,$getDisplay($("searchPane")));$css.remove($("mainContentContainer"),"ReadMsgMode");this.isFullView=false;if(this.hasFocus())setTimeout($CD(InboxPage.messageList,InboxPage.messageList.focus),1);this.resetMessageWidths()};__p.isShowingMessage=function ReadingPane$isShowingMessage(){return this.mode==ReadingPane.MESSAGE_MODE&&(InboxPage.isReadingPaneOn||this.isFullView)};ReadingPane.doDelayLoad=function ReadingPane$doDelayLoad(b){var a;if(b.cv.isConversation()){a=InboxPage.createConversationRenderingInfo(false);a.ConversationId=b.cv.cid()}else{var d=b.cv.mid(),c;a=InboxPage.createMessageRenderingInfo();a.MessageId=d;c=InboxPage.messageList.ml.getSenderEmailsFromMids([d]);if(c.length>0)a.SenderEmail=c[0]}a.FolderId=InboxPage.folderList.fid;var e=new PostProcData(false,false);e.uiUpdate=true;InboxPage.beginRefreshInbox(false,false,null,true,a,false,b.cv.isConversation(),null,null,false,null,{autoGeneratedRequest:true},e)};__p.hasFocus=__p.focus=function ReadingPane$emptyFunction(){};__p.showTaggingInfo=function ReadingPane$showTaggingInfo(a){var e=a[0],f=a[1],d=a[2],c=a[3],b;$BSI.reportEvent("ReadView.Messaging.Mail.tagInfo");b=$(c)!=null?FolderQuickViewListHelper.getFolderNameByFid(c):"";_TT(e,d,f.format(b))};ReadingPane.createClass("ReadingPane");function MessagePart(b,a){Control.create(this,b);this.msg=a;this._actions=new MessagePartActions(this);this._setStateFromDom();this._toolbar=new Toolbar(this.msg.getPrefixedElt("header"),this._actions.getToolbarCallback());this._toolbar.setIgnoreActions(["editContact","moreActions"])}MessagePart.hideShadows="HideShadows";MessagePart.bodyClasses={};MessagePart.bodyClasses[MessageBody.Types.Full]="FullPart";MessagePart.bodyClasses[MessageBody.Types.Part]="SinglePart";MessagePart.hoverZIndex=500;MessagePart.focusZIndex=600;__p=MessagePart.prototype={};__p.dispose=function MessagePart$dispose(){if(this._body)this._body.dispose();if(this._toolbar)this._toolbar.dispose();if(this._actions)this._actions.dispose();if(this._container){this._container.detachEvent("onmouseover",this._onHoverDelegate);this._container.detachEvent("onmouseout",this._onOutDelegate);this._container.detachEvent("onfocus",this._onFocusDelegate);this._container.detachEvent("onblur",this._onBlurDelegate);this._container.detachEvent("onfocusin",this._onFocusDelegate);this._container.detachEvent("onfocusout",this._onBlurDelegate)}this._body=this._toolbar=this._actions=this._container=null;Control.destroy(this)};__p._setStateFromDom=function MessagePart$_setStateFromDom(){var a=this.elt;this._containerDiv=a.children[0];this._container=a.children[0].children[0];this._currentBodyType=this.msg.defaultBodyType();var c=this._currentBodyType,b=this.msg.getBody(c);this._body=new MessagePartBody(this._getBodyElt(),b,this._actions,$CD(this,this._beginGetBodyHtmlByType),this.msg.isExpanded());this.resetWidth();this._onHoverDelegate=$CD(this,this._onHover);this._onOutDelegate=$CD(this,this._onOut);this._onFocusDelegate=$CD(this,this._onFocus);this._onBlurDelegate=$CD(this,this._onBlur);this._container.attachEvent("onmouseover",this._onHoverDelegate);this._container.attachEvent("onmouseout",this._onOutDelegate);this._container.attachEvent("onfocus",this._onFocusDelegate);this._container.attachEvent("onblur",this._onBlurDelegate);this._container.attachEvent("onfocusin",this._onFocusDelegate);this._container.attachEvent("onfocusout",this._onBlurDelegate)};__p._isCurrentBodyType=function MessagePart$_isCurrentBodyType(a){return a===this._currentBodyType},__p._getCurrentBodyType=function MessagePart$_getCurrentBodyType(){return this._currentBodyType};__p._hasBodyType=function MessagePart$_hasBodyType(a){return this.msg.hasBody(a)};__p._getBodyElt=function MessagePart$_getBodyElt(){return this.msg.getPrefixedElt("msgPartBody")};__p.getBody=function MessagePart$getBody(){return this.hasAnyBody()?this._body:null};__p.hasAnyBody=function MessagePart$hasAnyBody(){return this.msg.hasAnyBody()};__p.invalidateFullBody=function MessagePart$invalidateFullBody(){this.msg.invalidateBody(MessageBody.Types.Full)};__p._beginGetBodyHtmlByType=function MessagePart$_beginGetBodyHtmlByType(a,b,e){a=a||this._getCurrentBodyType();var c=$CD(this,function(c,b){this._endGetBodyHtml(c,b,a)}),d=InboxPage.createDataEventHandlers(e,false,false,false,true,false,true);switch(a){case MessageBody.Types.Part:return InboxServices.beginGetSingleMessagePart(InboxPage.readingPane.cv.cid(),this.msg.fid(),b,this.msg.idx(),!InboxPage.readingPane.cv.ulr(),c,d);case MessageBody.Types.Full:return InboxServices.beginGetFullMessagePart(InboxPage.readingPane.cv.cid(),b,this.msg.idx(),!InboxPage.readingPane.cv.ulr(),c,d)}};__p.setPartData=function MessagePart$setPartData(b,a){if(a[HM.MessagePartDataType.ToList])this.msg.recipientList(a[HM.MessagePartDataType.ToList]);if(a[HM.MessagePartDataType.Body])this.setBodyHtml(b,a[HM.MessagePartDataType.Body])};__p._endGetBodyHtml=function MessagePart$_endGetBodyHtml(c,b,a){a=a||MessageBody.Types.Part;if(b&&b.mayRedirect)MessagePart.handleRedirect(c);var e=c.MessagePartData,d=e[this.msg.mid()];this.setPartData(a,d);jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.ongetmessagepart,{ctx:b})};MessagePart.handleRedirect=function MessagePart$handleRedirect(a,c){if(null!=a.RedirectUrl&&""!=a.RedirectUrl){var b=a.RedirectUrl;if(c)top.location.href=b;else $BSI.navigateTo(b);return}};__p.setBodyHtml=function MessagePart$setBodyHtml(a,b){var d=this._getBodyElt(a),c=this.msg.addOrReplaceBody(a,null,b);if(this._isCurrentBodyType(a)){this._body.setBody(c);this._moveActionMenu();if(this.msg.isExpanded())this._wireUpLiveViews();this._maybeUpdateLayout();this.resetWidth()}};__p._moveActionMenu=function MessagePart$_moveActionMenu(){var a=this.msg.getPrefixedElt("aph");if(a&&!a.innerHTML){var b=this.msg.getPrefixedElt("act");if(b)a.appendChild(b)}};__p.getSelectedMessageData=function MessagePart$getSelectedMessageData(){return MessageList.createSelectedMessageData(false,[this.msg.mid()],[InboxPage.createMessageAuxData(this.msg.auxData())],this.msg.duplicateMsgIds())};__p._getDefaultMessageRenderingInfo=function MessagePart$_getDefaultMessageRenderingInfo(){var a=InboxPage.createMessageRenderingInfo();a.MessageId=this.msg.mid();a.FolderId=this.msg.fid();a.AuxData=InboxPage.createMessageAuxData(this.msg.auxData());a.SenderEmail=this.msg.contactEmail();return a};__p.getMessageRenderingInfo=function MessagePart$getMessageRenderingInfo(){return this.hasAnyBody()?this.getBody().createMessageRenderingInfo():this._getDefaultMessageRenderingInfo()};__p.resetWidth=function MessagePart$resetWidth(){if("BottomUnmanaged"!=Page.getLayout()){var b=this._container,a=this.msg.getPrefixedElt("ctr");if(null!=a){b.style.width="auto";a.style.width="auto";if(this.hasAnyBody()&&this.msg.isExpanded()){var c=this.getBody().getMsgContainer();if(c&&c.scrollWidth>b.offsetWidth){a.style.width=a.offsetWidth+"px";b.style.width=c.scrollWidth+24+"px"}}}}};__p.showHistory=function MessagePart$showHistory(){if(!this._hasBodyType(MessageBody.Types.Full)){var a=InboxPage.createMessageRenderingInfo();a.SenderEmail=this.msg.contactEmail();a.MessageId=this.msg.mid();a.FolderId=this.msg.fid();a.AuxData=InboxPage.createMessageAuxData(this.msg.auxData());var b=new PostProcData(false,false);InboxPage.maybeUpdatePostProcDataForMessage(b,true,false);var c=InboxPage.createDataEventHandlers(b,false,false,false,true,false,true);InboxServices.beginGetFullMessagePart(InboxPage.readingPane.cv.cid(),a,this.msg.idx(),!InboxPage.readingPane.cv.ulr(),$CD(this,this._endShowHistory),c)}else this._updateHistoryUi(true)};__p.hideHistory=function MessagePart$hideHistory(){this._updateHistoryUi(false)};__p._endShowHistory=function MessagePart$_endShowHistory(b,a){this._endGetBodyHtml(b,a,MessageBody.Types.Full);this._updateHistoryUi(true)};__p._updateHistoryUi=function MessagePart$_updateHistoryUi(a){this._showBody(MessageBody.getType(a))};__p._showBody=function MessagePart$_showBody(a){if(this._isCurrentBodyType(a))return;$replaceClass(this._container,MessagePart.bodyClasses[this._getCurrentBodyType()],MessagePart.bodyClasses[a]);this._body.setBody(this.msg.getBody(a));this._currentBodyType=a;if(this.msg.isExpanded())this._wireUpLiveViews();this._maybeUpdateLayout()};__p.toggleDetails=function MessagePart$toggleDetails(){var a=!this.msg.detailsVisible();this.setDetailsDisplay(a);return a};__p.setDetailsDisplay=function MessagePart$setDetailsDisplay(a){var b=this.getBody();b.setDetailsDisplay(a);this.msg.detailsVisible(a)};__p.getActionsHandler=function MessagePart$getActionsHandler(){return this._actions};__p.getBsiData=function MessagePart$getBsiData(a){if(typeof a!="object")a={};a.msgIndex=InboxPage.readingPane.numMessageParts()>1?this.msg.idx()+1:this.msg.idx();return a};__p.toggleHeader=function MessagePart$toggleHeader(){var a=true;if(this.msg.isCollapsible()){a=!this.msg.isExpanded();if(a)this._expand();else this._collapse()}return a};__p._expand=function MessagePart$_expand(){$BSI.reportEvent("mp.exp",this.getBsiData());this.loadBody($CD(this,function(){this.updateHeaderUi(true)}))};__p.loadBody=function MessagePart$loadBody(a){a=typeof a=="function"?a:function(){};var d=$CD(this,function(c,b){this._endGetBodyHtml(c,b);a()});if(!this.hasAnyBody()){var c=this._getDefaultMessageRenderingInfo();Page.setPerformanceId("RMP");var b=new PostProcData(false,false);InboxPage.maybeUpdatePostProcDataForMessage(b,true,false);var e=InboxPage.createDataEventHandlers(b,false,false,false,true,false,true);InboxServices.beginGetSingleMessagePart(InboxPage.readingPane.cv.cid(),this.msg.fid(),c,this.msg.idx(),!InboxPage.readingPane.cv.ulr(),d,e);return false}else return a()};__p._collapse=function MessagePart$_collapse(){if(InboxPage.readingPane.isFullView&&this.getBody().isWide&&1==InboxPage.readingPane.getWideBodyCount())InboxPage.readingPane.collapseLayout();this.updateHeaderUi(false);$BSI.reportEvent("mp.cls",this.getBsiData())};__p.updateHeaderUi=function MessagePart$updateHeaderUi(a){if(a==this.msg.isExpanded())return;this.msg.isExpanded(a);if(a){this._moveActionMenu();this._wireUpLiveViews()}this._maybeUpdateLayout();this.resetWidth()};__p._wireUpLiveViews=function MessagePart$_wireUpLiveViews(){if(this.hasAnyBody())this.getBody().wireUpLiveViews()};__p._maybeUpdateLayout=function MessagePart$_maybeUpdateLayout(){this._maybeUpdateReadingPaneLayout();this.maybeUpdateLiveViewLayout()};__p._maybeUpdateReadingPaneLayout=function MessagePart$_maybeUpdateReadingPaneLayout(){if(InboxPage.readingPane.isFullView)InboxPage.readingPane.updateLayout()};__p.maybeUpdateLiveViewLayout=function MessagePart$maybeUpdateLiveViewLayout(){if(this.hasAnyBody())this.getBody().maybeUpdateLiveViewLayout()};__p._onMarkAsSafe=function MessagePart$_onMarkAsSafe(){Page.setPerformanceId("MS");InboxPage.readingPane.markMessagePartAsNotJunk(this.msg.mid(),false)};__p._onMarkAsUnsafe=function MessagePart$_onMarkAsUnsafe(){Page.setPerformanceId("MU");InboxPage.readingPane.markMessagePartAsJunk(this.msg.mid(),HM.JmrType.Junk)};__p._onUnsubscribe=function MessagePartBody$_onUnsubscribe(){InboxPage.readingPane.markMessagePartAsUnsubscribe(this.msg.mid())};__p.markAsSafe=function MessagePart$markAsSafe(b){var a=this.getBody().createMessageRenderingInfo();a.AuxData=null;Safety.markAsNotJunk(this.getSelectedMessageData(),InboxPage.folderList.fid,a,b)};__p.markAsUnsafe=function MessagePart$markAsUnsafe(c,d){var a=this.getSelectedMessageData(),b=InboxPage.folderList.fid;if(b!=InboxPage.Config.sysFldrs.junkFid)if(c==HM.JmrType.Phish)Safety.markAsPhish(a,b);else Safety.markAs(a,c,b,d,false);else Messages.remove(a)};__p.unsubscribe=function MessagePartBody$unsubscribe(){var b=this.getRemoveOption(),a=this.getBody().createMessageRenderingInfo();a.AuxData=null;Safety.markAsUnsubscribe(this.getSelectedMessageData(),InboxPage.folderList.fid,this.getBody().mb.unsubscribeUrl(),a,b)};__p.getRemoveOption=function MessagePartBody$getRemoveOption(){var a=HM.RemoveSenderFromListOption.None;if(this.msg.isSenderInContactList())a=HM.RemoveSenderFromListOption.RemoveContact;else if(this.msg.isSenderInWhiteList())a=HM.RemoveSenderFromListOption.RemoveSafeSender;return a};__p.addContact=function MessagePart$addContact(){var a=this.msg.fid()==InboxPage.Config.sysFldrs.junkFid,d=this.getMessageRenderingInfo(),c=a?InboxPage.createMoveOrJunkActionMessageListRenderingInfo(this.getSelectedMessageData(),false,true):null,b=new PostProcData(false,false);b.composeFrame.load=true;InboxPage.maybeUpdatePostProcDataForMessage(b,!a,false);if(a)b.uiUpdate=true;var e=InboxPage.createDataEventHandlers(b,a,a,a,!a,false);InboxServices.beginAddContactFromMessage(InboxPage.messageList.ml,InboxPage.readingPane.cv,d,c,this.msg.contactName(),this.msg.contactEmail(),$CD(this,this._endAddContact),e)};__p._endAddContact=function MessagePart$_endOnAddContact(a,c){InboxServices.Events.endupdateui.fire([a,false,c]);if(a.RedirectUrl)MessagePart.showDedupUi(function(){MessagePart.handleRedirect(a,true)});var b=InboxPage.messageList.ml.getById(this.msg.mid());if(b)b.invalidateMad()};MessagePart.showDedupUi=function MessagePart$showDedupUi(c){var d=function(d,a){if(1==a)c()},a=DemandLoadHandler.getContent(HM.ContentId.ReadMessageAddContact),b=new Alert(Alert.Importance.none,a.Title,String.format("<div {0}>{1}</div>",a.Sutra,a.Message),true,null);b.addButton(a.ActionButton,1,true,false);b.addButton(a.Cancel,0,false,true);b.setCallback(d);gShowAlert(b)};__p._setShadows=function MessagePart$_setShadows(c){var b=this._container,a=MessagePart.hideShadows;if(c){if($css.has(b,a))$css.remove(b,a)}else $css.add(b,a)};__p._resetZIndex=function MessagePart$_resetZIndex(){var a=this._container;if(this._isFocusOn)a.style.zIndex=MessagePart.focusZIndex;else if(this._isHoverOn)a.style.zIndex=MessagePart.hoverZIndex;else a.style.zIndex=1};__p._handleFocusEvent=function MessagePart$_handleFocusEvent(a){this._setShadows(a);this._resetZIndex()};__p._onHover=function MessagePart$_onHover(){this._isHoverOn=true;this._handleFocusEvent(true)};__p._onOut=function MessagePart$_onOut(){this._isHoverOn=false;this._handleFocusEvent(false)};__p._onFocus=function MessagePart$_onFocus(){this._isFocusOn=true;this._handleFocusEvent(true)};__p._onBlur=function MessagePart$_onBlur(){this._isFocusOn=false;this._handleFocusEvent(false)};MessagePart.createClass("MessagePart");function MessagePartBody(e,b,d,a,c){Control.create(this,e);this.mb=b;this._actions=d;this._getBodyDelegate=a;this.isWide=false;if(this.mb){this._setStateFromDom();if(c)setTimeout($CD(this,this.wireUpLiveViews),1);if(this.mb.isSbd())Infopane.forceHide()}}__p=MessagePartBody.prototype={};__p.dispose=function MessagePartBody$dispose(){this._disposeLiveViews();if(this._detailsElt){this._detailsElt.detachEvent("onmouseover",this._detailsHover);this._detailsElt.detachEvent("onmouseout",this._detailsOut);this._detailsElt.detachEvent("onfocus",this._detailsHover);this._detailsElt.detachEvent("onblur",this._detailsOut)}if(this._toolbar){this._toolbar.dispose();this._actions=null}Control.destroy(this)};__p._disposeLiveViews=function MessagePartBody$_disposeLiveViews(){if(this.hmlvContainer){this.hmlvContainer.dispose();this.hmlvContainer=null}if(this.elvData)this.elvData.forEach(function(a){if(a&&a.binding){LiveViews.detachElvControlHandlers(a.binding);a.binding.dispose();a.binding=null}},null)};__p._setStateFromDom=function MessagePartBody$_setStateFromDom(){this.elvData=this._generateExternalLiveViewsData(this.mb.elv());if(this.mb.ulr()&&InboxPage["readingPane"])InboxPage.readingPane.cv.ulr(true);this._toolbar=new Toolbar(this.mb.getPrefixedElt("bodyHdr"),this._actions.getToolbarCallback());this._detailsElt=this.mb.getPrefixedElt("details");this._detailsHover=$CD(this,this._onDetailsHover);this._detailsOut=$CD(this,this._onDetailsOut);this._detailsElt.attachEvent("onmouseover",this._detailsHover);this._detailsElt.attachEvent("onmouseout",this._detailsOut);this._detailsElt.attachEvent("onfocus",this._detailsHover);this._detailsElt.attachEvent("onblur",this._detailsOut)};__p.setBody=function MessagePartBody$setBody(a){this._disposeLiveViews();if(this.mb)a.swap(this.mb,true);else a.attach(this.elt);this.mb=a;this._setStateFromDom();this._isWidthCalculated=false};__p.createMessageRenderingInfo=function MessagePartBody$createMessageRenderingInfo(){var a=new HM.MessageRenderingInfo,b=this.mb;a.MessageId=b.mid();a.FolderId=InboxPage.folderList.fid;a.AllowUnsafeContent=b.showUnsafe();a.OverrideCodepage=b.codePageOverride();a.AuxData=InboxPage.createMessageAuxData(b.auxData());a.MarkAsRead=true;a.SenderEmail=b.contactEmail();return a};__p.calculateWidth=function MessagePartBody$calculateWidth(){if(this._isWidthCalculated)return;var d=$("contentRight"),c=$("RadAd_Skyscraper"),f=c?c.offsetWidth:0,e="BottomUnmanaged"==Page.getLayout(),a=this.mb.getPrefixedElt("readMsgBodyContainer"),b=$("readingPaneContainer"),g=a?a.scrollWidth+a.offsetWidth:0;this.isWide=Browser.isIE6&&e?a&&a.scrollWidth+35>d.offsetWidth-f:a&&b&&a.scrollWidth>b.offsetWidth;this._isWidthCalculated=true};__p.showWideMsgBar=function MessagePartBody$showWideMsgBar(){var a=this.mb.getPrefixedElt("wideMsgBarPlaceholder");if(null==a.innerHTML||""==a.innerHTML)a.innerHTML=$("wideMsgBar").innerHTML};__p.getMsgContainer=function MessagePartBody$getMsgContainer(){return this.mb.getPrefixedElt("MsgContainer")};__p._onBodyClick=function MessagePartBody$_onBodyClick(a){var e=false;if(a&&a.srcElement&&a.srcElement.__box__)return true;if(this._isSvmLinkClick(a)){var n=this.createMessageRenderingInfo(),h=InboxPage.createMessageListRenderingInfo(true),d=a.srcElement.href,g=new PostProcData(true,true);InboxPage.maybeUpdatePostProcDataForMessage(g,true,false);g.uiUpdate=true;InboxPage.configureAutoSelect(h);var o=InboxPage.createDataEventHandlers(g,false,false,true,true,false);InboxServices.beginSvmFeedback(d,n,h,o);a.returnValue=false;a.cancelBubble=true;e=true}if(this._isDocumentLinkClick(a))a.srcElement.href=String.format("{0}&msgId={1}",a.srcElement.href,this.mb.mid());if(a&&a.srcElement&&!$isNavigatingLink(a.srcElement)){try{var f=a.srcElement;if(f.tagName=="A"||f.tagName=="AREA"){var d=f.href;if($U.isLinkABookmark(d)){var k=d.substr(d.indexOf("#")+1),c=jQuery(this.mb.getPrefixedElt("readMsgBodyContainer")).find('a[name="'+k+'"], *[id="'+k+'"]').get(0);if(c)if(InboxPage.isReadingPaneOn){var i=_ge("readingPaneContainer"),j=c.offsetTop,b=c.offsetParent,m=20;while(b&&b!=i&&m>0){j+=b.offsetTop;b=b.offsetParent;m--}i.scrollTop=j}else{var l=$getLocation(c);window.scrollTo(l.left,l.top)}}}}catch(p){}e=true}return !e};__p._isSvmLinkClick=function MessagePartBody$_isSvmLink(c){var a=false;if(this.mb.isSvm()&&"A"==c.srcElement.tagName){var b=c.srcElement.href;if(b&&b.match("cgi-bin/feedback"))a=true}return a};__p._isDocumentLinkClick=function MessagePartBody$_isDocumentLinkClick(a){var b=false;if("A"==a.srcElement.tagName){var c=a.srcElement.getAttribute("type");if(c&&"DocLink"==c){var d=a.srcElement.href,e=d.substr(d.indexOf(".")+1);if(e.indexOf(InboxPage.Config.skyDriveResourceUrlPart)==0)b=true}}return b};__p._getDownloadUrl=function MessagePartBody$_getDownloadUrl(a){var b="";if(a){var e=a.getAttribute("aIdx"),d=a.getAttribute("aDepth"),c=a.getAttribute("entryPt");b=this._getDownloadUrlFromParams(e,d,c)}return b};__p._getDownloadUrlFromParams=function MessagePartBody$_getDownloadUrlFromParams(d,f,c,e){var a="";if(null!=d&&""!=d)a=String.format("/mail/ScanAttachment.aspx?messageid={0}&attindex={1}&cp={2}&attdepth={3}",this.mb.mid(),d,this.mb.codePageOverride(),f);if(null!=c&&""!=c)a=String.format("{0}&entryPt={1}",a,c);var b=$Config.BSI.biciPrevious;if(b&&b!="")a=String.format("{0}&biciPrevious={1}",a,b);if(e)a=String.format("{0}//{1}{2}",window.location.protocol,window.location.hostname,a);return a};__p._getOfficePreviewUrl=function MessagePartBody$_getOfficePreviewUrl(a){var b="";if(a){var d=a.getAttribute("aIdx"),c=a.getAttribute("aDepth");b=this._getOfficePreviewUrlFromParams(d,c)}return b};__p._getOfficePreviewUrlFromParams=function MessagePartBody$_getOfficePreviewUrlFromParams(c,b){var a="";if(c&&b){a=String.format("/mail/ViewOfficePreview.aspx?messageid={0}&folderid={1}&attindex={2}&cp={3}&attdepth={4}&n={5}",this.mb.mid(),InboxPage.folderList.fid,c,this.mb.codePageOverride(),b.encodeUrl(),Page.queryString.newNonce);if(Browser.isIE6)a=String.format("/mail/BrowserSupport.aspx?targetUrl={0}",a.encodeUrl())}return a};__p._onAttachmentClick=function MessagePartBody$_onAttachmentClick(){var a=Control.getAncestorByAttr(event.srcElement,"aIdx");if(null!=a){var e=a.getAttribute("aIdx"),d=a.getAttribute("aDepth"),g=a.getAttribute("wacScenario")=="View";if(InboxPage.allowAction("downloadOrPreviewAttachment",[this.mb.mid(),e,d].join("|")))if(g){var b=this._getOfficePreviewUrlFromParams(e,d);if(b)if(event.shiftKey||event.ctrlKey){window.open(b);event.returnValue=false;event.cancelBubble=true;return false}else $BSI.navigateTo(b)}else{var h=a.getAttribute("entryPt"),c=this._getDownloadUrlFromParams(e,d,h);if(c){var f=a.getAttribute("aNewWin");if(f)window.open(c);else ReadingPane.downloadAttachment(c)}}}};__p.setDetailsDisplay=function MessagePartBody$setDetailsDisplay(a){this.mb.setDetailsVisible(a)};__p._getSelectedMessageData=function MessagePartBody$_getSelectedMessageData(){return MessageList.createSelectedMessageData(false,[this.mb.mid()],[InboxPage.createMessageAuxData(this.mb.auxData())])};__p._onOpenBody=function MessagePartBody$_onOpenBody(){var a=new PostProcData(true,false);InboxPage.maybeUpdatePostProcDataForMessage(a,true,false);this._openMessage(false,a)};__p._onShowUnsafe=function MessagePartBody$_onShowUnsafe(){this._showUnsafe()};__p._onMarkAsSafe=function MessagePartBody$_onMarkAsSafe(){this._actions.markAsNotJunk(true)};function onClickUnsafeLink(a){Control.invoke("MessagePartBody","_onClickUnsafeLink",a)}__p._onClickUnsafeLink=function MessagePartBody$_onClickUnsafeLink(){if(this._isSvmLinkClick())return;var a=event;a.cancelBubble=true;if(confirm(Page.decode(InboxPage.Strings.unsafeLinkQuestion)))this._showUnsafe();else a.returnValue=false};__p._showUnsafe=function MessagePartBody$_showUnsafe(){var a=new PostProcData(true,false);InboxPage.maybeUpdatePostProcDataForMessage(a,true,false);this._openMessage(true,a)};__p._openMessage=function MessagePartBody$_openMessage(e,d,b,c){var a=this.createMessageRenderingInfo();a.AllowUnsafeContent=e;if(b)a.OverrideCodepage=b;if(c)a.MtLang=c;this._getBodyDelegate(this.mb?this.mb.type():null,a,d)};__p._onSelectMenu=function MessagePartBody$_onSelectMenu(){if(event.keyCode==13||event.keyCode!=38&&event.keyCode!=40&&event.keyCode!=9){var c=this.mb.codePageOverride(),d="",a=event.srcElement.value;if(null==a||""==a)return true;if(event.srcElement.name=="CP")c=a;else if(event.srcElement.name=="MT")d=a;var b=new PostProcData(true,false);InboxPage.maybeUpdatePostProcDataForMessage(b,true,false);this._openMessage(this.mb.showUnsafe(),b,c,d)}};__p._onDeleteVMFromPhone=function MessagePartBody$_onDeleteVMFromPhone(){this.mb.vmSafetyBarState(false);InboxPage.messageList.removeVMOnPhoneStatus();InboxServices.deleteVMFromPhone(this.mb.mid())};__p._onMarkVMFAsSaved=function MessagePartBody$_onMarkVMFAsSaved(){this.mb.vmSafetyBarState(true);InboxServices.markVMAsSaved(this.mb.mid())};__p.wireUpLiveViews=function MessagePartBody$wireUpLiveViews(){if(this.mb.hasHmlv()&&!this.hmlvContainer){var a=this.mb.getPrefixedElt("hmlvControl");if(a)this.hmlvContainer=new LiveViewContainerControl(a)}if(this.mb.hasElv())this.wireUpExternalLiveViews()};__p.maybeUpdateLiveViewLayout=function MessagePartBody$maybeUpdateLiveViewLayout(){if(this.mb.hasHmlv()&&this.hmlvContainer)this.hmlvContainer.updateLayout()};__p._generateExternalLiveViewsData=function MessagePartBody$_generateExternalLiveViewsData(data){var elvData=null;if(this.mb.hasElv()){var expandoData=eval(data);elvData=[];if(expandoData)for(var i=0;i<expandoData.length;i++){var currentExpando=expandoData[i],elv={tag:currentExpando[0],id:currentExpando[1],provider:currentExpando[2],url:currentExpando[3],lvh:currentExpando[4],auth:currentExpando[5],authParam:currentExpando[6]};elvData.push(elv)}}return elvData};__p.wireUpExternalLiveViews=function MessagePartBody$wireUpExternalLiveViews(e){LiveViews.isPsaDown=this.mb.isPsaDown();var a=this.elvData;if(a&&a.length>0)for(var c=0;c<a.length;c++)if(!a[c]["registered"]||e){this.setLiveViewsProgressBarDisplay(true);var b=a[c],d=b.binding;if(d){LiveViews.detachElvControlHandlers(d);d.dispose();b.binding=null}LiveViews.makeElvDivUnique(b,this.mb.mid());LiveViews.registerElv(LiveViews.createElvRequest(b),b)}};__p.setLiveViewsProgressBarDisplay=function MessagePartBody$setLiveViewsProgressBarDisplay(a){$setDisplay(this.mb.getPrefixedElt("elvProgress"),a)};__p.setLiveViewsInfoPaneDisplay=function MessagePartBody$setLiveViewsInfoPaneDisplay(a){this._setIndexElementDisplay("elvInfoPane",a)};__p.setLiveViewsAuthInfoPaneDisplay=function MessagePartBody$setLiveViewsAuthInfoPaneDisplay(a){this._setIndexElementDisplay("elvAuthInfoPane",a)};__p._setIndexElementDisplay=function MessagePartBody$_setIndexElementDisplay(b,c){var a=this.mb.getPrefixedElt(b);if(a)$setDisplay(a,c)};__p._onDetailsHover=function MessagePartBody$_onDetailsHover(){$css.add(this._detailsElt,"DetailToggleHover")};__p._onDetailsOut=function MessagePartBody$_onDetailsOut(){$css.remove(this._detailsElt,"DetailToggleHover")};MessagePartBody.createClass("MessagePartBody");SearchBox={};SearchBox._onSearch=function SearchBox$_onSearch(a){Control.invokeStatic("SearchBox","_search",{},a)};SearchBox._search=function SearchBox$_search(b){var a=b.trim();if(a!="")InboxPage.messageList.search(a)};SearchBox.setValue=function SearchBox$updateSearchValue(b){var a=$SB.sbs[$SB.first];if(b){a.setValue("",true);a.setValue(b)}else a.resetDefault()};SearchBox.resetValue=function SearchBox$resetValue(){SearchBox.setValue("")};Type.createStaticClass(SearchBox,"SearchBox");function Toolbar(b,a){Control.create(this,b);this._ignoreActions=[];this._handler=null;this._onIgnore=null;this.registerOnClickHandler(a)}Toolbar.standardIgnoreList=["Help","HelpFeedback","HelpGettingStarted","HelpSupport"];var __p=Toolbar.prototype;__p.dispose=function Toolbar$dispose(){this._ignoreActions=null;this._handler=null;this._onIgnore=null;Control.destroy(this)};__p.registerOnClickHandler=function Toolbar$registerOnClickHandler(a){this._handler=a};__p.registerOnIgnoreHandler=function Toolbar$registerOnIgnoreHandler(a){this._onIgnore=a};__p.setIgnoreActions=function Toolbar$setIgnoreActions(a){this._ignoreActions=a};__p.onclick=function Toolbar$onClick(a){if(!a||this._ignoreActions.exists(a)){if(this._onIgnore)this._onIgnore(a);return}return this._handler(a,event)};Toolbar.createClass("Toolbar");InboxToolbar={};InboxToolbar.initialize=function InboxToolbar$initialize(){InboxToolbar.initializeToolbar(InboxToolbar,"");if($("BottomToolbar")){InboxToolbar.bottomToolbar={};InboxToolbar.initializeToolbar(InboxToolbar.bottomToolbar,"bt_")}};InboxToolbar.initializeToolbar=function InboxToolbar$initializeToolbar(a,b){if(!InboxPage.isManagedUser)a.junk=$(b+"MarkAsJunk").parentNode;a.pipeAfterNew=$(b+"AfterNewPipe");a.reply=$(b+"Reply").parentNode;a.replyAll=$(b+"ReplyAll").parentNode;a.forward=$(b+"Forward").parentNode;a.pipeAfterForward=$(b+"AfterForwardPipe");a.notJunk=$(b+"MarkAsNotJunk").parentNode;a.phish=$(b+"MarkAsPhish").parentNode;a.compromised=$(b+"MarkAsCompromised").parentNode;a.read=$(b+"MarkAsRead").parentNode;a.unread=$(b+"MarkAsUnread").parentNode;a.newMsg=$(b+"NewMessage").parentNode;a.markAs=$(b+"MarkAs");a.markAsMenu=$tag(a.markAs,"UL")[0];a.markAsFlagged=$(b+"MarkAsFlagged").parentNode;a.markAsUnflagged=$(b+"MarkAsUnflagged").parentNode;if(InboxPage.Config.isBulkSelectEnabled){a.cleanUp=$(b+"CleanUp");a.cleanUpMenu=$tag(a.cleanUp,"UL")[0];a.markAllReadLink=$(b+"MarkAllRead");a.markAllRead=a.markAllReadLink.parentNode;a.deleteAllLink=$(b+"DeleteAll");a.deleteAll=a.deleteAllLink.parentNode;if(InboxPage.Config.isEnhancedRulesEnabled){a.moveAllFromSender=$(b+"MoveAllFromSender").parentNode;a.deleteAllFromSender=$(b+"DeleteAllFromSender").parentNode;a.blockAllFromSender=$(b+"BlockAllFromSender").parentNode}}a.moveTo=$(b+"MoveTo");a.moveToMenu=$tag(a.moveTo,"UL")[0];a.print=$(b+"PrintMessages").parentNode;a.refresh=$(b+"Refresh").parentNode;a.emptyFolder=$(b+"EmptyFolderButton").parentNode;a.pipeAfterMove=$(b+"AfterMoveToPipe")};InboxToolbar.onclick=function InboxToolbar$onclick(a){if(!a)return;return InboxToolbar.doAction(a)};InboxToolbar.doAction=function InboxToolbar$doAction(a){var c=InboxPage.readingPane;switch(a){case "rd_next":InboxActions.nextMsg();return;case "rd_prev":InboxActions.prevMsg();return;case "rd_full":c.openFullView();return;case "rd_close":InboxActions.closeFullViewMsg();return;case "expandAll":InboxActions.expandAll();return;case "collapseAll":InboxActions.collapseAll();return;case "showConversation":InboxPage.onSubmitUpsellConversationView(InboxPage.readingPane.getActionableMsgPart().msg.mid());return;case "bulkSelectAll":InboxActions.bulkSelectAll();return;case "clearSelection":InboxActions.clearSelection();return;case "createMoveRule":InboxActions.createMoveRule();return;case "dismissMessaging":InboxActions.dismissMessaging();return;case "CheckAll":InboxActions.select($("msgChkAll").checked);return;case "SortByDate":InboxPage.messageList.sort("Date");return;case "SortBySender":InboxPage.messageList.sort("Sender");return;case "SortBySubject":InboxPage.messageList.sort("Subject");return;case "SortBySize":InboxPage.messageList.sort("Size");return;case "SortByConversation":InboxPage.messageList.sort("Conversation");return;case "Flt_reset":FilterSelector.applyFilter(InboxPage.Config.filters.noneFltid);return;case "Flt_col":FilterSelector.toggleCollapse();return}if(a&&a.startsWith("Flt_")){var b=parseInt(a.substr(4));if(!isNaN(b)){FilterSelector.applyFilter(b);return}}};InboxToolbar.updateToolbarState=function InboxToolbar$updateToolbarState(){InboxToolbar.updateToolbar(InboxToolbar);if(InboxToolbar.bottomToolbar)InboxToolbar.updateToolbar(InboxToolbar.bottomToolbar);Resize._mainContentResize()};InboxToolbar.updateToolbar=function InboxToolbar$updateToolbar(a){var f=InboxPage.folderList.fid,e=InboxPage.Config.sysFldrs,n=f===e.sentFid,j=f===e.draftsFid,b=f===e.junkFid,l=f===e.trashFid,h=!n&&!j,g=n||j,d=b||l,i=InboxPage.readingPane.isFullView,o=InboxPage.readingPane.shouldShowCompromisedReporting(),m=InboxPage.readingPane.isShowingMessage()&&InboxPage.readingPane.isVoicemail();if(!InboxPage.isManagedUser)$setDisplay(a.junk,h&&!b);$setDisplay(a.notJunk,h&&b);$setDisplay(a.phish,h);$setDisplay(a.compromised,o);$setDisplay(a.read,!m);$setDisplay(a.unread,!m);$setDisplay(a.emptyFolder,d);$setDisplay(a.markAsFlagged,!d);$setDisplay(a.markAsUnflagged,!d);if(InboxPage.Config.isBulkSelectEnabled){var k=(!d||!l&&InboxPage.Config.enableSweepInJunk)&&(!i||InboxPage.Config.isEnhancedRulesEnabled&&!g);$setDisplay(a.cleanUp,k);if(k){$setDisplay(a.markAllRead,!i);$setDisplay(a.deleteAll,!i&&!b);a.markAllReadLink.innerHTML=Page.decode(InboxPage.isQuickViewFilterOrSearch()?InboxPage.Strings.markAllReadMenuView:InboxPage.Strings.markAllReadMenuFolder);a.deleteAllLink.innerHTML=Page.decode(InboxPage.isQuickViewFilterOrSearch()?InboxPage.Strings.deleteAllMenuView:InboxPage.Strings.deleteAllMenuFolder);if(InboxPage.Config.isEnhancedRulesEnabled){$setDisplay(a.moveAllFromSender,!g&&!b);$setDisplay(a.deleteAllFromSender,!g&&!b);$setDisplay(a.blockAllFromSender,b)}}InboxToolbar.invalidateMenuPosition(a.cleanUpMenu)}var c=!b&&!j&&(InboxPage.readingPane.isShowingMessage()||InboxPage.isReadingPaneOn);$setDisplay(a.reply,c);$setDisplay(a.replyAll,c);$setDisplay(a.forward,c);$setDisplay(a.pipeAfterNew,c);$setDisplay(a.pipeAfterForward,c);InboxToolbar.invalidateMenuPosition(a.markAsMenu);InboxToolbar.invalidateMenuPosition(a.moveToMenu);Resize.recalculatePrimaryToolbarWidths()};InboxToolbar.invalidateMenuPosition=function InboxToolbar$invalidateMenuPosition(b){var a=b.binding;if(a)a.invalidatePosition()};Type.createStaticClass(InboxToolbar,"InboxToolbar");InboxToolbar.initialize();FilterSelector={_allFilterContainerElemIds:InboxPage.Config.filters.allElemIds.split(" ")};FilterSelector.applyFilter=function FilterSelector$applyFilter(b){$BSI.reportEvent("Filter.Messaging.Mail",{FilterView:b});var a=InboxPage.createMessageListRenderingInfo(true);a.FilterId=b;InboxPage.messageList.setFirstOrLastPageParams(a,true);InboxPage.beginRefreshInbox(true,true,a,false,null,true)};FilterSelector.updateState=function FilterSelector$updateState(a){FilterSelector._updateSelectedState(a)};FilterSelector.toggleCollapse=function FilterSelector$toggleCollapse(){var a=$("filtersContainer");if(a){var b=$css.has(a,"Fs_iscol");if(b)$css.remove(a,"Fs_iscol");else $css.add(a,"Fs_iscol");if(OptionsWriter){var c=!b?"true":"false";OptionsWriter.fireOption(InboxPage.Config.filters.colUrl+c)}FilterSelector.applyFilter(InboxPage.Config.filters.noneFltid);InboxPage._onResize(null,false)}};FilterSelector._updateSelectedState=function FilterSelector$_updateSelectedState(a){if(!a)a=0;var e="fs_"+a;for(var c=FilterSelector._allFilterContainerElemIds.length-1;c>=0;--c){var d=FilterSelector._allFilterContainerElemIds[c],b=$(d);if(b)if(d==e)$css.add(b,"Selected");else $css.remove(b,"Selected")}};Type.createStaticClass(FilterSelector,"FilterSelector");__p=ReadingPane.prototype;__p._hasFocus=false;__p.initFocusHandling=function MessageList$initFocusHandling(){this._focusInDelegate=$CD(this,this._onFocusIn);this._focusOutDelegate=$CD(this,this._onFocusOut);this._splitPaneElt=$("readingPaneSplitPane");this._splitPaneElt.attachEvent("onfocusin",this._focusInDelegate);this._splitPaneElt.attachEvent("onfocusout",this._focusOutDelegate)};__p.disposeFocusHandling=function MessageList$disposeFocusHandling(){this._splitPaneElt.detachEvent("onfocusout",this._focusOutDelegate);this._splitPaneElt.detachEvent("onfocusin",this._focusInDelegate);this._focusOutDelegate=null;this._focusInDelegate=null};__p._innerSetConversation=__p.setConversation;__p.setConversation=function ReadingPane$setConversation$wrapper(a,c){var b=this._hasFocus;this._innerSetConversation(a,c);if(b)setTimeout($CD(this,this.focus),1)};__p._onFocusIn=function ReadingPane$_onFocusIn(){this._hasFocus=true};__p._onFocusOut=function ReadingPane$_onFocusOut(){if(!this._splitPaneElt.contains(event.toElement))this._hasFocus=false};__p.focus=function ReadingPane$focus(b){if(this.mode===ReadingPane.MESSAGE_MODE){var a=$("rpFocusElt");if(a)$callFocus(a)}else if(this.mode===ReadingPane.DELAY_LOADED_MODE||b)this._hasFocus=true};__p.hasFocus=function ReadingPane$hasFocus(){return this._hasFocus};__p=MessageList.prototype;__p._navEventTimer=null;__p._hasFocus=false;MessageList.KEYBOARD_DELAY_MILLISECONDS=200;__p.initFocusHandling=function MessageList$initFocusHandling(){this._focusInDelegate=$CD(this,this._onFocusIn);this._focusOutDelegate=$CD(this,this._onFocusOut);this.elt.attachEvent("onfocusin",this._focusInDelegate);this.elt.attachEvent("onfocusout",this._focusOutDelegate);var a=$("msgChkAll");if(a){a.attachEvent("onfocusin",this._focusInDelegate);a.attachEvent("onfocusout",this._focusOutDelegate)}};__p.disposeFocusHandling=function MessageList$disposeFocusHandling(){this.elt.detachEvent("onfocusout",this._focusOutDelegate);this.elt.detachEvent("onfocusin",this._focusInDelegate);this._focusOutDelegate=null;this._focusInDelegate=null};__p.keyDownHandler=function MessageList$keyDownHandler(){var a;if(!this.hasFocus()||!InboxPage.isReadingPaneOn)a=false;else{Control.onPreInvoke("MessageList","keyDownHandler");if(event.shiftKey||event.ctrlKey||event.altKey)a=false;var b;switch(event.keyCode){case 38:b="prevMsg";break;case 40:b="nextMsg"}if(b){Control.invokeStatic("InboxActions",b,event,{isKbd:true,senderData:null});a=true}else a=false;Control.onPostInvoke("MessageList","keyDownHandler")}return a};__p._startNavEventTimer=function MessageList$_startNavEventTimer(a){this._cancelNavEventTimer();this._navEventTimer=setTimeout(a,MessageList.KEYBOARD_DELAY_MILLISECONDS)};__p._cancelNavEventTimer=function MessageList$_cancelNavEventTimer(){if(null!=this._navEventTimer){clearTimeout(this._navEventTimer);delete this._navEventTimer;this._navEventTimer=null}};__p._innerOpenMessageByElt=__p._openMessageByElt;__p._openMessageByElt=function MessageList$_openMessageByElt$wrapper(d,b,a,c){if(a)this._startNavEventTimer($CD(this,function(){this._innerOpenMessageByElt(d,b,a,c)}));else this._innerOpenMessageByElt(d,b,a,c)};__p._innerOpenPageByElt=__p._openPageByElt;__p._openPageByElt=function MessageList$_openPageByElt$wrapper(b,a){this._cancelNavEventTimer();this._innerOpenPageByElt(b,a,true)};__p._innerSetMessageListPage=__p.setMessageListPage;__p.setMessageListPage=function MessageList$setMessageList$wrapper(c,b,a){var d=this._hasFocus;this._innerSetMessageListPage(c,b,a);if(d)this.focus()};__p._onFocusIn=function MessageList$_onFocusIn(){this._hasFocus=true};__p._onFocusOut=function MessageList$_onFocusOut(){if(!this.elt.contains(event.toElement))this._hasFocus=false};__p.focus=function MessageList$focus(){var a=$tag(this.elt,"input");if(a&&a.length>0){var b=this.getSelectionIndex();if(b<0||b>=a.length)b=0;$callFocus(a[b])}};__p.hasFocus=function MessageList$hasFocus(){return this._hasFocus};function ErrorDhtml(){this.Events={onclick:new $Event};this._onclickHandler=$CD(this,this._onClick)}__p=ErrorDhtml.prototype={ui:null,content:null};__p.dispose=function ErrorDhtml$dispose(){this.Events.onclick.dispose();this.ui=null;this.content=null};__p._onClick=function ErrorDhtml$_onClick(){this.Events.onclick.fire([this,{}])};__p.show=function ErrorDhtml$show(a){var c=['<div id="ErrDhtml" class="ErrDhtml">',this.content,"</div>"].join("");this.ui=new Alert(Alert.Importance.high,Page.decode(Res.strings.errDhtmlTitle),c,true,null);this.ui.addButton(Page.decode(Res.strings.errDhtmlBtn),1,true,false);this.ui.doNotDismissOnButtonClick();this.ui.setCallback(function(){ErrorDhtml.hide();if(a&&a.messageListRenderingInfo)Control.invokeStatic("InboxActions","_refreshAfterError",event,{mlri:a.messageListRenderingInfo})});gShowAlert(this.ui);var b=$("ErrDhtml");b.attachEvent("onclick",this._onclickHandler)};__p.hide=function ErrorDhtml$hide(){if(this.ui){var a=$("ErrDhtml");if(a)a.detachEvent("onclick",this._onclickHandler);this.ui.close()}ErrorDhtml.cleanup()};__p.setContent=function ErrorDhtml$setContent(a){this.content=a};ErrorDhtml._instance=null;ErrorDhtml.getInstance=function ErrorDhtml$getInstance(a){if(!ErrorDhtml._instance&&(a===undefined||a))ErrorDhtml.initialize();return ErrorDhtml._instance};ErrorDhtml.showHighPri=function ErrorDhtml$showHighPri(b,d,c){var a=ErrorDhtml.getInstance(true);a.setContent(b);a.show(c);return a};ErrorDhtml.hide=function ErrorDhtml$hide(){if(ErrorDhtml._instance)ErrorDhtml._instance.hide()};ErrorDhtml.showBlocking=function ErrorDhtml$showBlocking(b,a){ErrorDhtml.showHighPri(b,a)};ErrorDhtml.initialize=function ErrorDhtml$initialize(){ErrorDhtml._instance=new ErrorDhtml};ErrorDhtml.cleanup=function ErrorDhtml$cleanup(){if(ErrorDhtml._instance){ErrorDhtml._instance.dispose();ErrorDhtml._instance=null}};ErrorDhtml.createClass("ErrorDhtml");(function(){var b=window,f=b.jQuery,k=f(b),j=f(document.body),g=b.wLive;g.Hotmail=g.Hotmail||{};g.Hotmail.ActionQueueUiMgr=l;var d=InboxPage.Strings,c=b.ActionQueue,h=c.$,p=b.ActionQueueTypes.ActionType,n=b.Cache,e=c.Events,o=b.Page,i=f(document),a=".ActionQueueUiMgr",m="Close.Dialog.Hotmail";function l(){var g=this,b=null,f=true,q=false,l=false;function w(){l=true;b=new Alert(Alert.Importance.none,Page.decode(d.connectivityLossUiTitle),Page.decode(d.connectivityLossUiHtml),true,null);b.doNotAddCloseBox();b.doNotDismissOnButtonClick();AlertManager.getInstance().showAlert(b)}function r(){if(b){b.close();b=null}}function s(b,a){if(a&&a.item&&a.item.action)HM.LFPP=a.item.action}function u(){f=true}function p(a){if(a.type!="keydown"||a.which==13)f=!o.isSelfClick(a.srcElement);else f=true}function t(){if(f&&c.hasPending()){q=true;var a=event.returnValue=Page.decode(d.actionQueuePendingWarning);return a}f=true}function v(){var d=c.statistics(),a=d.lifetime,b=n.statistics(),e={wrnShwn:q,cnLsShwn:l,aAbndQLn:d.current.queueLength,aMxLn:a.maxLength,aTtl:a.totalItems,aTtlTm:a.totalTime,aMpty:a.percentEmpty,aMxWt:a.maxWait,aAvgWt:a.avgWait,aErr:a.errors,aAbnd:a.abandoned,cTtl:b.total,cMx:b.max,cNvld:b.numInvalidates,cPrn:b.numPrunes,cAdd:b.numAdds,cRd:b.numReads,cMss:b.numNotFounds};$BSI.reportEvent(m,e)}g.dispose=function y(){v();h.unbind(a);i.unbind(a);k.unbind(a);j.unbind(a);r();g=null};g.initialize=function x(){h.bind(e.onqueueconnectivityrecovered+a,r).bind(e.onqueueuseractivitywhileconnectivitylost+a,w).bind(e.onactionendexecution+a,s);i.bind("mousedown"+a,p).bind("keydown"+a,p);j.bind("mouseleave"+a,u);k.bind("beforeunload"+a,t)}}})();(function(){var a=window.jQuery,c=window.wLive;c.Hotmail=c.Hotmail||{};c.Hotmail.ComposeFrame=e;var b=Page.timeoutManager;function e(){var g=a(this),c=this,i,h,n,r,y,e,q=false,m=false,t=false,p=false,x=false,o=false,k=HM.MessageActionType.None,f,l,j,s="ComposeFrameDelay",w="ComposeFrameTimeout",C=1e4;c.$=g;c.dispose=function P(){g.unbind();if(h){if(e&&e.ComposePage)e.ComposePage.dontWarn=true;h.get(0).contentWindow.location.replace("about:blank")}c.load=c.setLoadedContent=c.clearLoadedContent=a.noop;g=c=i=h=n=r=y=e=l=_postLoadCallback=j=null};c.initialize=function N(){i=a("#IframeContentWrapper");h=a("#contentFrame");n=a("#contentRight");r=a("html");y=a(document);x=true;if(l){var b=l;l=null;b()}};c.show=function S(t,d,o,s,a){if(!a)a=c.getCsiPerfTrace();if(!c.isVisible())if(x){var e=-1;if(!s){var h=new PostProcData(true,true,false);h.reportCSIPerf=function(){};e=InboxPage.createDataEventHandlers(h,false,false,false,false,false,false,{src:g,type:"onshowcomplete"},false)}j=null;i.css("display","block");n.css("display","none");if(Page.getLayout()=="BottomUnmanaged")r.addClass("HybridUnmanaged");k=d?d:HM.MessageActionType.None;f=o;var b=$CC($CD(c,B),[k,t,e,a,!p]);if(p)b();else{j=b;if(!q||m)c.load()}}else l=$CC($CD(c,c.show),args)};c.hide=function Q(d){if(c.isVisible()){j=null;var b=-1;if(!d){var a=new PostProcData(false,true,false);a.uiUpdate=true;a.reportCSIPerf=function(){};b=InboxPage.createDataEventHandlers(a,false,false,false,false,false,false,{src:g,type:"onhidecomplete"},false)}k=HM.MessageActionType.None;f=null;if(e&&e.Page)e.Page.isPageVisible=false;i.css("display","none");n.css("display","block");if(Page.getLayout()=="BottomUnmanaged")r.removeClass("HybridUnmanaged");g.trigger("onhidecomplete",{ctx:{id:b}});c.load()}};c.updateState=function M(a){var b=c.isVisible();a.cv=b?"1":"0";if(b){if(f!=null){a.cmid=f.MessageId;a.csem=f.SenderEmail;a.cdid=k===HM.MessageActionType.ResumeDraft?f.MessageId:"";a.cfid=InboxPage.compressGuid(f.FolderId);a.cau=f.AllowUnsafeContent?"1":"0";a.cmad=f.AuxData.Value}a.cacc=k}};c.isVisible=function O(){return i&&i.css("display").toLowerCase()!="none"};c.isComposeView=function L(){return e&&e.ComposePage};c.load=function R(a){if(!t||m){function c(){b.setTimeout(w,A,C);m=false;t=true;q=false;p=false;o=false;e=null;h.attr("scrolling","no");h.get(0).contentWindow.location.replace("/mail/EditMessageLight.aspx?ecui=false&n="+Page.queryString.dynamicNonce())}b.clearTimeout(s);if(a)b.setTimeout(s,c,a);else c()}};c.completeMessage=function I(){g.trigger("oncompletemessage",u())};c.onBeforeUnloadCheck=function E(){var a=false;if(c.isVisible()&&e&&e.ComposePage){var b=e.ComposePage.GetOnBeforeUnloadWarning();if(b&&!window.confirm(b))a=true}return a};c.setPageComplete=function K(a){b.clearTimeout(s);b.clearTimeout(w);o=!!a;p=true;if(j){var c=j;j=null;c()}z()};c.setLoadedContent=function H(c,b){if(h){h.attr("scrolling","no");e=c;q=true;t=false;if(b){h.attr("scrolling","auto");if($B.Safari)e.document.body.style.overflow="auto";if($B.IE)e.document.body.scroll="auto"}var a=e.jQuery(e.document);a.bind("click.cf",v);a.bind("mousedown.cf",v)}};c.setContainerHeight=function G(a){if(Page.getLayout().indexOf("Unmanaged")>=0){i.height(a);g.trigger("onresize")}};c.setContainerMinHeight=function D(a){if(Page.getLayout().indexOf("Unmanaged")>=0){i.css("min-height",a);g.trigger("onresize")}};c.clearLoadedContent=function F(){if(e)e.jQuery(e.document).unbind(".cf");c.setContainerHeight("auto");c.setContainerMinHeight("auto");e=null;q=false};c.getCsiPerfTrace=function J(){return $CSIPerf.startTrace("ComposeTimeToFunc")};function B(b,h,k,f,i){m=false;if(c.isVisible()&&e&&e.Page&&e.ComposePage){d(null);e.Page.isPageVisible=true;e.ComposePage.initializeMessageView(b,h);var j=Page.getLayout().indexOf("Unmanaged")>=0?0:1,a=0;switch(b){case HM.MessageActionType.Reply:a=1;break;case HM.MessageActionType.ReplyAll:a=2;break;case HM.MessageActionType.Forward:a=3;break;case HM.MessageActionType.ResumeDraft:a=4;break;case HM.MessageActionType.None:a=5}$BSI.reportEvent("Compose.Messaging.Mail",{ComposeAction:a,IsManaged:j,DemandLoad:i?"1":"0",IsInline:1})}f.endTrace("TimeToFunc.Compose.Messaging.Mail");g.trigger("onshowcomplete",{ctx:{id:k}})}function A(){$BSI.reportEvent("Compose.Messaging.Mail.Error",{PageLoadTimeout:"1"});m=true}function v(){h.mousedown()}function z(){if(o)g.trigger("onmessagesent",u())}function u(){return {sent:o,ctx:{guid:f?f.MessageId:null,actionType:k}}}}function d(){$BSI.informPVHead();$BSI.informLoaded()}})();InboxActions={};InboxActions._promptUserToBulkDelete=function InboxActions$_promptUserToBulkDelete(){var b=InboxPage.isQuickViewFilterOrSearch(),a;if(InboxPage.folderList.fid==InboxPage.Config.sysFldrs.trashFid)a=b?InboxPage.Strings.permanentDeleteAllPromptView:InboxPage.Strings.permanentDeleteAllPromptFolder;else a=b?InboxPage.Strings.deleteAllPromptView:InboxPage.Strings.deleteAllPromptFolder;return confirm(Page.decode(a))};InboxActions.markAsNotJunk=function InboxActions$markAsNotJunk(b){var a=InboxActions._getMessageDataFromHoverOrSelection(b);if(a){Page.setPerformanceId("NJ");Safety.markAsNotJunk(a,InboxPage.folderList.fid,null,false)}};InboxActions.markAsPhish=function InboxActions$markAsPhish(){var a=InboxPage.verifyMinimumSelection();if(a)Safety.markAsPhish(a,InboxPage.folderList.fid)};InboxActions.markAsCompromised=function InboxActions$markAsCompromised(){var a=InboxPage.verifyMinimumSelection();if(a)Safety.markAs(a,HM.JmrType.Compromised,InboxPage.folderList.fid,HM.RemoveSenderFromListOption.None,false)};InboxActions.markAllRead=function InboxActions$markAllAsRead(){if(InboxPage.messageList.getItemCount()!=0){InboxServices.Events.sethiddenbulkselectallstate.fire([true]);Messages.markAsReadUnread(MessageList.createHiddenBulkSelectedMessageData(),true);return}};InboxActions.deleteAll=function InboxActions$deleteAll(){if(InboxPage.messageList.getItemCount()!=0&&confirm(Page.decode(InboxPage.isQuickViewFilterOrSearch()?InboxPage.Strings.deleteAllPromptView:InboxPage.Strings.deleteAllPromptFolder))){Page.setPerformanceId("DM");InboxServices.Events.sethiddenbulkselectallstate.fire([true]);Messages.remove(MessageList.createHiddenBulkSelectedMessageData());return}};InboxActions.emptyFolder=function InboxActions$emptyFolder(){if(confirm(Page.decode(InboxPage.Strings.permanentDeleteAllPromptFolder))){var b=InboxPage.messageList.getItemCount(),a=InboxPage.folderList.fid;if(InboxPage.Config.sysFldrs.trashFid==a&&InboxPage.areNoFiltersApplied()&&(b>InboxPage.Config.emptyDeleteThreshold||b==-1&&InboxPage.messageList.isMoreThanOnePage()))Messages.remove(MessageList.createSelectedMessageData(true,null,null));else{if(InboxPage.Config.sysFldrs.junkFid==a)Page.setPerformanceId("EJ");var c=InboxPage.createMessageListRenderingInfo(true),e=new PostProcData(true,false),d=InboxPage.createDataEventHandlers(e,true,true,true,false,false);InboxServices.beginClearFolder(a,c,d)}return}};InboxActions._markAsReadUnread=function InboxActions$_markAsReadUnread(f,h){var a=InboxActions._getMessageDataFromHoverOrSelection(h);if(a){if(f){var d=InboxPage.readingPane;if(d.isShowingMessage()){var b=a.duplicateMsgIds?a.duplicateMsgIds:a.mids;if(d.cv.secretCid()!=null)b=[d.cv.secretCid()];var g=b.length,e=InboxPage.messageList;for(var c=0;c<g;c++)if(e.ml.containsId(b[c]))if(e.isRead(b[c]))d.updateReadState(b[c],true)}if(!a.isBulk&&a.mids&&a.mids.length>0)InboxActions._reportBsiForMids(a.mids,"Mark.Messaging.Mail",InboxPage.BsiMessageDataType.MarkRead,function i(a){return !a.read()})}Messages.markAsReadUnread(a,f)}};InboxActions.markAsFlagged=function InboxActions$markAsFlagged(){InboxActions._markAsFlaggedUnflagged(true)};InboxActions.markAsUnflagged=function InboxActions$markAsUnflagged(){InboxActions._markAsFlaggedUnflagged(false)};InboxActions.markMessageAsFlaggedUnflagged=function InboxActions$markMessageAsFlaggedUnflagged(c,b,a){Messages.markAsFlaggedUnflagged(MessageList.createSelectedMessageData(false,[c],[b]),a)};InboxActions._markAsFlaggedUnflagged=function InboxActions$_markAsFlaggedUnflagged(b){var a=InboxPage.verifyMinimumSelection();if(a)Messages.markAsFlaggedUnflagged(a,b)};InboxActions.setFlagIcon=function InboxActions$setFlagIcon(g,h){var d=$getDescendantByAttr(g,"A","aId","tFg"),f=d.children[0],e=false,a,c,b;if(h){a="fg";c=InboxPage.Strings.flaggedAltText;b=InboxPage.Strings.flaggedMsgText}else{a="uf";c=InboxPage.Strings.unflaggedAltText;b=InboxPage.Strings.unflaggedMsgText}if(!$css.has(d,a)){d.className=a;f.alt=c;f.title=b;e=true}return e};InboxActions.moveTo=function InboxActions$moveTo(){var b=InboxPage.verifyMinimumSelection();if(b){var a=Control.getAncestorByAttr(event.srcElement,"aId"),c=a&&a.getAttribute?a.getAttribute("fid"):"";InboxActions._moveToFolder(b,c)}};InboxActions._moveToFolder=function InboxActions$_moveToFolder(a,b){Page.setPerformanceId("DM");if(b==InboxPage.Config.sysFldrs.trashFid)InboxActions._reportBsiForMids(a.mids,"DeleteRemove.Messaging.Mail",InboxPage.BsiMessageDataType.DeleteRemove);Messages.move(a,InboxPage.folderList.fid,b,null,null,null,null,true)};InboxActions.checkPop=function InboxActions$checkPop(){Page.submit("CheckPop")};InboxActions.viewSource=function InboxActions$viewSource(){var a=InboxPage.verifyMinimumSelection();if(a)if(!a.isBulk&&a.mids.length>0)Messages.viewSource(a)};InboxActions.viewAllFromSender=function InboxActions$viewAllFromSender(a){InboxActions._getSingleSenderAndPerformAction(a,function(a){InboxPage.messageList.searchAllFromSender(a)})};InboxActions.restoreHiddenTrash=function InboxActions$restoreHiddenTrash(){InboxPage.messageList.restoreHiddenTrash();InboxPage.doPostProc=false};InboxActions.sendEmailToSender=function InboxActions$sendEmailToSender(a){InboxActions._getSingleSenderAndPerformAction(a,function(a){Page.setPerformanceId("CON");if(InboxPage.composeFrame)InboxPage.composeFrame.show({To:a});else Page.postWithFolderQuickViewCache("NewMessage","/mail/EditMessageLight.aspx?n="+Page.queryString.newNonce+"&MailTo="+a.encodeUrl())})};InboxActions.showAdvancedSearch=function InboxActions$showAdvancedSearch(){InboxActions._advancedSearchHelper(function(){this.show().focus()})};InboxActions.hideAdvancedSearch=function InboxActions$hideAdvancedSearch(){InboxActions._advancedSearchHelper(function(){this.hideAndSetFocus()})};InboxActions.advancedSearch=function InboxActions$advancedSearch(){InboxActions._advancedSearchHelper(function(){this.search()})};InboxActions.tryAdvancedSearch=function InboxActions$tryAdvancedSearch(){InboxActions._advancedSearchHelper(function(){this.reset().show().focus()})};InboxActions._advancedSearchHelper=function InboxActions$_advancedSearchHelper(b){var a=InboxPage.advancedSearch;if(a)a.load(b)};InboxActions.refresh=function InboxActions$refresh(){if(typeof ManualRefresh!="undefined")return ManualRefresh.refreshInbox();return false};InboxActions.undoMoveSenderToBlockList=function InboxAction$undoMoveSenderToBlockList(a){var b=a[0],c=a[1];InboxServices.beginUndoSenderMoveToBlockList(b,c)};InboxActions._getSingleSenderAndPerformAction=function InboxActions$_getSingleSenderAndPerformAction(d,c){var b=InboxActions._getSenderEmailsFromHoverOrSelection(d,false),a=b[0];if(a){c(a);return}};InboxActions._getSenderEmailsFromHoverOrSelection=function InboxActions$_getSenderEmailsFromHoverOrSelection(b,d){if(b&&b.senderData){senderElt=b.senderData.senderElt;if(senderElt){var e=senderElt.getAttribute("email");return [e]}}else{var a=InboxPage.verifyMinimumSelection();if(a)if(!a.isBulk){var c=InboxPage.messageList.ml.getSenderEmailsFromMids(a.mids);if(c.length>0)return c;alert(String.format(Page.decode(InboxPage.Strings.noSendersSelected),Page.decode(InboxPage.Strings.unknownSender)))}else if(d)alert(Page.decode(InboxPage.Strings.sndrActionNoBulk))}return null};InboxActions._getMessageDataFromHoverOrSelection=function InboxActions$_getMessageDataFromHoverOrSelection(b){var a=null;if(b&&b.senderData){var c=b.senderData;a=MessageList.createSelectedMessageData(false,[c.msgElt.getAttribute("id")],[c.msgElt.getAttribute("mad")])}else a=InboxPage.verifyMinimumSelection();return a};InboxActions._prevNextHelper=function InboxActions$_prevNextHelper(a,c){if(a&&!InboxPage.isReadingPaneOn&&!InboxPage.readingPane.isFullView)return true;if(InboxPage.readingPane.isFullView&&-1==InboxPage.messageList.getSelectionIndex()){var b=new PostProcData(true,true,false);InboxPage.maybeUpdatePostProcDataForMessage(b,true,false);InboxPage.showFullReadingPane(false,false,b)}else if(c)InboxPage.messageList.previous(a);else InboxPage.messageList.next(a)};InboxActions._replyForwardImpl=function InboxActions$_replyForwardImpl(e,c){var f=c&&c.isKbd,a=InboxPage.folderList.fid,b=InboxPage.Config.sysFldrs;if(!f||a!=b.junkFid&&a!=b.draftsFid&&(InboxPage.readingPane.isShowingMessage()||InboxPage.isReadingPaneOn)){var d=InboxActions._loadSelectedMessageAndDoAction(e);if(!d.msgSelected){alert(Page.decode(InboxPage.Strings.selectOne));return false}return d.value}else return true};InboxActions._loadSelectedMessageAndDoAction=function InboxActions$_loadSelectedMessageAndDoAction(c){var b=false,d=true,a=InboxPage.messageList;if(InboxPage.readingPane.isShowingMessage()){b=true;d=InboxActions._doActionOnSelectedMessage(c)}else if(a.isOneItemSelected()){var g=a.getSelectedMessageData(),e=g.mids[0],f=$(e);if(f){if(InboxPage.allowAction(c,e))a._openMessageByElt(f,false,false,function(){InboxActions._doActionOnSelectedMessage(c,true)});b=true;d=false}}return {msgSelected:b,value:d}};InboxActions._doActionOnSelectedMessage=function ReadingPane$doActionOnSelectedMessage(b,a){if(InboxPage.readingPane.isShowingMessage()){var c=InboxPage.readingPane.getActionableMsgPartActions();return c[b](a)}return true};InboxActions._reportBsiForMids=function InboxActions$reportBsiForMids(i,k,j,g){var a=[],l=i.length,e=InboxPage.messageList.ml;for(var c=0;c<l;c++){var d=i[c];if(e.containsId(d)){var b=e.getById(d);if(g&&!g(b))continue;var h=null;if(InboxPage.Config.isPrefetchEnabled)h=InboxServices.getCachedConversation(d,b.conv(),e.viewId(),false,false)?0:b.score()>0?2:1;a.push(InboxPage.makeBsiMessageData(b,h,j))}}function f(){var b=Math.min(10,a.length);while(b-->0)$BSI.reportEvent(k,a.splice(0,1)[0]);if(a.length>0)window.setTimeout(f,500)}f()};InboxActions.select=function InboxActions$select(b,a){if(a&&InboxPage.readingPane.isFullView)return true;InboxPage.messageList.checkAll(b)};InboxActions.bulkSelectAll=function InboxActions$bulkSelectAll(){$BSI.reportEvent("bk.check",{bulkSelect:true});InboxPage.messageList.bulkSelectAll()};InboxActions.clearSelection=function InboxActions$clearSelection(){InboxPage.messageList.clearSelection();InboxPage.messageList.updateSelectedCount()};InboxActions.createMoveRule=function InboxActions$createMoveRule(){var a=Control.getAncestorByAttr(event.srcElement,"aId"),e=a.getAttribute("rn"),b=a.getAttribute("rm"),c=a.getAttribute("rfid"),d=InboxPage.createDataEventHandlers(new PostProcData(false,false,false),false,false,false,false,false,false,{src:InboxServices.Events,type:InboxServices.EventTypes.onproxycompleted});InboxServices.beginCreateMoveRule(e,b,c,$CD(this,InboxActions._endCreateMoveRule),d);InboxPage.selectionMsgPane.hide()};InboxActions._endCreateMoveRule=function InboxActions$_endCreateMoveRule(b,a){a.maintainCurrentSelection=false;jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.onproxycompleted,{ctx:a});InboxServices.Events.endupdateui.fire([b,false,a])};InboxActions.dismissMessaging=function InboxActions$dismissMessaging(){InboxPage.selectionMsgPane.hide()};InboxActions.expandAll=function InboxActions$expandAll(){InboxPage.readingPane.expandAll()};InboxActions.collapseAll=function InboxActions$collapseAll(){InboxPage.readingPane.collapseAll()};InboxActions.closeUpsell=function InboxActions$closeUpsell(){Infopane.forceHide();OptionsWriter.fireOption(String.format(InboxPage.upsellActionUrl,InboxPage.upsellDismissAction))};InboxActions.closeMessageSuperBar=function InboxActions$closeMessageSuperBar(a){if(a=="LiveViewAuth"||a=="PSAUpsell")$BSI.reportEvent("sb.close",{SuperBarType:a});var c=InboxPage.readingPane.cv,b=c.psaType();if(c.showsPsa()&&(b===Conversation.PsaTypes.Fre||b===Conversation.PsaTypes.Upsell))InboxServices.fixupCacheForPsaMessages(b);c.showsPsa(false)};InboxActions.closeMessageSuperBarAndWriteOption=function InboxActions$closeMessageSuperBarAndWriteOption(a){$Beacon.fire(a.url,$BSI.addLDToHash({}));InboxActions.closeMessageSuperBar(a.type)};InboxActions.navigateMessageSuperBar=function InboxActions$navigateMessageSuperBar(a){$BSI.reportEvent("sb.click",{SuperBarType:a.type});$BSI.navigateTo(a.url)};InboxActions.setReadingPane=function InboxActions$setReadingPane(a){if(a)InboxPage.onSubmitReadingPaneOptionClicked(a)};InboxActions.maybeShowJunkConfirmationDialog=function InboxActions$maybeShowJunkConfirmationDialog(b,c,d,a){if(b||c)DemandLoadHandler.demandLoadContent([HM.ContentId.JunkContactOrSafeSender],[function(){InboxActions._showJunkConfirmationDialog(b,c,d,a)}],function(){a()});else a()};InboxActions._showJunkConfirmationDialog=function InboxActions$_showJunkConfirmationDialog(d,e,c,g){var b=DemandLoadHandler.getContent(HM.ContentId.JunkContactOrSafeSender);if(d)where="C";else if(e)where="WL";var f=c?"CMPmsg":where+"msg",a=new Alert(Alert.Importance.none,b.title,b[f],true,null);a.addButton(b[where+"keep"],"keep",true,true);a.addButton(b[where+"remove"],"remove",false,false);if(c)a.addCheckbox(b["CMPcbx"],"CMPcbx",false);a.doNotAddCloseBox();a.setContext({where:where,callback:g});a.setCallback(this._junkConfirmationDialogCallback);$BSI.reportEvent("ReadView.Messaging.Mail.JunkPrompt",{PromptType:"KnownSender"});gShowAlert(a)};InboxActions._junkConfirmationDialogCallback=function InboxActions$_junkConfirmationDialogCallback(e,d,c){var a=HM.RemoveSenderFromListOption,b=a.None,f=e.where,g=c&&c.length>0&&c[0]==="CMPcbx";if(d==="remove"){b=f==="C"?a.RemoveContact:a.RemoveSafeSender;$BSI.reportEvent("SelectClick.Messaging.Mail.JunkPrompt",{PromptType:"Block"})}else if(d==="keep")b=f==="C"?a.KeepContact:a.KeepSafeSender;if(b!==a.None)e.callback(b,g)};InboxActions._checkMessagesFromSelf=function InboxActions$_checkMessagesFromSelf(c){if(!c.mids)return false;var b=false,e=c.mids;for(var a=e.length-1;a>=0;a--){var d=$(e[a]);if(d&&d.getAttribute("self")){b=true;break}}return b};Type.createStaticClass(InboxActions,"InboxActions");InboxActions.newMsg=function InboxActions$newMsg(){Page.setPerformanceId("CON");if(InboxPage.composeFrame)InboxPage.composeFrame.show();else Page.postWithFolderQuickViewCache("NewMessage","/mail/EditMessageLight.aspx?n="+Page.queryString.newNonce)};InboxActions.deleteMsg=function InboxActions$deleteMsg(b){var a=InboxActions._getMessageDataFromHoverOrSelection(b);if(a&&!a.isBulk&&!InboxPage.messageList.ml.containsAnyId(a.mids))return;if(a&&(!a.isBulk||InboxActions._promptUserToBulkDelete())){Page.setPerformanceId("DM");if(!a.isBulk)InboxActions._reportBsiForMids(a.mids,"DeleteRemove.Messaging.Mail",InboxPage.BsiMessageDataType.DeleteRemove);Messages.remove(a,null,null,null,null,a.duplicateMsgIds==undefined||a.duplicateMsgIds.length==0,false);InboxPage._scrollToTop();InboxPage.messageList.focus()}};InboxActions.markAsJunk=function InboxActions$markAsJunk(h){var p=h&&h.isKbd,c=InboxPage.folderList.fid,m=InboxPage.Config.sysFldrs,g=HM.JmrType;if(p&&(c==m.junkFid||c==m.trashFid||InboxPage.isManagedUser))return true;var a=InboxActions._getMessageDataFromHoverOrSelection(h);if(!a||!a.isBulk&&a.mids&&a.mids.length>0&&!InboxPage.messageList.ml.containsId(a.mids[0]))return;if(InboxPage.allowAction("markAsJunk",!a.isBulk&&a.mids&&a.mids.length>0?a.mids[0]:null)){Page.setPerformanceId("J");var b=InboxActions._checkMessagesFromSelf(a),k=!a.isBulk&&a.mids.length==1&&(a.duplicateMsgIds==undefined||a.duplicateMsgIds.length==0),i=InboxPage.readingPane,n=InboxPage.messageList.ml.conv(),o=n!=null&&n!="",j=b||o&&(k&&i.isShowingMessage()&&i.numMessageParts()>1);if(InboxPage.Config.junkSenderEnabled&&k&&!InboxPage.messageList.isConversation(a.mids[0])){var e,f,d;if(i.isShowingMessage()){var l=InboxPage.readingPane.getMessagePart(a.mids[0]);e=!b&&l.msg.isSenderInContactList();f=!b&&l.msg.isSenderInWhiteList();d=!b&&InboxPage.readingPane.shouldShowCompromisedReporting()}else{e=!b&&InboxPage.messageList.isSenderInContactList(a.mids[0]);f=false;d=false}InboxActions.maybeShowJunkConfirmationDialog(e,f,d,function(b,e){var d=HM.RemoveSenderFromListOption.None;if(b)d=b;Safety.markAs(a,e?g.Compromised:g.Junk,c,d,j)})}else Safety.markAs(a,g.Junk,c,HM.RemoveSenderFromListOption.None,j)}};InboxActions.markAsRead=function InboxActions$markAsRead(a){InboxActions._markAsReadUnread(true,a)};InboxActions.markAsUnread=function InboxActions$markAsUnread(a){InboxActions._markAsReadUnread(false,a)};InboxActions.toggleFlag=function InboxActions$toggleFlag(){if(FolderQuickViewListHelper.isJunkOrDeletedFolder(InboxPage.folderList.fid))return true;var a=InboxPage.verifyMinimumSelection();if(a){var c=false,d=a.isBulk?InboxPage.messageList.ml.getIdListNormal():a.mids;for(var b=0;b<d.length;b++)if(!InboxPage.messageList.isFlagged(d[b])){c=true;break}Messages.markAsFlaggedUnflagged(a,c)}};InboxActions.moveToFolder=function InboxActions$moveToFolder(){var b=$("MoveTo");if(b){var a=b.children[0];if(a){a.focus();if(typeof a.menu==="undefined")try{$menu.bind(event,0,0,1,0,0,0,0,0,0,0,0,"click",a);InboxPage.makeMenuScroll("MoveTo",0)}catch(c){}else if(typeof a.menu.toggleState==="function")a.menu.toggleState();InboxPage.doNotCloseMenu=true}}};InboxActions.printMsg=function InboxActions$printMsg(){var a=InboxPage.verifyMinimumSelection();if(a)if(a.isBulk)alert(Page.decode(InboxPage.Strings.cannotBulkPrint));else{var c=false;if(InboxPage.readingPane.isShowingMessage()){var b=InboxPage.readingPane.getActionableMsgPart().getBody();if(b&&(b.mb.isSafe()||b.mb.showUnsafe()))c=true}Messages.print(a.mids,a.mads,c)}};InboxActions.reply=function InboxActions$reply(a){return InboxActions._replyForwardImpl("reply",a)};InboxActions.replyAll=function InboxActions$replyAll(a){return InboxActions._replyForwardImpl("replyAll",a)};InboxActions.forward=function InboxActions$forward(a){return InboxActions._replyForwardImpl("forward",a)};InboxActions.prevMsg=function InboxActions$prevMsg(a){var b=a&&a.isKbd;return InboxActions._prevNextHelper(b,true)};InboxActions.nextMsg=function InboxActions$nextMsg(a){var b=a&&a.isKbd;return InboxActions._prevNextHelper(b,false)};InboxActions.selectAll=function InboxActions$selectAll(){if(InboxPage.messageList.isBulkSelectAllState())return true;return InboxActions.select(true,true)};InboxActions.selectNone=function InboxActions$selectNone(){return InboxActions.select(false,true)};InboxActions.searchMail=function InboxActions$searchMail(){if(InboxPage.readingPane.isFullView)return true;var a=$("c_search_psb_box");if(a)try{a.focus();a.blur();a.focus()}catch(b){}};InboxActions.closeFullViewMsg=function InboxActions$closeFullViewMsg(b){var c=b&&b.isKbd,a=InboxPage.readingPane;if(c&&!a.isFullView)return true;Page.setPerformanceId("BackMsg");a.closeMessage()};InboxActions.openMsg=function InboxActions$openMsg(){if(!InboxPage.isReadingPaneOn&&!InboxPage.readingPane.isFullView){var a=InboxPage.messageList;if(a.isOneItemSelected()){var d=a.getSelectedMessageData(),b=d.mids[0],c=$(b);if(c&&InboxPage.allowAction("openMsg",b))a._openMessageByElt(c);return false}}return true};InboxActions.goToInbox=function InboxActions$goToInbox(){InboxPage.folderList.goToFldr(InboxPage.Config.sysFldrs.inboxFid,false)};InboxActions.goToSent=function InboxActions$goToSent(){InboxPage.folderList.goToFldr(InboxPage.Config.sysFldrs.sentFid,false)};InboxActions.goToDrafts=function InboxActions$goToDrafts(){InboxPage.folderList.goToFldr(InboxPage.Config.sysFldrs.draftsFid,false)};InboxActions.blockAllFromSender=function InboxActions$blockAllFromSender(a){InboxActions._deleteOrMoveAllFromSender(a,InboxActions.showBlockAllFromSenderUi,[HM.ContentId.CommonDeleteAndBlockAllFromSender,HM.ContentId.BlockAllFromSender])};InboxActions.showBlockAllFromSenderUi=function InboxActions$showBlockAllFromSenderUi(b,a){a.alwaysBlockAll=true;a.fromJunk=true;a.biciEventName="SelectClick.Messaging.Mail.JunkPrompt";a.biciEventArgs={PromptType:"Block"};InboxActions._showDeleteOrBlockAllFromSenderUi(b,a,HM.ContentId.BlockAllFromSender)};InboxActions.deleteAllFromSender=function InboxActions$deleteAllFromSender(a){InboxActions._deleteOrMoveAllFromSender(a,InboxActions.showDeleteAllFromSenderUi,[HM.ContentId.CommonDeleteAndBlockAllFromSender,HM.ContentId.DeleteAllFromSender])};InboxActions.showDeleteAllFromSenderUi=function InboxActions$showDeleteAllFromSenderUi(a,b){InboxActions._showDeleteOrBlockAllFromSenderUi(a,b,HM.ContentId.DeleteAllFromSender)};InboxActions._showDeleteOrBlockAllFromSenderUi=function InboxActions$_showDeleteOrBlockAllFromSenderUi(c,d,b){var a=DemandLoadHandler.getContent(b),e=[a.optionsMsg,c,InboxPage.isQuickViewFilterOrSearch()?a.optionsScopeView:a.optionsScopeFldr].join("");InboxActions._showActionConfirmationAlert(a.optionsTitle,e,a.optionsOkBtn,a.optionsCancelBtn,a.optionsBlkSndrs?a.optionsBlkSndrs:null,false,d,null,"_deleteAllFromSenderImpl",null)};InboxActions._deleteAllFromSenderImpl=function InboxActions$_deleteAllFromSenderImpl(a){Page.setPerformanceId("DM");if(a.biciEventName)$BSI.reportEvent(a.biciEventName,a.biciEventArgs);var d=a.secondaryAction||a.alwaysBlockAll,c,b,e;e=function(){Messages.remove(MessageList.createHiddenBulkSelectedMessageData(),InboxActions._createSenderSearchQuery(a.senderEmails),true,InboxPage.createPostActionInfo(b,InboxServices.Events.enddeleteallfromsender,{senders:a.senderEmails}),InboxPage.createBulkMoveDataPoints("sender",a.entryPoint,d?"block":null),null,c)};if(!InboxPage.Config.useUpdatePicwDataWhenSweepBlocking){c=false;b=d?InboxServices.beginBlockSenders:null}else{c=d;b=null;if(a["fromJunk"])e=function(){Messages.remove(InboxPage.verifyMinimumSelection(),null,true,InboxPage.createPostActionInfo(b,InboxServices.Events.enddeleteallfromsender,{senders:a.senderEmails}),InboxPage.createBulkMoveDataPoints("sender",a.entryPoint,d?"block":null),null,c)}}e()};InboxActions.moveAllFromSender=function InboxActions$moveAllFromSender(a){InboxActions._deleteOrMoveAllFromSender(a,InboxActions.showMoveAllFromSenderUi,[HM.ContentId.MoveAllFromSender,HM.ContentId.MoveToFolderListSelect])};InboxActions.showMoveAllFromSenderUi=function InboxActions$showMoveAllFromSenderUi(b,c){var a=DemandLoadHandler.getContent(HM.ContentId.MoveAllFromSender),d=[InboxPage.isQuickViewFilterOrSearch()?a.optionsPromptScopeView:a.optionsPromptScopeFldr,b,a.optionsSelFldr,DemandLoadHandler.getContent(HM.ContentId.MoveToFolderListSelect)].join("");InboxActions._showActionConfirmationAlert(a.optionsTitle,d,a.optionsOkBtn,a.optionsCancelBtn,a.optionsCreateRule?a.optionsCreateRule:null,true,c,InboxActions._handleFolderListOkBtn,"_moveAllFromSenderImpl",InboxActions._addToFldrToCtx)};InboxActions._moveAllFromSenderImpl=function InboxActions$_moveAllFromSenderImpl(a){Page.setPerformanceId("DM");Messages.move(MessageList.createHiddenBulkSelectedMessageData(),InboxPage.folderList.fid,a.toFldr,InboxActions._createSenderSearchQuery(a.senderEmails),true,InboxPage.createPostActionInfo(a.secondaryAction?InboxServices.beginCreateSendersMoveRules:null,InboxServices.Events.endmoveallfromsender,{senders:a.senderEmails,toFldr:a.toFldr}),InboxPage.createBulkMoveDataPoints("sender",a.entryPoint,a.secondaryAction?"rule":null),false)};InboxActions._deleteOrMoveAllFromSender=function InboxActions$_deleteOrMoveAllFromSender(a,d,c){var b=a&&a.senderEmails?a.senderEmails:InboxActions._getSendersForDelOrMoveAction(a);if(b&&b.length>0){InboxServices.Events.sethiddenbulkselectallstate.fire([true]);var e=a&&a.entryPoint?a.entryPoint:"ToolBar",f=function(){var a=InboxActions._getSndrHtml(b,DemandLoadHandler.getContent(HM.ContentId.CommonSenderAction).sndrListHtml);d(a,{senderEmails:b,entryPoint:e})};c.push(HM.ContentId.CommonSenderAction);DemandLoadHandler.demandLoadContent(c,[f],InboxActions._errDemandLoadSenderContent)}};InboxActions.moveToPopup=function InboxActions$moveToPopup(){var a=InboxPage.verifyMinimumSelection();if(a){var b=function(){var b=DemandLoadHandler.getContent(HM.ContentId.MoveMessage),c=a.isBulk||a.mids.length>1||$(a.mids[0]).getAttribute("conv"),d=(c?b.promptPlural:b.promptSingular)+DemandLoadHandler.getContent(HM.ContentId.MoveToFolderListSelect);InboxActions._showActionConfirmationAlert(c?b.titlePlural:b.titleSingular,d,b.okBtn,b.cancelBtn,null,true,{messageData:a},InboxActions._handleFolderListOkBtn,"_moveToPopupImpl",InboxActions._addToFldrToCtx)};DemandLoadHandler.demandLoadContent([HM.ContentId.MoveMessage,HM.ContentId.MoveToFolderListSelect],[b],InboxActions._errDemandLoadSenderContent)}};InboxActions._moveToPopupImpl=function InboxActions$_moveToPopupImpl(a){InboxActions._moveToFolder(a.messageData,a.toFldr)};InboxActions._errDemandLoadSenderContent=function InboxActions$_errDemandLoadSenderContent(){InboxServices.Events.sethiddenbulkselectallstate.fire([false])};InboxActions._showActionConfirmationAlert=function InboxActions$_showActionConfirmationAlert(k,h,j,g,e,c,m,f,l,d){var a=new Alert(Alert.Importance.none,k,h,true,null),b=1,i=2;if(e)a.addCheckbox(e,i,false);a.addButton(j,b,true,false);a.addButton(g,0,false,true);if(c)a.doNotDismissOnButtonClick();a.setContext(m);var n=function(f,g,i,h){var e=g==b;if(e){f["secondaryAction"]=h.length==1;if(d)e=d(f)}if(c)a.close();if(e)Control.invokeStatic("InboxActions",l,event,f);else InboxServices.Events.sethiddenbulkselectallstate.fire([false])};a.setCallback(n);gShowAlert(a);if(f)f(a,b)};InboxActions._handleFolderListOkBtn=function InboxActions$_handleFolderListOkBtn(c,b){c.disableButton(b);var a=$("moveFldrList");a.attachEvent("onchange",function(){"0"!=a.options[a.selectedIndex].value?c.enableButton(b):c.disableButton(b)})};InboxActions._addToFldrToCtx=function InboxActions$_addToFldrToCtx(c){var b=$("moveFldrList"),a=b.options[b.selectedIndex].value;if(a&&a!="0"){c["toFldr"]=a;return true}return false};InboxActions._getSendersForDelOrMoveAction=function InboxActions$_getSendersForDelOrMoveAction(a){if(FolderQuickViewListHelper.isDeletedFolder(InboxPage.folderList.fid))return null;return InboxActions._getSenderEmailsFromHoverOrSelection(a,true)};InboxActions._createSenderSearchQuery=function InboxActions$_createSenderSearchQuery(a){return "from:"+a.join(" OR from:")};InboxActions._getSndrHtml=function InboxActions$_getSndrHtml(a,b){var d=a.length>6?" BorderBox SndrScrollList":"",c=InboxPage.getEncodedEmails(a),e=["<li>",c.join("</li><li>"),"</li>"].join("");return String.format(b,d,e)};InboxActions._refreshAfterError=function InboxActions$_refreshAfterError(a){InboxPage.beginRefreshInbox(true,true,a.mlri,false,null,true,false,null,null,false,true,new PostProcData(false,false))};function MessagePartActions(a){this.mp=a}__p=MessagePartActions.prototype={};__p.dispose=function MessagePartActions$dispose(){this.mp=null};__p.getToolbarCallback=function MessagePartActions$getToolbarCallback(){return $CD(this,this._toolbarCallback)};__p._toolbarCallback=function MessagePartAction$_toolbarCallback(a,b){if(b&&b.srcElement){var d=jQuery(b.srcElement).closest(".c_ic_menu");if(d.length>0)return}if(a=="tFg")a="toggleFlag";var c=["reply","replyAll","forward"];if(c.exists(a))$BSI.reportEvent(String.format("mp.{0}",a),this.mp.getBsiData());return this[a]()};__p.toggleFlag=function MessagePartActions$toggleFlag(){Messages.markAsFlaggedUnflagged(this.mp.getSelectedMessageData(),!this.mp.msg.isFlagged())};__p.toggleHeader=function MessagePartActions$toggleHeader(){if(!$getTextSelection(this.mp.elt))if(this.mp.toggleHeader())this._markReadUnread(true)};__p.showHistory=function MessagePartActions$showHistory(){this.mp.showHistory()};__p.hideHistory=function MessagePartActions$hideHistory(){this.mp.hideHistory()};__p.reply=function MessagePartActions$reply(a){if(a||InboxPage.allowAction("reply",this.mp.msg.mid()))return this.mp.loadBody($CD(this,this._replyImpl))};__p.replyAll=function MessagePartActions$replyAll(a){if(a||InboxPage.allowAction("replyAll",this.mp.msg.mid()))return this.mp.loadBody($CD(this,this._replyAllImpl))};__p.forward=function MessagePartActions$forward(a){if(a||InboxPage.allowAction("forward",this.mp.msg.mid()))return this.mp.loadBody($CD(this,this._forwardImpl))};__p._replyImpl=function MessagePartActions$replyImpl(){return this._replyForwardImpl(this.mp.getBody(),"replyAction","COR","CanNotReplyAddress",InboxPage.Strings.cannotReplyAddr)};__p._replyAllImpl=function MessagePartActions$replyAllImpl(){return this._replyForwardImpl(this.mp.getBody(),"replyAllAction","CORA","CanNotReplyAddress",InboxPage.Strings.cannotReplyAddr)};__p._forwardImpl=function MessagePartActions$forwardImpl(){return this._replyForwardImpl(this.mp.getBody(),"forwardAction","COF","CanNotForwardAddress",InboxPage.Strings.cannotFwdAddr)};__p._replyForwardImpl=function MessagePartActions$_replyForwardImpl(a,d,e,b,c){if(null!=a){Page.setPerformanceId(e);return Messages.replyForward(a,d,b,c)}return true};__p.deleteMessage=function MessagePartAction$deleteMessage(){Page.setPerformanceId("DM");$BSI.reportEvent("mp.delete",this.mp.getBsiData());var a=this.mp.msg.mid(),b=InboxPage.messageList.ml.getById(a);if(b)$BSI.reportEvent("DeleteRemove.Messaging.Mail",InboxPage.makeBsiMessageData(b,InboxPage.Config.isPrefetchEnabled?0:null,InboxPage.BsiMessageDataType.DeleteRemove));InboxPage.readingPane.deleteMessagePart(a)};__p.draftMessage=function MessagePartAction$draftMessage(){var a=this.mp.getBody();if(InboxPage.composeFrame){var b=a.createMessageRenderingInfo();b.AllowUnsafeContent=true;var c=new PostProcData(true,false);c.skipCsi=true;var d=InboxPage.createDataEventHandlers(c,false,false,false,false,false,false,null,true);InboxServices.beginGetComposeData(b,HM.MessageActionType.ResumeDraft,d)}else $BSI.navigateTo(a.mb.cdu())};__p.markAsRead=function MessagePartActions$markAsRead(){this._markReadUnread(true)};__p.markAsUnread=function MessagePartActions$markAsUnread(){this._markReadUnread(false)};__p._markReadUnread=function MessagePartActions$_markReadUnread(b){var a=this.mp;if(a.msg.isMixedReadState()&&a.msg.isRead()&&b)InboxPage.readingPane.updateReadState(a.msg.mid(),true);else if(a.msg.isRead()!=b)Messages.markAsReadUnread(a.getSelectedMessageData(),b)};__p.markAsJunk=function MessagePartActions$markAsJunk(){if(InboxPage.allowAction("markAsJunk",this.mp.msg.mid()))if(InboxPage.Config.junkSenderEnabled)InboxActions.maybeShowJunkConfirmationDialog(this.mp.msg.isSenderInContactList(),this.mp.msg.isSenderInWhiteList(),InboxPage.readingPane.shouldShowCompromisedReporting(),$CD(this,this._markAsJunkImpl));else this._markAsJunkImpl()};__p._markAsJunkImpl=function MessagePartActions$_markAsJunkImpl(a,d){var b=HM.RemoveSenderFromListOption.None,c=HM.JmrType;if(typeof a!="undefined")b=a;Page.setPerformanceId("J");$BSI.reportEvent("mp.junk",this.mp.getBsiData({IsJunk:"1"}));InboxPage.readingPane.markMessagePartAsJunk(this.mp.msg.mid(),d?c.Compromised:c.Junk,b)};__p.markAsNotJunk=function MessagePartActions$markAsNotJunk(a){if(typeof a=="undefined")a=false;Page.setPerformanceId("NJ");$BSI.reportEvent("mp.junk",this.mp.getBsiData({IsJunk:"0"}));InboxPage.readingPane.markMessagePartAsNotJunk(this.mp.msg.mid(),a)};__p.deleteAllFromSender=function MessagePartActions$deleteAllFromSender(){InboxActions.deleteAllFromSender({senderEmails:[this.mp.msg.contactEmail()],entryPoint:"MPToolBar"})};__p.addContact=function MessagePartActions$addContact(){$BSI.reportEvent("mp.addContact",{AddContactLocation:"ReadMessageLink"});InboxPage.readingPane.addContactFromMessagePart(this.mp.msg.mid())};__p.printMessage=function MessagePartActions$printMessage(){var a=this.mp.getBody();if(null!=a)Messages.print([a.mb.mid()],[true],a.mb.isSafe()||a.mb.showUnsafe())};__p.viewSource=function MessagePartActions$viewSource(){Messages.viewSource(this.mp.getSelectedMessageData())};__p.toggleDetails=function MessagePartActions$toggleDetails(){if(this.mp.toggleDetails())$BSI.reportEvent("mp.showDetails",this.mp.getBsiData())};__p.showDetails=function MessagePartActions$showDetails(){$BSI.reportEvent("mp.showDetails",this.mp.getBsiData());this.mp.setDetailsDisplay(true)};__p.hideDetails=function MessagePartActions$hideDetails(){this.mp.setDetailsDisplay(false)};MessagePartActions.createClass("MessagePartActions");var BulkActionsProgressUi={};BulkActionsProgressUi.initialize=function BulkActionsProgressUi$initialize(){BulkActionsProgressUi._resetStateVariables();InboxServices.Events.showbulkactionprogressui.attach($CD(this,BulkActionsProgressUi._showBulkActionProgressUi));InboxServices.Events.updatebulkactionprogressui.attach($CD(this,BulkActionsProgressUi._updateBulkActionProgressUi));InboxServices.Events.closebulkactionprogressui.attach($CD(this,BulkActionsProgressUi._closeBulkActionProgressUi))};BulkActionsProgressUi.dispose=function BulkActionsProgressUi$dispose(){BulkActionsProgressUi._resetStateVariables()};BulkActionsProgressUi._resetStateVariables=function BulkActionsProgressUi$_resetStateVariables(){InboxServices.stopAction=false;BulkActionsProgressUi.ui=null;BulkActionsProgressUi.fullMsgTmpl=null;BulkActionsProgressUi.actionMsgTmpl=null;BulkActionsProgressUi.actionOrFldrEncoded=null;BulkActionsProgressUi.permanentDeleteMsgTmpl=null;BulkActionsProgressUi.isPermanentDelete=false};BulkActionsProgressUi._showBulkActionProgressUi=function BulkActionsProgressUi$_showBulkActionProgressUi(b){var d=b.isMark,g=b.actionOrFldr,e=b.isPermanentDelete,a=b.customUi;BulkActionsProgressUi.fullMsgTmpl=a?a.body:Page.decode(InboxPage.Strings.bulkProgressUiHtml);var c;if(e){BulkActionsProgressUi.isPermanentDelete=true;BulkActionsProgressUi.permanentDeleteMsgTmpl=Page.decode(InboxPage.Strings.bulkProgressUiPermanentDelMsg);c=Page.decode(InboxPage.Strings.bulkProgressUiPermanentDelMsgNoCount)}else{BulkActionsProgressUi.actionMsgTmpl=Page.decode(d?InboxPage.Strings.bulkProgressUiMarkAsMsg:InboxPage.Strings.bulkProgressUiMoveToMsg);BulkActionsProgressUi.actionOrFldrEncoded=g.encodeHtml();var f=Page.decode(d?InboxPage.Strings.bulkProgressUiMarkAsMsgNoCount:InboxPage.Strings.bulkProgressUiMoveToMsgNoCount);c=String.format(f,BulkActionsProgressUi.actionOrFldrEncoded)}var h=String.format(BulkActionsProgressUi.fullMsgTmpl,c);BulkActionsProgressUi.ui=new Alert(Alert.Importance.med,Page.decode(InboxPage.Strings.bulkProgressUiTitle),h,true,null);BulkActionsProgressUi.ui.addButton(Page.decode(InboxPage.Strings.bulkProgressUiStop),0,true,true);BulkActionsProgressUi.ui.setCallback(BulkActionsProgressUi._stopBulkActionProgressUi);BulkActionsProgressUi.ui.doNotAddCloseBox();BulkActionsProgressUi.ui.doNotDismissOnButtonClick();if(a&&a.position)BulkActionsProgressUi.ui.setPosition(a.position);gShowAlert(BulkActionsProgressUi.ui)};BulkActionsProgressUi._updateBulkActionProgressUi=function BulkActionsProgressUi$_updateBulkActionProgressUi(c){var a=c.count;if(a>0){var b=BulkActionsProgressUi.isPermanentDelete?BulkActionsProgressUi._getBulkActionPermanentDeleteProgressUiMsg(a):BulkActionsProgressUi._getBulkActionMarkOrMoveProgressUiMsg(a);BulkActionsProgressUi.ui.updateContents(b)}};BulkActionsProgressUi._getBulkActionPermanentDeleteProgressUiMsg=function BulkActionsProgressUi$_getBulkActionPermanentDeleteProgressUiMsg(a){return String.format(BulkActionsProgressUi.fullMsgTmpl,String.format(BulkActionsProgressUi.permanentDeleteMsgTmpl,a))};BulkActionsProgressUi._getBulkActionMarkOrMoveProgressUiMsg=function BulkActionsProgressUi$_getBulkActionMarkOrMoveProgressUiMsg(a){return String.format(BulkActionsProgressUi.fullMsgTmpl,String.format(BulkActionsProgressUi.actionMsgTmpl,a,BulkActionsProgressUi.actionOrFldrEncoded))};BulkActionsProgressUi._closeBulkActionProgressUi=function BulkActionsProgressUi$_closeBulkActionProgressUi(){if(BulkActionsProgressUi.ui)BulkActionsProgressUi.ui.close();BulkActionsProgressUi._resetStateVariables()};BulkActionsProgressUi._stopBulkActionProgressUi=function BulkActionsProgressUi$_stopBulkActionProgressUi(){InboxServices.stopAction=true;BulkActionsProgressUi.ui.disableButton(0);BulkActionsProgressUi.ui.updateContents(String.format(BulkActionsProgressUi.fullMsgTmpl,Page.decode(InboxPage.Strings.bulkProgressUiStoppingMsg)))};BulkActionsProgressUi._errorBulkActionProgressUi=function BulkActionsProgressUi$_errorBulkActionProgressUi(){BulkActionsProgressUi._closeBulkActionProgressUi()};BulkActionsProgressUi.isVisible=function BulkActionsProgressUi$isVisible(){return BulkActionsProgressUi.ui&&BulkActionsProgressUi.ui.isShown()};var DemandLoadHandler={};DemandLoadHandler.initialize=function DemandLoadHandler$initialize(a){DemandLoadHandler._contentObj=a;DemandLoadHandler._endDemandLoadDelegate=$CD(this,DemandLoadHandler._endDemandLoad);jQuery(DemandLoadServices.Events).bind(DemandLoadServices.EventTypes.onenddemandload,DemandLoadHandler._endDemandLoadDelegate);DemandLoadHandler._disposed=false};DemandLoadHandler.dispose=function DemandLoadHandler$dispose(){if(!DemandLoadHandler._disposed){jQuery(DemandLoadServices.Events).unbind(DemandLoadServices.EventTypes.onenddemandload,DemandLoadHandler._endDemandLoadDelegate);DemandLoadHandler._endDemandLoadDelegate=DemandLoadHandler._contentObj=null;DemandLoadHandler._disposed=true}};DemandLoadHandler.getContent=function DemandLoadHandler$getContent(a){return DemandLoadHandler._contentObj[a]};DemandLoadHandler.filterFetchedContentIds=function DemandLoadHandler$filterFetchedContentIds(a){for(var b=a.length-1;b>=0;b--)if(DemandLoadHandler.getContent(a[b]))a.splice(b,1);return a};DemandLoadHandler.demandLoadContent=function DemandLoadHandler$demandLoadContent(a,c,e,f){if(!DemandLoadHandler._disposed){a=DemandLoadHandler.filterFetchedContentIds(a);var b=-1;if(a.length>0){if(typeof PostProcData!=="undefined"&&!f){var d=new PostProcData(false,false);d.hideInfoPane=false;b=InboxPage.createDataEventHandlers(d,false,false,false,false,true)}DemandLoadServices.beginDemandLoad(a,c,e,b)}else jQuery(DemandLoadServices.Events).trigger(DemandLoadServices.EventTypes.onenddemandload,{contentHash:null,callbacks:c,ctx:{id:b}})}};DemandLoadHandler.createFppCallback=function DemandLoadHandler$createFppCallback(b,a){return function(c,d){if(c.Content)jQuery(DemandLoadServices.Events).trigger(DemandLoadServices.EventTypes.onenddemandload,{contentHash:c.Content,callbacks:a,ctx:d});b(c,d)}};DemandLoadHandler._endDemandLoad=function DemandLoadHandler$_endDemandLoad(g,e){var a=e.contentHash,b=e.callbacks;for(var c in a)if(!FunctionHelper.isSpecialMember(a,c))DemandLoadHandler._contentObj[c]=a[c];if(b)for(var d=b.length-1;d>=0;d--){var f=b[d];if(f)f()}};(function(){var d=window.jQuery,a=window.wLive;a.Hotmail=a.Hotmail||{};a.Hotmail.PrefetchItem=b;function b(a){this.score=a.score();this.item=a}b.compare=function c(b,a){return b.score-a.score}})();(function(){var c=window.jQuery,a=window.wLive;a.Hotmail=a.Hotmail||{};if(a.Hotmail.Prefetcher)return;a.Hotmail.Prefetcher=new b;function b(){var e=this,h=a.Hotmail.PrefetchItem,r=MessageListPage.ViewType.Search,q=MessageListPage.ViewType.Folder,i=c(e),f=null,b=null,g={},p=0,d=true;e.$=i;if(Page&&Page.registerCustomHandler)Page.registerCustomHandler("PrefetchMessages",function(){});e.beginOptimisticPrefetch=function s(a){if(d)if(a!==b){if(f){f.cancel();f=null}g={};if(a.prefetchBucketSize()>0){b=a;j(true)}else b=null}};e.demandPrefetch=function t(b,a){InboxServices.beginPrefetchMessages(true,[new h(b)],1,a.viewId(),k,{ml:a})};e.dispose=function u(){d=false};function l(a){var c=a.id();return !g[c]&&a.score()>p&&InboxServices.conversationNeedsToBePrefetched(c,a.conv(),b.viewId())}function m(d,a){if(l(d)){var c=new h(d),e=a.length;for(var b=0;b<e;b++)if(h.compare(c,a[b])>0){a.splice(b,0,c);return}a.push(c)}}function j(c){var a=[];b.each(function(c,b){m(b,a)});if(a.length){var e=c?"onbeginoptimisticmessageprefetch":"oncontinueoptimisticmessageprefetch";i.trigger(e,{ml:b});var d={ml:b};f=InboxServices.beginPrefetchMessages(false,a,b.prefetchBucketSize(),b.viewId(),k,d,n,o)}else if(!c)i.trigger("onendoptimisticmessageprefetch",{ml:b})}function k(j,h,m){var c=[],d=m.ml,k=d.viewType(),f;if(k==r||k==q)f=d.viewId();else f=InboxPage.Config.sysFldrs.noneFid;var i=d.conv(),l=j.length;for(var e=0;e<l;e++){var a=null,b=j[e].item,g=b.id();if(i){a=InboxPage.createConversationRenderingInfo(false);if(b.conv())a.ConversationId=g;else a.MessageId=g}else{a=InboxPage.createMessageRenderingInfo();a.MessageId=g;if(b.vm()||b.isDirtyMad())a.AuxData=null;else a.AuxData=InboxPage.createMessageAuxData(b.mad());a.ConversationUpsell=b.ctu()}a.SenderEmail=b.getSenderEmails(true);a.FolderId=f;c.push(a)}if(i)h.cris=c;else h.mris=c}function n(c,i,e,f){d=d&&!e;if(d&&b==f.ml){var h=c.length;for(var a=0;a<h;a++)g[c[a].item.id()]=true;j(false)}}function o(c,a){if(b==a.ml)b=null}}})();InboxPage.initialize=function InboxPage$initialize(){InboxPage._hasError=false;window.attachEvent("onunload",InboxPage._onUnload);window.attachEvent("onresize",InboxPage._onResize);if(InboxPage.isMergeEnabled)$Do.when("$PF.attach",0,InboxPage.dispose);var d=_ge("MainContent");if(d)d.attachEvent("onresize",InboxPage._onResize);InboxPage._invokes=[];InboxPage.isReadingPaneOn="Bottom"==InboxPage.Config.readingPane.location||"Right"==InboxPage.Config.readingPane.location;InboxPage.hasSkyscraper=$css.has(_ge("contentRight"),"WithSkyscraper");InboxPage.searchPane=new SearchPane(_ge("searchPane"));InboxPage.folderList=new FolderList(_ge("folderListContainer"));InboxPage.quickViewList=new QuickViewList(_ge("quickViewListContainer"));InboxPage.messageList=InboxPage._initializeMessageList();InboxPage.readingPane=InboxPage._initializeReadingPane();InboxPage.selectionMsgPane=new SelectionMsgPane(_ge("selMsgPane"));if(InboxPage.Config.isComposeInlineRendered){InboxPage.composeFrame=new wLive.Hotmail.ComposeFrame;InboxPage.composeFrame.initialize();InboxPage.composeFrame.$.bind({onmessagesent:InboxPage._onComposeFrameMessageSent,oncompletemessage:InboxPage._onComposeFrameComplete,onshowcomplete:InboxPage._onComposeFrameViewChanged,onhidecomplete:InboxPage._onComposeFrameViewChanged,onresize:InboxPage._resizeFooter});InboxPage.folderList.setOnBeforeGoToFldrCallback(InboxPage.composeFrame.onBeforeUnloadCheck);InboxPage.quickViewList.setOnBeforeGoToQuickViewCallback(InboxPage.composeFrame.onBeforeUnloadCheck)}InboxPage._ic={ctrlReady:false,ctxReady:false};$Do.when("h_icCtxReady",0,InboxPage._onIdentityContextReady);$Do.when("h_icCtrlReady",0,InboxPage._onIdentityControlsReady);$Do.register("h_icCtrlReady");if(window.ic_dinit)$Do.register("h_icCtxReady");InboxPage.advancedSearch=null;var c=function(a,b){return Control.invokeStatic("InboxActions",a,b)};InboxPage.toolbar=new Toolbar(_ge("toolbarContainer"),c);InboxPage.toolbar.setIgnoreActions(Toolbar.standardIgnoreList);if(_ge("BottomToolbar")){InboxPage.bottomToolbar=new Toolbar(_ge("BottomToolbar"),c);InboxPage.bottomToolbar.setIgnoreActions(Toolbar.standardIgnoreList)}InboxPage.messageList.initFocusHandling();InboxPage.readingPane.initFocusHandling();if(InboxPage.kbdShortcuts)KeyboardHandler.initialize(InboxPage.kbdShortcuts,function(c,b){var a=Control.invokeStatic("InboxActions",b,c,{isKbd:true,senderData:null});if(!a&&!InboxPage.doNotCloseMenu)$menu.closeCurrent();InboxPage.doNotCloseMenu=false;return a},KbdShortcutsTimeout,false,function(){return !BulkActionsProgressUi.isVisible()&&!AlertManager.getInstance().isAlertVisible()&&!WebDialogManager.getInstance().isDialogVisible()},$CD(InboxPage.messageList,InboxPage.messageList.keyDownHandler));InboxPage.Content={};DemandLoadHandler.initialize(InboxPage.Content);BulkActionsProgressUi.initialize();if(InboxPage.Config.aliasRenameFlow&&!Object.isNull(window.AliasRenameFlowUi))AliasRenameFlowUi.initialize();InboxPage.actionQueueUiMgr=new wLive.Hotmail.ActionQueueUiMgr;InboxPage.actionQueueUiMgr.initialize();if(InboxPage.isFullView)InboxPage.showFullReadingPane(true,true);InboxPage.updateUi(true,false);Page.setupNetwork({onprecallback:InboxPage._onNetworkPreInvoke,onpostcallback:InboxPage._onNetworkPostCallback,onaftercallback:InboxPage._onPostInvoke});Control.onPreInvoke=InboxPage._onPreInvoke;Control.onPostInvoke=InboxPage._onPostInvoke;InboxServices.Events.endupdateui.attach($CD(this,InboxPage._endUpdateUi));InboxServices.Events.preendupdateui.attach($CD(this,InboxPage._preEndUpdateUi));InboxServices.Events.enddeleteallfromsender.attach($CD(this,InboxPage._endDeleteAllFromSender));InboxServices.Events.endmoveallfromsender.attach($CD(this,InboxPage._endMoveAllFromSender));InboxServices.Events.endundosendermovetoblocklist.attach($CD(this,InboxPage._endUndoSenderMoveToBlockList));InboxServices.Events.sethiddenbulkselectallstate.attach($CD(this,InboxPage._setHiddenBulkSelectAllState));Infopane.initialize();Infopane._instance.Events.onhide.attach($CD(this,InboxPage._onInfopaneVisibilityChanged));Infopane._instance.Events.onshow.attach($CD(this,InboxPage._onInfopaneVisibilityChanged));Page.initPageNavFppCallbackErrorSuppression();InboxPage.countUpdateHandlers={};var a=InboxServices.Operations;InboxPage.countUpdateHandlers[a.MarkMessages]=function(a,b){return FolderQuickViewListHelper.getCountOffsetsForMark(a.mids,a.isBulk,a.asRead,null,a.markingDuplicates,b)};InboxPage.countUpdateHandlers[a.FlagMessages]=function(a,b){return FolderQuickViewListHelper.getCountOffsetsForFlagMessages(a.mids,a.isBulk,a.asFlagged,a.flaggingDuplicates,b)};InboxPage.countUpdateHandlers[a.MoveMessages]=function(a,b){return FolderQuickViewListHelper.getCountOffsetsForMove(a.mids,a.isBulk,a.toFid,a.movingDuplicates,b)};InboxPage.countUpdateHandlers[a.DeleteMessagePart]=function(a,b){return FolderQuickViewListHelper.getCountOffsetsForMove(a.mids,a.isBulk,InboxPage.Config.sysFldrs.trashFid,false,b)};InboxPage.countUpdateHandlers[a.MarkMessagePartForJmr]=function(a,b){return FolderQuickViewListHelper.getCountOffsetsForJmr(a.mids,a.isBulk,a.jmrType,b)};InboxPage.countUpdateHandlers[a.SetJunkStatus]=function(a,b){return FolderQuickViewListHelper.getCountOffsetsForJmr(a.mids,a.isBulk,a.jmrType,b)};$Do.when("$History.attach",0,function(b,a){InboxPage.isRestoringState=true;Control.invokeStatic("InboxPage","_onRestoreState",{},a);InboxPage.isRestoringState=false});LoadingIndicator.hide();$Cookie.deleteCookie(InboxPage.Config.konaRefreshCookie);InboxPage._initDldbg();InboxPage._initPrefetch();if(InboxPage.readingPane.mode==ReadingPane.DELAY_LOADED_MODE){var b=function(){Control.invokeStatic("ReadingPane","doDelayLoad",{},InboxPage.readingPane)};if(InboxPage.Config.hasIc)$Do.when("$ic",0,b);else b()}else if(!InboxPage.isReadMessageMode&&InboxPage.Config.readingPane.autoSelectFirstMsg&&InboxPage.isReadingPaneOn)InboxPage._markCurrentAsRead();else if(InboxPage.isReadMessageMode)InboxPage._markCurrentAsRead(true);if(InboxPage.upsellActionUrl)OptionsWriter.fireOption(String.format(InboxPage.upsellActionUrl,InboxPage.upsellShowAction));Loader.load(InboxPage.cssUrls,InboxPage.scriptUrls,function(){InboxPage.initializeBucket1()});Page.resize(InboxPage._onResize)};InboxPage._initializeMessageList=function InboxPage$_initializeMessageList(){var c=InboxPage._getCurrentMessageListTitleHtml(),a=new HM.MessageListRenderingInfo,d=InboxPage.folderList;a.FolderId=d.fid;a.QuickViewId=InboxPage.quickViewList.qvid;a.IsSearchResults=d.isSrch;a.PageNumCurrent=null;var b=new MessageListPage(jQuery("#messageListContainer div")[0],null,a,c.root,c.sub);InboxServices.maybeCacheMessageListPage(b);return new MessageList(_ge("messageListContainer"),b)};InboxPage._initializeReadingPane=function InboxPage$_initializeReadingPane(){var a=_ge("readingPaneHtml"),b=null,f=null;if(a){var d=jQuery.parseJSON(a.getAttribute("md")),c=a.innerHTML,e=true;if(Browser.isSF){var g=document.createElement("textarea"),i="&lt;",h="<";g.innerHTML=i;if(g.innerHTML==h)e=false}if(e)c=c.decodeHtml();b=new Conversation(c,d,null,null);InboxServices.bootstrapConversation(b,{hasSuggestion:false});f=d.MessageId}return new ReadingPane(_ge("readingPaneContainer"),b,f)};InboxPage._initPrefetch=function InboxPage$initPrefetch(){if(InboxPage.Config.isPrefetchEnabled){var d=jQuery(InboxServices.Events),a=InboxServices.EventTypes;d.bind(a.ongetmessagelist,InboxPage._prefetchForMessageList);var c=a.onbootstrapmessage;d.bind(a.ongetmessage,InboxPage._maybeDemandPrefetchNextMessage).bind(c,InboxPage._maybeDemandPrefetchNextMessage);var e=$Do.iff(c,null);function b(){if(InboxPage.messageList&&InboxPage.messageList.ml)wLive.Hotmail.Prefetcher.beginOptimisticPrefetch(InboxPage.messageList.ml)}if(e)setTimeout(b,0);else b()}};InboxPage._prefetchForMessageList=function InboxPage$_prefetchForMessageList(b,a){if(a&&a.ml)wLive.Hotmail.Prefetcher.beginOptimisticPrefetch(a.ml)};InboxPage._maybeDemandPrefetchNextMessage=function InboxPage$_maybeDemandPrefetchNextMessage(d,c){var a=InboxPage.messageList;if(a){var b=a.getNextOrPreviousMessageListItem(true,c.conversation.id(),true);if(b)wLive.Hotmail.Prefetcher.demandPrefetch(b,a.ml)}};InboxPage._initDldbg=function InboxPage$initDldbg(){var a=window["showDataLayerDebugConsole"]||null;if(a)a()};InboxPage._onPreInvoke=function InboxPage$_onPreInvoke(a,b,c){if(a=="Resize")return;if(InboxPage._invokes.length>5)InboxPage._invokes.shift();InboxPage._invokes.push({typeName:a,methodName:b,args:c});InboxPage._hasError=false;InboxPage.messageList.cancelContextMenuTimers()};InboxPage._onPostInvoke=function InboxPage$_onPostInvoke(a){if(a=="Resize")return};InboxPage._initPostProcessState=function InboxPage$_initPostProcessState(c){if(c.showLoading&&!(typeof ToastManager!="undefined"&&ToastManager.getInstance().isToastVisible()))LoadingIndicator.show();if(c.hideInfoPane&&!InboxPage._hasError)Infopane.hide();var a=InboxPage.advancedSearch;if(a&&a.isLoaded()){var b=c.inbox;if(b.showAdvancedSearch){if(b.advancedSearch)a.setSearch(b.advancedSearch);a.show()}else if(b.hideAdvancedSearch)a.hide()}};InboxPage._postProcessUserAction=function InboxPage$_postProcessUserAction(c){var b=c.staticData,a=b.ppd;if(!a)return;if(a.history&&!InboxPage._hasError)setTimeout(InboxPage._saveState,1);if(a.uiUpdate)InboxPage.updateUi(false,true);if(a.reportCSIPerf)a.reportCSIPerf(a);else{if(!a.skipCsi){$CSIPerf.addCsd("f",InboxPage.messageList.getViewId());$CSIPerf.addCsd("rp",InboxPage.Config.readingPane.location)}$BSI.informPVHead();if(!a.inbox.delayBsiForReadMessage)setTimeout(function(){$BSI.informLoaded(!a.ads)},100)}if(a.hideInfoPane&&!InboxPage._hasError)Infopane.hide();if(typeof ToastManager!="undefined")ToastManager.getInstance().hideVisibleToast();LoadingIndicator.hide();$Do.when("$NM.clear")};InboxPage.dispose=function InboxPage$dispose(){InboxPage._onUnload()};InboxPage._onUnload=function InboxPage$_onUnload(){window.detachEvent("onunload",InboxPage._onUnload);InboxPage._createKRCookie();Infopane.cleanup();Page.dispose();if(InboxPage.actionQueueUiMgr)InboxPage.actionQueueUiMgr.dispose();if(InboxPage.folderList)InboxPage.folderList.dispose();if(InboxPage.quickViewList)InboxPage.quickViewList.dispose();if(InboxPage.messageList){InboxPage.messageList.disposeFocusHandling();if(InboxPage.messageList.disposeContextMenu)InboxPage.messageList.disposeContextMenu();if(InboxPage.messageList.disposeGotoPicker)InboxPage.messageList.disposeGotoPicker();InboxPage.messageList.dispose()}if(InboxPage.readingPane){InboxPage.readingPane.disposeFocusHandling();InboxPage.readingPane.dispose()}if(InboxPage.selectionMsgPane)InboxPage.selectionMsgPane.dispose();if(InboxPage.searchPane)InboxPage.searchPane.dispose();if(InboxPage.advancedSearch){InboxPage.advancedSearch.dispose();InboxPage.advancedSearch=null}if(InboxPage.splitter)InboxPage.splitter.dispose();if(InboxPage.dnd)InboxPage.disposeDragDrop();if(InboxPage.kbdShortcuts)KeyboardHandler.dispose();DemandLoadHandler.dispose();Loader.dispose();BulkActionsProgressUi.dispose();if(InboxPage.toolbar)InboxPage.toolbar.dispose();if(InboxPage.bottomToolbar)InboxPage.bottomToolbar.dispose();if(InboxPage.composeFrame)InboxPage.composeFrame.dispose();if(InboxPage.Config.isPrefetchEnabled&&wLive&&wLive.Hotmail&&wLive.Hotmail.Prefetcher)wLive.Hotmail.Prefetcher.dispose();if(InboxPage.miniCalendarApp){InboxPage.miniCalendarApp.$().unbind();InboxPage.miniCalendarApp.dispose()}InboxPage.doNotCloseMenu=null;LoadingIndicator.hide();document.body.removeAttribute("pagefunctional");if(ActionQueue)ActionQueue.dispose();if(Cache)Cache.dispose();top.$Do.remove("$History",0,InboxPage._addToHistory)};InboxPage._onResize=function InboxPage$_onResize(o,k,m){Resize._mainContentResize();var a=_ge("sortFilterContainer");if(a){var d=_ge("msgListMainContainer"),j=[],f=$tag(a,"SPAN"),l=f.length;for(var c=0;c<l;++c)if($css.has(f[c],"Fs_f"))j.push(f[c]);var g=_ge("searchPane"),i=$getDisplay(g),h=InboxPage.isReadingPaneOn&&(k||i),n=h?[]:[d];Resize.resizeToolbarForToolbarItems(a,j,n);if(m)d.style.top="0em";else if(h){var b;if(!i){a.style.top="";b=Resize.convertToEm(a.offsetTop)}else{b=Resize.convertToEm(g.offsetTop+g.offsetHeight);a.style.top=b+"em"}d.style.top=b+Resize.convertToEm(a.offsetHeight)+"em"}}var e=InboxPage.readingPane;if(e.isShowingMessage())setTimeout($CD(e,e.resetMessageWidths),1);InboxPage._maybeResizeMessageList()};InboxPage._maybeResizeMessageList=function InboxPage$_maybeResizeMessageList(){var d=InboxPage.messageList;if(d&&InboxPage.isReadingPaneOn){var a=_ge("messageListInnerContainer");if(a.children.length==3){var e=a.children[0],b=a.children[1],c=a.children[2];b.style.bottom=c.offsetHeight+"px";e.style.bottom=c.offsetHeight+b.offsetHeight+"px"}}};InboxPage.shouldWaitForMessageEvent=function InboxPage$shouldWaitForMessageEvent(a){return (InboxPage.isReadingPaneOn||InboxPage.readingPane.isFullView)&&a!=null&&a.AutoSelectMessageIndex!=-1};InboxPage.beginRefreshInbox=function InboxPage$beginRefreshInbox(b,e,d,c,h,f,g,m,i,j,l,o,a,k){InboxPage.readingPane.doubleClicked=false;InboxPage.readingPane.setHTMLed=false;if(!a&&!k){a=new PostProcData(true,true);InboxPage.maybeUpdatePostProcDataForMessage(a,c,false)}if(a&&!a.uiUpdate&&(b||f))a.uiUpdate=true;var n=InboxPage.createDataEventHandlers(a,b,b,e,c||InboxPage.shouldWaitForMessageEvent(d),false,false,null,true);InboxServices.beginRefreshInbox(b,e,d,c,h,f,g,m,i,j,l,o,n)};InboxPage.getEncodedEmails=function InboxPage$getEncodedEmails(b){var c=new Array(b.length);for(var a=0;a<b.length;a++)c[a]=b[a].encodeHtml();return c};InboxPage._onComposeFrameMessageSent=function InboxPage$_onComposeFrameMessageSent(h,a){if(a&&a.ctx){var b=InboxPage,c=a.ctx,g=c.guid,d=c.actionType,e=b.messageList.ml,f=b.readingPane.cv||null;InboxServices.fixupCacheAfterCompose(g,d,e,f)}};InboxPage._onComposeFrameComplete=function InboxPage$_onComposeFrameComplete(p,b){if(!InboxPage.composeFrame.onBeforeUnloadCheck()){var d=null,k=null,m=InboxPage.messageList.ml,o=InboxPage.readingPane.cv||null,c=b&&b.sent;if(InboxPage.readingPane&&InboxPage.readingPane.isShowingMessage()){var e=b.ctx;if(c&&e){d=e.guid;k=e.actionType}}var j=k===HM.MessageActionType.ResumeDraft,f=function n(){if(j){var a=InboxPage.readingPane;if(a.isFullView)a.closeMessage(false);else a.reset()}if(!c)InboxPage.composeFrame.hide();if(InboxPage.showSmc)InboxPage.showSmc()};if(c){var g=InboxPage.createMessageListRenderingInfo(true,false),h=m.conv(),i=false,a=null;if(d&&!j){i=true;a=h?InboxPage.createConversationRenderingInfo(false):InboxPage.createMessageRenderingInfo();a.MessageId=d;g.AutoSelectMessageIndex=-1}var l=new PostProcData(false,true);l.composeFrame.hide=true;InboxPage.beginRefreshInbox(true,true,g,i,a,true,h,f,null,false,false,null,l,true)}else f()}};InboxPage._onComposeFrameViewChanged=function InboxPage$_onComposeFrameViewChanged(){InboxPage._resizeFooter()};InboxPage._setHiddenBulkSelectAllState=function InboxPage$_setHiddenBulkSelectAllState(a){InboxPage.messageList.setHiddenBulkSelectAll(a[0])};InboxPage._endDeleteAllFromSender=function InboxPage$_endDeleteAllFromSender(j){var b=j[0],a=DemandLoadHandler.getContent(HM.ContentId.CommonDeleteAndBlockAllFromSender),h=DemandLoadHandler.getContent(b["blockFromJunk"]?HM.ContentId.BlockAllFromSender:HM.ContentId.DeleteAllFromSender),c=1==b.senders.length,i=DemandLoadHandler.getContent(HM.ContentId.CommonSenderAction).emailSeparator,e=InboxPage.getEncodedEmails(b.senders).join(i),f=b.unblockedSndrs,g=1==b.processedCount?a.confirmOneMsg:String.format(a.confirmMultipleMsgsTmpl,b.processedCount),d;if(f)if(0==f.length)d=String.format(c?h.confirmDelAndAllBlockOneSenderTmpl:h.confirmDelAndAllBlockMultipleSenderTmpl,g,e,a.blkSndrsLink);else d=String.format(c?a.confirmDelAndNotBlockOneSenderTmpl:a.confirmDelAndNotBlockMultipleSenderTmpl,g,e,a.contactsLink,c?null:InboxPage.getEncodedEmails(f).join(i));else d=String.format(c?a.confirmDelOnlyOneSenderTmpl:a.confirmDelOnlyMultipleSenderTmpl,g,e);InboxPage.selectionMsgPane.showGeneralMsg(d,a.confirmHeader,true);InboxServices.Events.closebulkactionprogressui.fire([]);if(b.onCompletionUiUpdateFn)b.onCompletionUiUpdateFn(true)};InboxPage._endMoveAllFromSender=function InboxPage$_endMoveAllFromSender(h){var a=h[0],b=DemandLoadHandler.getContent(HM.ContentId.MoveAllFromSender),e=1==a.senders.length,g=DemandLoadHandler.getContent(HM.ContentId.CommonSenderAction).emailSeparator,f=InboxPage.getEncodedEmails(a.senders).join(g),c;if(e)c=a.processedCount==1?(c=b.confirmMoveOnlyOneSenderOneMsgTmpl):b.confirmMoveOnlyOneSenderMultipleMsgTmpl;else c=b.confirmMoveOnlyMultipleSendersTmpl;var d=String.format(c,f,FolderQuickViewListHelper.getFolderNameByFid(a.toFldr).encodeHtml(),e&&a.processedCount==1?null:a.processedCount);if(a.rulesCreated)d=[d,b.confirmRule].join(" ");InboxPage.selectionMsgPane.showGeneralMsg(d,b.confirmHeader,true);InboxServices.Events.closebulkactionprogressui.fire([]);if(a.onCompletionUiUpdateFn)a.onCompletionUiUpdateFn(true)};InboxPage._endUndoSenderMoveToBlockList=function InboxPage$_endUndoSenderMoveToBlockList(c){var b=c[0],a=Infopane.getInstance();a.setContent(b);a.show()};InboxPage._setMessageToView=function InboxPage$_setMessageToView(l,a){if(a){InboxPage.messageList.cleanUpContextMenu();var c=a.conversation,k=a.ctx,d=k.itemRenderingInfo,b=InboxPage.readingPane;if(!a.hasSuggestion||!InboxPage.isReadingPaneOn){b.reset();InboxPage.messageList.updateSelectedCount();if(!InboxPage.isReadingPaneOn){InboxPage.showFullReadingPane(true);if(Browser.isIE6)Resize.Element_OnResize(_ge("readingPaneSplitPane"),false)}var i=d?d.ConversationId||d.MessageId:null;b.setConversation(c,i);var f=InboxPage.messageList.ml.getById(i||c.secretCid()||c.id());if(f){var h=null;if(InboxPage.Config.isPrefetchEnabled)h=a.fromCache?0:f.score()>0?2:1;var e=InboxPage.makeBsiMessageData(f,h,InboxPage.BsiMessageDataType.Read),g=c.readInstrumentation();if(g)jQuery.extend(e,g);var j=_ge("readingPaneContainer");if(!InboxPage.isReadingPaneOn&&InboxPage.readingPane.isFullView&&j)e.RMW=j.scrollWidth;$BSI.reportEvent("ReadView.Messaging.Mail",e)}$BSI.reportEvent("ReadView.M2Launch",InboxPage.clusterAndBrowserDataPoints);InboxPage.resetContentHeight(_ge("readingPaneContentContainer"));if(b.mode==ReadingPane.DELAY_LOADED_MODE)setTimeout(function(){ReadingPane.doDelayLoad(b)},1);else if(b.mode==ReadingPane.MESSAGE_MODE)InboxPage._markCurrentAsRead(false,!!a.prefetched)}}};InboxPage.BsiMessageDataType=new $Enum("MarkRead","DeleteRemove","Read");InboxPage.makeBsiMessageData=function InboxPage$makeBsiMessageData(a,g,d){var e=InboxPage.messageList,f=e.ml,b={CNT:a.isSenderInContactList()?1:0,TRU:a.isTrustedSender()?1:0,FLG:a.flag()?1:0,PRI:a.isHighPriority()?1:0,FLT:InboxPage._getFilterInstrumentationValue(f.fltid()),MID:a.id(),PRT:"Web"};if(g!==null)b.CCH=g;var c=InboxPage.BsiMessageDataType;if(d!=c.MarkRead){b.RE=a.read()?1:0;var h=InboxPage._parseMdt(a.mdt());if(h){var i=(new Date).getTime()-h.getTime();b.DIF=Math.round(i/6e4)}if(d==c.Read)b.IDX=a.origIndex();if(d==c.DeleteRemove){b.FLD=InboxPage._getFolderInstrumentationValue(e.getViewId());b.CON=f.conv()?1:0}}return b};InboxPage._getFilterInstrumentationValue=function InboxPage$_getFilterInstrumentationValue(c){var b=InboxPage.Config.filters,a="";switch(+c){case b.noneFltid:a="5";break;case b.unreadFltid:a="1";break;case InboxPage.Config.quickViews.contactQvid:a="2";break;case b.socialFltid:a="3";break;case b.groupsFltid:a="4";break;case b.otherFltid:a="0"}return a};InboxPage._getFolderInstrumentationValue=function InboxPage$_getFolderInstrumentationValue(b){var a=0;switch(b){case "Inbox":a=0;break;case "Junk":a=1;break;case "Trash":a=4;break;case "Sent":a=3;break;case "Drafts":a=2;break;case "Custom":a=5}return a};InboxPage._parseMdt=function InboxPage$_parseMdt(c){var d=null;if(c){var b=Date.parse(c),a;if(isNaN(b)&&(a=/^(\d{4}|[+\-]\d{6})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})\.(\d{3,})/.exec(c)))b=Date.UTC(+a[1],+a[2]-1,+a[3],+a[4],+a[5],+a[6],+a[7].substr(0,3));if(!isNaN(b))d=new Date(b)}return d};InboxPage._setMessageListToView=function InboxPage$_setMessageListToView(f,b){if(b&&b.ml&&!b.ctx.isAutoRefresh){InboxPage.messageList.cleanUpContextMenu();var a=b.ml,d=b.ctx,c=d.messageListRenderingInfo,e=c&&!isNaN(c.AutoSelectMessageIndex)?Math.min(c.AutoSelectMessageIndex,a.countNormal()-1):-1;InboxPage.messageList.setMessageListPage(a,!!d.maintainCurrentSelection&&!InboxPage.isUnreadFilterOrFlaggedQuickView(),e);FilterSelector.updateState(a.fltid());InboxPage._maybeUpdateMessageListTitleHtml(a.rootTitle(),a.subTitle());InboxPage._maybeResizeMessageList()}};InboxPage._setFolderListToView=function InboxPage$_setFolderListToView(f,a,c){InboxPage.messageList.cleanUpContextMenu();if(a&&a.flHtml){var d=a.flHtml,c=a.ctx;InboxServices.fixupCacheForFolderListChanges(InboxPage.folderList.elt,d,c);InboxPage.folderList.setHTML(d)}else if(c){var b=c.messageListRenderingInfo;if(b){var e=b.FolderId;if(e&&e!==InboxPage.Config.sysFldrs.noneFid)InboxPage.folderList.updateSelection(b)}}};InboxPage._setQuickViewToView=function InboxPage$_setQuickViewToView(e,a,d){InboxPage.messageList.cleanUpContextMenu();var c=InboxPage.quickViewList;if(a&&a.qvHtml)c.setHTML(a.qvHtml);else if(d){var b=d.messageListRenderingInfo;if(b&&!b.QuickViewId)c.clearSelection()}};InboxPage._processUiUpdateEvents=function InboxPage$_processUiUpdateEvents(a){var h=a.staticData,c=a.ongetfolderlist||null,b=a.ongetquickviewlist||null,e=a.ongetmessagelist||null,f=a.ongetmessage||null,d=a.onstoplistening||null,g=d?d.ctx:null;if(c||d)InboxPage._setFolderListToView(null,c,g||c.ctx);if(b||d)InboxPage._setQuickViewToView(null,b,g||b.ctx);if(e)InboxPage._setMessageListToView(null,e);if(f)InboxPage._setMessageToView(null,f);var i=jQuery.extend(true,{},c,b,e,f);InboxPage._postRefreshUiTasks(i.ctx||{},h.ppd)};InboxPage._endUpdateUi=function InboxPage$_endUpdateUi(e){var a=e[0],l=e[1],b=e[2]||{},c=b.ppd;if(b.autoGeneratedRequest&&c){c.hideInfoPane=false;c.history=false;c.ads=false}var k=a?a.MessageHtml:null,i=a?a.ItemInfo:null,g=a?a.InfoPaneHtml:null,f=a?a.SuggestionHtml:null,d=a?a.BiciJsonConfig:null;InboxPage.messageList.cleanUpContextMenu();if(!k&&!i&&b&&!b.isAutoRefresh&&!b.hasConfirmationMsg&&!InboxPage.messageList.areAnyItemsSelected())InboxPage.messageList.updateSelectedCount();if(b.isHiddenBulk)InboxServices.Events.sethiddenbulkselectallstate.fire([false]);if(g&&b.id==Page.currentViewIdInProgress)InboxPage.showInfoPane(g);var j=!!f;if(j||b.hasConfirmationMsg){InboxPage.selectionMsgPane.showGeneralMsg(f,null);var h=_ge("NoMsgs");if(h)$setDisplay(h,false)}else if(InboxPage.messageList.getItemCount()==0)InboxPage.selectionMsgPane.hide();if(-1==InboxPage.messageList.getSelectionIndex()&&InboxPage.readingPane.isFullView&&!b.markSenderAsSafe&&b.jmrType!=HM.JmrType.Unsubscribe)InboxPage.showFullReadingPane(false);if(d){d=Object.fromJSON(d);$Utility.updateObject($Config,d.$Config)}$CSIPerf.payloadLength=0;if(a)jQuery.each(a,function(b,a){if(jQuery.type(a)=="string")$CSIPerf.payloadLength+=a.length});InboxPage._postRefreshUiTasks(b,c)};InboxPage._postRefreshUiTasks=function InboxPage$_postRefreshUiTasks(d,c){if(c){var b=c.composeFrame,a=InboxPage.composeFrame;if(!d.autoGeneratedRequest&&a)if(b.hide)a.hide(true);else if(b.load)a.load()}};InboxPage.callDelayedBsi=function InboxPage$callDelayedBsi(a){setTimeout(function(){$BSI.informLoaded(!a)},100)};InboxPage.showInfoPane=function InboxPage$showInfoPane(b){var a=Infopane.getInstance();a.setContent(b);a.show()};InboxPage._onInfopaneVisibilityChanged=function InboxPage$_onInfopaneVisibilityChanged(){InboxPage._resizeFooter()};InboxPage._resizeFooter=function InboxPage$_resizeFooter(){if(Page.getLayout().indexOf("Unmanaged")>=0)UnmanagedFooter.resize()};InboxPage._maybeUpdateMessageListTitleHtml=function InboxPage$_maybeUpdateMessageListTitleHtml(b,c){var a=jQuery("#messageListTitle");if(a.length==1){if(null!=b)a.find("SPAN[rt]").html(b);if(null!=c)a.find("SPAN[sb]").html(c)}};InboxPage._getCurrentMessageListTitleHtml=function InboxPage$_getCurrentMessageListTitleHtml(){var a=jQuery("#messageListTitle");return {root:a.find("SPAN[rt]").html(),sub:a.find("SPAN[sb]").html()}};InboxPage._preEndUpdateUi=function InboxPage$_preEndUpdateUi(a){var c=a[0],g=a[1],b=a[2],e=a[3],d=InboxPage.countUpdateHandlers[g];if(typeof d!=="undefined"&&FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(b.mids,b.isBulk,e))if(!c||!c.FolderListHtml&&!c.QuickViewListHtml){var f=d(b,e);FolderQuickViewListHelper.updateCounts(f)}};InboxPage._scrollToTop=function InboxPage$_scrollToTop(){var a=Browser.isSF?document.body:$tag(document,"HTML")[0];a.scrollTop=0};InboxPage._markCurrentAsRead=function InboxPage$_markCurrentAsRead(g,f){var i=InboxPage.readingPane.mode;if(i!=ReadingPane.MESSAGE_MODE)return;var a=InboxPage.readingPane;if(a.isVoicemail())return;var b=a.getUnreadMids(),e=a.cv,d=InboxPage.messageList,h=FolderQuickViewListHelper.getCountOffsetsForMark(b.unreadMids,false,true,g,b.foundDupes,d.ml);FolderQuickViewListHelper.updateCounts(h);var c=a.getItemId();if(b.foundDupes&&a.numMessageParts()==1)c=e.secretCid();d.updateReadState(d.ml.containsId(c)?[c]:b.unreadMids,false,true);InboxPage.maybeDisableRefreshForReadAction();e.updateReadState(c,true);if(f&&b.unreadMids.length)Messages.markAsReadUnread(a.getSelectedMessageData(),true,true)};InboxPage.formatMsgWithGenericFolderOrViewString=function InboxPage$formatMsgWithGenericFolderOrViewString(a){return String.format(a,Page.decode(InboxPage.isQuickViewFilterOrSearch()?InboxPage.Strings.genericView:InboxPage.Strings.genericFolder))};InboxPage.isQuickViewFilterOrSearch=function InboxPage$isQuickViewFilterOrSearch(){return !InboxPage.areNoFiltersApplied()||InboxPage.quickViewList.qvid||InboxPage.isSearch()};InboxPage.areNoFiltersApplied=function InboxPage$areNoFiltersApplied(){var a=InboxPage.messageList.ml.fltid();return !a||InboxPage.Config.filters.noneFltid==a};InboxPage.isSearch=function InboxPage$isSearch(){return InboxPage.folderList.fid==InboxPage.Config.sysFldrs.searchFid};InboxPage.isUnreadFilterOrFlaggedQuickView=function InboxPage$isUnreadFilterOrFlaggedQuickView(){return InboxPage.messageList.ml.fltid()==InboxPage.Config.filters.unreadFltid||InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid};InboxPage.maybeDisableRefreshForReadAction=function InboxPage$maybeDisableRefreshForReadAction(){if(InboxPage.messageList.ml.fltid()==InboxPage.Config.filters.unreadFltid)InboxPage.messageList.disableRefreshForMl=true};InboxPage.maybeDisableRefreshForFlagAction=function InboxPage$maybeDisableRefreshForFlagAction(){if(InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid)InboxPage.messageList.disableRefreshForMl=true};InboxPage.showFullReadingPane=function InboxPage$showFullReadingPane(c,e,a){var b=-1;if(a)b=InboxPage.createDataEventHandlers(a,false,false,false,false,false,false,{src:InboxServices.Events,type:InboxServices.EventTypes.onproxycompleted});var d=c!=InboxPage.readingPane.isFullView;if(c){InboxPage.readingPane.showFullView();InboxPage.messageList.hide()}else{InboxPage.messageList.show();InboxPage.readingPane.hideFullView()}if(InboxPage.isReadingPaneOn&&!InboxPage.readingPane.isFullView){$css.remove(_ge("readingPaneSplitter"),"SplitterBarHidden");InboxPage.initSplitter()}else $css.add(_ge("readingPaneSplitter"),"SplitterBarHidden");if(a)jQuery(InboxServices.Events).trigger(InboxServices.EventTypes.onproxycompleted,{ctx:{id:b}});if(!e&&d&&!InboxPage.isReadingPaneOn)setTimeout(InboxPage._scrollToTop,1)};InboxPage._onIdentityControlsReady=function InboxPage$_onIdentityControlsReady(){InboxPage._ic.ctrlReady=true;InboxPage._InitICsIfReady()};InboxPage._onIdentityContextReady=function InboxPage$_onIdentityContextReady(){InboxPage._ic.ctxReady=true;InboxPage._InitICsIfReady()};InboxPage._InitICsIfReady=function InboxPage$_InitICsIfReady(){var a=InboxPage._ic;if(a.ctrlReady&&a.ctxReady&&typeof $ic!="undefined"&&typeof $ic.ic!="undefined")$ic.ic.init()};InboxPage._createKRCookie=function InboxPage$_createKRCookie(){$Cookie.setCookieValues(InboxPage.Config.konaRefreshCookie,InboxPage._getCurrentState())};InboxPage._addToHistory=function InboxPage$_addToHistory(){top.History.addNavigationStep(InboxPage._getCurrentState(),true)};InboxPage._saveState=function InboxPage$_saveState(){top.$Do.when("$History",0,InboxPage._addToHistory)};InboxPage._getCurrentState=function InboxPage$_getCurrentState(){var c=InboxPage.messageList.ml,d=InboxPage.folderList,m=InboxPage.quickViewList,e=InboxPage.readingPane,i=InboxPage.advancedSearch,k=$InboxPage.defaultState,j=InboxPage.composeFrame,g=InboxPage.Config.sysFldrs,a={fid:d.fid==g.noneFid||d.fid==g.searchFid?null:InboxPage.compressGuid(d.fid),qvid:m.qvid||null,fltid:c.fltid()||null,so:c.sBy(),sa:c.sAsc()?"1":"0",pdir:c.pDir()+"",paid:c.aMid(),pad:c.aDate(),pidx:c.pCur()+"",fav:d.isFavoriteSelected?"1":"0",n:Page.queryString.newNonce};if($InboxPage.isRruRequest)a.rru="inbox";var b=i?i.getSearch():null;if(b){a.as="1";a.askws=b.Keywords||"";a.asfrm=b.From||"";a.asto=b.To||"";a.assub=b.Subject||"";a.asfld=b.Folder||"";a.asbeg=b.DateBegin||"";a.asend=b.DateEnd||"";if(b.HasAttachment)a.asatt="1"}else a.st=d.srchKw||"";if(e.isShowingMessage()){var l=e.getActionableMsgPart(),h=e.cv.cid();if(h)a.cid=h;else a.mid=l.msg.mid();a.fv=e.isFullView?"1":"0"}if(j)j.updateState(a);for(var f in a)if(a[f]==k[f])delete a[f];return a};InboxPage._normalizeState=function InboxPage$_normalizeState(b){var c=$InboxPage.defaultState;for(var a in c)if(!b[a])b[a]=c[a]};InboxPage._onRestoreState=function InboxPage$_onRestoreState(a){if(window["WebDialogManager"])WebDialogManager.getInstance().hideVisibleDialog();if(window["AlertManager"])AlertManager.getInstance().hideVisibleAlert();if(window["TooltipManager"])TooltipManager.getInstance().hideVisibleTooltip();var b=InboxPage._getCurrentState(),v=$InboxPage.defaultState;InboxPage._normalizeState(a);InboxPage._normalizeState(b);var m=false,f=InboxPage.composeFrame;if(f){var u=a.cv=="1";if(u&&!f.isVisible()){f.show(null,null,null,true);m=true}else if(!u&&f.isVisible())if(f.onBeforeUnloadCheck())setTimeout(function(){InboxPage._saveState()},1);else{f.hide(true);m=true}}if(!m){var e=null,c=null,k=false,t=false,D=b.fid!=a.fid||b.qvid!=a.qvid,p=InboxPage.messageList.ml.conv(),i=p&&v.cid!=a.cid,z=v.mid!=a.mid,l=p&&b.cid!=a.cid,n=b.mid!=a.mid,A=i?a.cid:a.mid,s=InboxPage.messageList.ml.getById(A),j=z||i,x=InboxPage.readingPane.isShowingMessage(),C=a.as=="1",w=b.fid!=a.fid||b.qvid!=a.qvid||b.fltid!=a.fltid,o=InboxPage.decompressGuid(a.fid),h=w||b.fav!=a.fav||b.so!=a.so||b.sa!=a.sa||b.paid!=a.paid||b.pad!=a.pad||b.pdir!=a.pdir||b.pidx!=a.pidx||b.st!=a.st||b.as!=a.as||b.askws!=a.askws||b.asfrm!=a.asfrm||b.asto!=a.asto||b.assub!=a.assub||b.asfld!=a.asfld||b.asbeg!=a.asbeg||b.asend!=a.asend||b.asatt!=a.asatt,r=s&&s.visible(),y=a.fv=="1",q=!n&&!l&&!h&&b.fv!=a.fv,F=j&&(!x||InboxPage.isReadingPaneOn)&&(n||l)&&!h&&r,E=q&&!y||!j&&x&&(n||l)&&!h,B=j&&!h&&!r;if(q&&y)InboxPage.readingPane.openFullView();else if(F)InboxPage.messageList.openMessage(A);else if(E||B)InboxPage.readingPane.closeMessage();else{var g=new PostProcData(true,false);g.uiUpdate=true;if(h){c=InboxPage.createMessageListRenderingInfo(false);c.FolderId=a.st||a.as=="1"?InboxPage.Config.sysFldrs.searchFid:o;c.QuickViewId=a.qvid;c.FilterId=a.fltid;c.IsFavoriteSelected=a.fav=="1";c.SortKey=a.so;c.SortAsc=a.sa=="1";c.AnchorId=a.paid;c.AnchorDate=a.pad;c.PageDirection=a.pdir;c.PageNumCurrent=a.pidx;c.SearchKeyword=a.st;c.IsSearchResults=a.st!="";t=true;if(C){var d=new HM.AdvancedSearch;d.From=a.asfrm;d.Keywords=a.askws;d.DateBegin=a.asbeg;d.DateEnd=a.asend;d.Subject=a.assub;d.To=a.asto;if(a.asatt=="1")d.HasAttachment=true;d.Folder=a.asfld;c.AdvancedSearch=d;g.inbox.showAdvancedSearch=true;g.inbox.advancedSearch=d}else g.inbox.hideAdvancedSearch=true}if(j){if(i){e=InboxPage.createConversationRenderingInfo(false);e.ConversationId=a.cid;e.FolderId=o;k=true}else if(z){e=InboxPage.createMessageRenderingInfo();e.MessageId=a.mid;e.FolderId=o;e.AuxData=null;k=true}InboxPage.maybeUpdatePostProcDataForMessage(g,k,false)}InboxPage.beginRefreshInbox(D,t,c,k,e,w,i,null,null,false,false,null,g)}}};InboxPage.compressGuid=function InboxPage$compressGuid(a){if(!a||typeof a!=="string")return a;return a.replace(/[-]*/g,"").replace(/^[0]*/,"")};InboxPage.decompressGuid=function InboxPage$decompressGuid(a){if(!a||typeof a!=="string"||a.length>32)return a;return ["00000000000000000000000000000000",a].join("").slice(-32)};InboxPage.updateUi=function InboxPage$updateUi(a,b){setTimeout(InboxToolbar.updateToolbarState,1);if(b)InboxPage.messageList.updateSortMenu();if(a||InboxPage.folderList.isSrch)FolderQuickViewListHelper.scrollIntoView();if(a)InboxPage.readingPane.handlePageLoadWithMsg()};InboxPage.maybeUpdatePostProcDataForMessage=function InboxPage$maybeUpdatePostProcDataForMessage(a,d,c){if(a.ads&&d&&(!c||!InboxPage.isReadingPaneOn)){var b=InboxPage.readingPane.mode;if(b==ReadingPane.MESSAGE_MODE||b==ReadingPane.DELAY_LOADED_MODE)a.inbox.delayBsiForReadMessage=true}return a};InboxPage.createDataEventHandlers=function InboxPage$createDataEventHandlers(e,o,m,n,p,l,q,f,r){var a=[],d=InboxServices.Events,b=InboxServices.EventTypes;if(o)jQuery.merge(a,[{src:d,type:b.ongetfolderlist}]);if(m)jQuery.merge(a,[{src:d,type:b.ongetquickviewlist}]);if(n)jQuery.merge(a,[{src:d,type:b.ongetmessagelist}]);if(p){var h=q?b.ongetmessagepart:b.ongetmessage;jQuery.merge(a,[{src:d,type:h}])}if(l)jQuery.merge(a,[{src:DemandLoadServices.Events,type:DemandLoadServices.EventTypes.onenddemandload}]);if(f){var k=f.src,h=f.type;if(k&&h)jQuery.merge(a,[{src:k,type:h}])}var c;if(!r)c=null;else{c=b.onstoplistening;jQuery.merge(a,[{src:d,type:c}])}var g=++Page.currentViewIdInProgress,j={id:g,ppd:e},i=function u(c,a){var b=a.ctx;return b.id==g},t=a.length<=0?null:new wLive.Hotmail.AggregatedEventHandler(a,$CD(this,InboxPage._processUiUpdateEvents),j,i,c),s=a.length<=0||!e?null:new wLive.Hotmail.AggregatedEventHandler(a,$CD(this,InboxPage._postProcessUserAction),j,i,c);Page.swapCurrentDataEventHandlers(s,t);if(e)InboxPage._initPostProcessState(e);return g};InboxPage.createMessageListRenderingInfo=function InboxPage$createMessageListRenderingInfo(b,d){var a=new HM.MessageListRenderingInfo,c=InboxPage.messageList.ml,e=InboxPage.folderList,f=InboxPage.quickViewList;a.FolderId=b?e.fid:null;a.QuickViewId=b?f.qvid:null;a.FilterId=b?c.fltid():null;a.SortKey=b?c.sBy():"Date";a.SortAsc=b?c.sAsc():false;a.IsSearchResults=b?e.isSrch:false;a.SearchKeyword=b?e.srchKw:"";a.AdvancedSearch=b?InboxPage.advancedSearch&&InboxPage.advancedSearch.getSearch():null;a.AutoSelectMessageIndex=InboxPage.Config.readingPane.autoSelectFirstMsg&&InboxPage.isReadingPaneOn?0:-1;a.ReadingPaneLocationMember=InboxPage.Config.readingPane.location;a.PageDirection=b&&!d?c.pDir():"FirstPage";a.ExtraFetchCount=InboxPage.Config.extraMessageCount;a.PageNumCurrent=b&&!d?c.pCur():1;a.NumberOfMessages=b&&!d?c.mCt():-1;a.AnchorId=b&&!d?c.aMid():null;a.AnchorDate=b&&!d?c.aDate():null;a.JumpToAnchor=null;a.BulkSelectAllTimestamp=null;a.LastUpdateTimestamp=null;a.IsFavoriteSelected=b?e.isFavoriteSelected:null;return a};InboxPage.createMoveOrJunkActionMessageListRenderingInfo=function InboxPage$createMoveOrJunkActionMessageListRenderingInfo(c,b,e){var d=c.isBulk&&!b,a=InboxPage.createMessageListRenderingInfo(true,d);if(e&&!d)InboxPage.configureAutoSelect(a,b);if(!c.isBulk&&!b&&a.NumberOfMessages>=0)a.NumberOfMessages-=c.mids.length;a.LastUpdateTimestamp=InboxPage.messageList.ml.kDate();return a};InboxPage.createConversationRenderingInfo=function InboxPage$createConversationRenderingInfo(b){var a=new HM.ConversationRenderingInfo;a.ConversationId=b&&InboxPage.readingPane.cv?InboxPage.readingPane.cv.cid():null;a.FolderId=b?InboxPage.folderList.fid:null;a.MarkAsRead=true;a.SenderEmail=null;return a};InboxPage.createMessageRenderingInfo=function InboxPage$createMessageRenderingInfo(){var a=new HM.MessageRenderingInfo;a.MessageId=null;a.FolderId=null;a.AllowUnsafeContent=false;a.OverrideCodepage=-1;a.AuxData=null;a.MarkAsRead=true;a.SenderEmail=null;return a};InboxPage.createBatchInfo=function InboxPage$createBatchInfo(){var a=new HM.BatchInfo;a.Timestamp=InboxPage.messageList.ml.saDate();a.AnchorDate=null;a.AnchorId=null;a.ProcessedCount=0;a.IsLastBatch=false;a.SenderSearch=null;return a};InboxPage.createPostActionInfo=function InboxPage$createPostActionInfo(b,a,c){return {nextActionFn:b,onCompletionEvent:a,args:c}};InboxPage.createBulkMoveDataPoints=function InboxPage$createBulkMoveDataPoints(d,b,c){var a={BulkType:d};if(b)a["BulkEntry"]=b;if(c)a["BulkNext"]=c;return a};InboxPage.configureAutoSelect=function InboxPage$configureAutoSelect(a,b){a.AutoSelectMessageIndex=InboxPage.isReadingPaneOn||InboxPage.readingPane.isFullView?b?InboxPage.messageList.getSelectionIndex():InboxPage.messageList.getAutoSelectIndex():-1};InboxPage.createMessageAuxData=function InboxPage$createMessageAuxData(a){var b=null;if(null!=a&&""!=a){b=new HM.HmAuxData;b.Value=a}return b};InboxPage.getSelectedMessageData=function InboxPage$getSelectedMessageData(){return InboxPage.readingPane.getSelectedMessageData()||InboxPage.messageList.getSelectedMessageData()};InboxPage.verifyMinimumSelection=function InboxPage$verifyMinimumSelection(){var a=!InboxPage.isSearch()?InboxPage.getSelectedMessageData():InboxPage.messageList.getSelectedMessageData();if(!a.isBulk&&0==a.mids.length){alert(Page.decode(InboxPage.Strings.noMessagesSelected));return null}return a};InboxPage.allowAction=function InboxPage$allowAction(b,d){if(!InboxPage.Config.isThrottleActionsEnabled)return true;var c=(new Date).getTime(),a=InboxPage._throttleData;if(a.action==b&&a.msgId==d&&c-a.initialTime<InboxPage.Config.throttleActionTime){a.count++;if(a.count>InboxPage.Config.maxThrottleActions){if(!a.isThrottled){$WebWatson.submit("action throttled: "+b,null,null,null,null,null,null,true);a.isThrottled=true}return false}}else{a.action=b;a.msgId=d;a.count=1;a.initialTime=c;a.isThrottled=false}return true};InboxPage._throttleData={action:null,msgId:null,count:0,initialTime:null,isThrottled:false};InboxPage._getUserActionsStack=function InboxPage$_getUserActionsStack(){return InboxPage._invokes};FireAnt.Debug.CB.getUserActions=InboxPage._getUserActionsStack;InboxPage._postWatsonCallback=function InboxPage$_postWatsonCallback(){InboxPage._hasError=true};FireAnt.Debug.CB.postWatsonCallback=InboxPage._postWatsonCallback;InboxPage._onNetworkPreInvoke=function InboxPage$_onNetworkPreInvoke(){Page.fppPending(true);Page.stopCaching()};InboxPage._onNetworkPostCallback=function InboxPage$_onNetworkPostCallback(){Page.fppPending(false);Page.startCaching()};InboxPage.postWithKRCookie=function InboxPage$postWithKRCookie(b){var a=String.format("{0}?kr=true&n={1}",Page.SELF_PATH,Page.queryString.newNonce);_ge("ReturnUrl").value=a;Page.submit(null,b)};InboxPage._postReportErrorCallback=function InboxPage$_postReportErrorCallback(){InboxPage._hasError=true};Page.postReportErrorCallback=Page.onDirectNetworkErrorDisplay=InboxPage._postReportErrorCallback;Type.createStaticClass(InboxPage,"InboxPage");function $showIN(){if(typeof Infopane!="undefined"&&Infopane._instance){Infopane._instance.show();$css.remove(_ge("wlidContainer"),"WlidContainer")}}function $hideIN(){if(typeof Infopane!="undefined"&&Infopane._instance){Infopane._instance.forceHide();$css.remove(_ge("wlidContainer"),"WlidContainer");$css.remove(_ge("contentRight"),"HasWlidAbove")}}Type.createStaticClass(InboxServices,"InboxServices");InboxPage.initSplitter=function(){};InboxPage.onSubmitReadingPaneOptionClicked=function(){};InboxPage.onSubmitChangeConversationView=function(){};InboxPage.onViewRespectPopDeleteSettings=function(){};InboxPage.onSubmitSortConversationView=function(){};InboxPage.onSubmitUpsellConversationView=function(){};InboxPage.makeMenuScroll=function(){};InboxPage.resetSkyscraperScroll=function(){};InboxPage.resetContentHeight=function(){};$Do.register("Bucket0.isReady",function(){InboxPage.initialize()})